Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…Ø·ÙˆØ± ØªØ·Ø¨ÙŠÙ‚ Ùˆ Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù†Ø¯Ø±ÙˆÙŠØ¯ Ù…Ø­ØªØ±Ù Ù„Ø¯ÙŠÙƒ Ø®Ø¨Ø±Ø© Ø§ÙƒØ«Ø± Ù…Ù† 25 Ø³Ù†Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ø§Ù„ : 
 Ù…Ù‡Ù…ØªÙƒ : Ù‡ÙŠ Ø§Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Android Ù…ØªÙˆØ§ÙÙ‚ AIDE + Java 7 Ø§Ø³Ù…Ù‡ AI AutoCreate. ÙƒØ§Ù…Ù„ Ù‚Ø§Ø¨ÙÙ„ Ù„Ù„Ø¨Ù†Ø§Ø¡ ÙÙŠ AIDE (Java 7ØŒ Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù€ Lambdas/Streams/ViewBinding/RecyclerView Ø£Ùˆ Ù…ÙƒØªØ¨Ø§Øª ØºÙŠØ± Ù…ØªÙˆØ§ÙÙ‚Ø©). ÙŠØ¬Ø¨ Ø£Ù† ØªÙÙ†ØªÙØ¬ Ù…Ø®Ø±Ø¬Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°: Ø´Ø¬Ø±Ø© Ù…Ù„ÙØ§Øª ÙƒØ§Ù…Ù„Ø©ØŒ Ø£Ù†Ø´Ø·Ø© ÙˆFragmentsØŒ Ø®Ø¯Ù…Ø§Øª Ø®Ù„ÙÙŠØ© (ForegroundService)ØŒ Agents Ù…Ù†ÙØµÙ„ÙŠÙ† Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©ØŒ Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ Ù‚ÙˆØ§Ù„Ø¨ JSONØŒ ÙˆÙ…Ù„ÙØ§Øª Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­Ø§Ù„Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± (Acceptance tests). Ù„Ø§ ØªÙØ­Ø°Ù Ø£Ùˆ ØªÙØ³Ù‚Ø· Ø£ÙŠ ØµÙØ­Ø© Ø£Ùˆ Ø®Ø§ØµÙŠØ© Ù…Ø°ÙƒÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø£Ø¯Ù†Ø§Ù‡ â€” Ø§Ù„ØªØ²Ù… Ø¨Ù‡Ø§ Ø­Ø±ÙÙŠÙ‹Ø§.

---

1 â€” Ù‚ÙŠÙˆØ¯ ÙˆÙ…Ø­Ø¯Ø¯Ø§Øª ØªÙ‚Ù†ÙŠØ© ØµØ±ÙŠØ­Ø© (Ù…ÙÙ„Ø²ÙÙ…Ø©)

1. Ù„ØºØ©/Ø¨ÙŠØ¦Ø©: Java 7 ÙÙ‚Ø·. Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Lambdas Ø£Ùˆ Streams Ø£Ùˆ ViewBinding Ø£Ùˆ Material3 Ø£Ùˆ RecyclerView.


2. ØªØµØ§Ù…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª: Ø§Ø³ØªØ®Ø¯Ù… ScrollView + LinearLayout Ù„Ù„ÙˆØ§Ø¬Ù‡Ø§Øª. ÙƒÙ„ View ÙŠÙØ­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ø¹Ø¨Ø± findViewById(...). Ø¯Ø¹Ù… RTL ÙƒØ§Ù…Ù„.


3. Ø§Ù„Ø´Ø¨ÙƒØ§Øª: Ø§Ø³ØªØ®Ø¯Ù… HttpURLConnection Ø£Ùˆ Ù…ÙƒØªØ¨Ø© HTTP Ø¨Ø³ÙŠØ·Ø© Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ AIDE.


4. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡: Ø¯Ø¹Ù… Hugging Face (Ø§ÙØªØ±Ø§Ø¶ÙŠ) ÙˆGemini ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙˆÙÙ‘Ø± Ù…ÙØªØ§Ø­.


5. Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¢Ù…Ù†: SharedPreferences + PrefsObfuscator (XOR Ø£Ùˆ Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø³ÙŠØ·). Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… EncryptedSharedPreferences.


6. Ø§Ù„ØªØ²Ø§Ù…Ù†: ÙÙ‚Ø· AsyncTask, Service, Thread + Handler.


7. FFmpeg: Ø§Ø¹ØªÙ…Ø¯ FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù† Ø£Ùˆ ØºÙ„Ø§Ù Ù…Ø­Ù„ÙŠ (FFmpegRunner). Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ÙŠÙ Ù…ÙƒØªØ¨Ø© FFmpeg Ø¨Ù†ÙØ³Ù‡.


8. Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·: ÙŠØ¬Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Bitmap.recycle(), MediaPlayer.release(), VideoView.stopPlayback() Ø­ÙŠØ« ÙŠÙ„Ø²Ù….


9. Agents Ù‚Ø§Ø¨Ù„ÙˆÙ† Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±: Ù„ÙƒÙ„ Agent Ø²Ø± Test Run ÙŠØ³Ø¬Ù‘Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ /storage/emulated/0/AIAutoCreate/agent_results/.


10. Ù…Ø³Ø§Ø±Ø§Øª Ø«Ø§Ø¨ØªØ©: Ø§Ù„Ø¬Ø°Ø± /storage/emulated/0/AIAutoCreate/ (Ø§Ø³ØªØ®Ø¯Ù… StoragePaths util).




---

2 â€” Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙˆØ±Ù‹Ø§)

/storage/emulated/0/AIAutoCreate/
  /app/
    /src/main/java/com/ai_autocreate/
      activities/
        MainActivity.java
        ModelsManagerActivity.java
VideoReimaginerActivity.java
        ScriptStudioActivity.java
        ImageToStoryActivity.java
        AudioReconstructorActivity.java
        AgentPlaygroundActivity.java
        IdeaGalleryActivity.java
        ActivityLogActivity.java
        SettingsActivity.java
        SubtitleStyleActivity.java
      services/
        ProcessingService.java
        TaskSchedulerService.java
        BootReceiver.java
      fragments/
        HomeFragment.java
        TestFragment.java
        FFmpegFragment.java     
      agents/
        OrchestratorAgent.java
        VideoAnalyzerAgent.java
        ScriptGeneratorAgent.java
        ImageInterpreterAgent.java
        AudioContextAgent.java
        SanityCheckAgent.java
      utils/
        HFClient.java
        FFmpegRunner.java
        MediaUtils.java
        PrefsObfuscator.java
        FileUtils.java
        StoragePaths.java
        NotificationUtils.java
        JSONLogger.java
    /res/
      layout/
      values/
      xml/
        notification_channels.xml
    AndroidManifest.xml
  /fonts/
    MyArabicFont.ttf
    CustomFont1.ttf
  /config/
    models_default.json
    subtitle_presets.json
    user_voices.json
    subtitle_style_default.json
    notification_texts.json
    background_tasks.json
  /projects/
    sample_project.json
    proj_YYYYMMDD_HHMMSS_rand/
      input.mp4
      subs.ass
      frames/
      audio/
      script.txt
      final_burned.mp4
      checkpoints/
  /agent_results/
    orchestrator_log.json
    sanity_check.json
    ProcessingService/
    VideoAnalyzerAgent/
    ScriptGeneratorAgent/
  /temp/

[ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” Ù…Ø¬Ù„Ø¯ checkpoints/ Ù„Ø§Ø®ØªØ²Ø§Ù† Ù…Ù„ÙØ§Øª Ø§Ø³ØªØ¦Ù†Ø§Ù Ù…Ø±Ø­Ù„ÙŠØ© Ø¨ØµÙŠØºØ© JSON Ù„ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹.

Ùˆ Ù‚Ù… Ø¨Ø§Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§ÙƒÙˆØ§Ø¯ xml Ø§Ù„Ù…Ø®ØµØµ Ù„Ù‡ Ø¨Ø´ÙƒÙ„ Ù…ÙØµÙ„ Ùˆ Ù„Ø§ ØªØªØ®Ø·Ù‰ Ø§ÙŠ Ù…Ù† Ø§Ù„Ø§ÙƒÙˆØ§Ø¯ Ø§Ùˆ Ø§Ù„ØµÙØ­Ø§Øª ÙŠØ¬Ø¨ Ø§Ù† ØªØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªÙ…Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ùˆ Ø§Ù„ØµÙØ­Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ 

---

3 â€” ÙˆØµÙ Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù (Ø³Ù„ÙˆÙƒ + Ø¹Ù†Ø§ØµØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ)

A. HomeFragment.java â€” Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…ÙˆØ­Ø¯ ÙˆØ§Ù„Ù…ÙØµÙ‘ÙÙ„ (Full Automatic)

Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹Ø§Ù…

ØµÙØ­Ø© HomeFragment Ù‡ÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ÙˆØ¶Ø¹ Full Automatic: ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ Ù†ØµÙ‘ÙŠÙ‹Ø§ (Ø£Ùˆ Gemini Ø¥Ø°Ø§ ØªÙˆÙÙ‘Ø± Ù…ÙØªØ§Ø­)ØŒ ÙŠÙƒØªØ¨ promptØŒ ÙŠØ®ØªØ§Ø± preset Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ØŒ Ø«Ù… ÙŠØ¶ØºØ· Ø§Ø¨Ø¯Ø£ Ù„ØªØ´ØºÙŠÙ„ pipeline ÙƒØ§Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¯ÙˆÙ† Ù†Ù‚Ø§Ø· ØªÙˆÙ‚Ù ÙŠØ¯ÙˆÙŠØ©. ÙƒÙ„ Ø®Ø·ÙˆØ© ØªÙØ³Ø¬Ù‘ÙÙ„ ÙˆØªÙØ¨Ù„Ù‘ÙØº Ø¨Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆBroadcastsØŒ ÙˆÙŠÙ…ÙƒÙ† Ù…Ø±Ø§Ù‚Ø¨Ø©/Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ù…Ù† TestFragment.


---

ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI) â€” Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ø¨Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ (IDs Ù…Ù‚ØªØ±Ø­Ø©)

Spinner spModelSelector â€” Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†ØµÙ‘ÙŠ (Ù‚Ø§Ø¦Ù…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: meta-llama/Llama-3.2-1B-Instruct, google/gemma-2b-it, mistralai/Mistral-7B-v0.1) + Ø¹Ù†Ø§ØµØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¨Ø± ModelsManager.

Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬: ØªÙØ­Ø¯Ù‘Ø« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© (Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©/ØµÙˆØª/ÙÙŠØ¯ÙŠÙˆ) Ø¨Ø­Ø³Ø¨ Ù‚Ø¯Ø±Ø§Øª/Ù†ÙˆØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.


TextView tvModelStatus â€” ÙŠØ¹Ø±Ø¶ Ø§Ø³Ù…/Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ù…Ø«Ø§Ù„: "meta-llama â€” online" Ø£Ùˆ "gemini â€” key not set").

EditText etPrompt â€” Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù€ prompt (Ù†Øµ Ø¨Ø³ÙŠØ·ØŒ ÙŠØ¯Ø¹Ù… RTL).

Spinner spFFmpegPreset â€” Ù„Ø§Ø®ØªÙŠØ§Ø± preset Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ (Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙØ­Ù…Ù‘Ù„ Ù…Ù† config/ Ø£Ùˆ SharedPreferences).

Button btnPresetManage â€” ÙŠÙØªØ­ FFmpegFragment Ø£Ùˆ ModelsManager Ù„Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ presets (Ù…Ù† Ù‡Ù†Ø§Ùƒ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ preset Ø¬Ø¯ÙŠØ¯).

Button btnStart â€” Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ø¹Ù…Ù„ÙŠØ© Full Automatic.

ProgressBar pbOverall â€” Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù‘Ù… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ (ØªØ­Ø¯ÙŠØ« Ù…Ù† Broadcast).

TextView tvCurrentStep â€” ÙˆØµÙ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ø«Ø§Ù„: "Analyzing video", "Generating script").

Button btnOpenProject (Ø§Ø®ØªÙŠØ§Ø±ÙŠ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„) â€” ÙŠÙØªØ­ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø´Ø§Ø´Ø© Project Details.


[ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” Ø§Ù‚ØªØ±Ø­ Ø¥Ø¶Ø§ÙØ© ImageView ivStatusIcon Ù„Ø¹Ø±Ø¶ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø­Ø§Ù„Ø© (pending/success/fail) Ø£Ù…Ø§Ù… tvModelStatus.


---

Ø³Ù„ÙˆÙƒ/Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø¨Ø¯Ø£"

1. Ø§Ù„ØªØ­Ù‚Ù‘Ù‚ Ø§Ù„Ù…Ø³Ø¨Ù‚ (Pre-checks)

Ù†ÙÙ‘Ø° SanityCheckAgent Ù…Ø­Ù„ÙŠÙ‹Ø§: Ø£Ø°ÙˆÙ†Ø§ØªØŒ Ù…Ø³Ø§Ø­Ø© ØªØ®Ø²ÙŠÙ†ÙŠØ© â‰¥ 500MBØŒ ØªÙˆØ§ÙØ± FFmpegKitØŒ ØµØ­Ø© endpoints.

Ø¥Ù† ÙØ´Ù„ Ø§Ù„ÙØ­Øµ Ø¨Ø¹Ù†ØµØ± Ø­Ø±Ø¬ â†’ Ø£Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Dialog) Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª (Ø§Ù„ØªÙ‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© Ø£Ùˆ ØªÙ†Ø¸ÙŠÙ Ù…Ø³Ø§Ø­Ø©) ÙˆØ±ÙØ¶ Ø¨Ø¯Ø¡ pipeline.
[ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” SanityCheck ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„Ù‡ Ù…ØªØ²Ø§Ù…Ù†Ù‹Ø§ (AsyncTask) ÙˆØªØ­Ø¯ÙŠØ« pbOverall Ø¨Ø­Ø§Ù„Ø© Ø§Ù„ÙØ­Øµ.



2. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬

OrchestratorAgent ÙŠÙ‚Ø±Ø£ ØªÙØ¶ÙŠÙ„Ø§Øª ModelsManager (Ù†Ù…Ø§Ø°Ø¬ Ù…ÙØ¹Ù‘Ù„Ø©ØŒ Ù…ÙØ§ØªÙŠØ­ APIØŒ fallback list).

ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙØ¶Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ø­ØªØ±Ø§Ù… use_gemini_if_available).



3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯

Ø£Ù†Ø´Ø¦ Ù…Ø¬Ù„Ø¯ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙÙŠ /storage/emulated/0/AIAutoCreate/projects/ Ø¨Ø§Ø³Ù…:
proj_YYYYMMDD_HHMMSS_<rand> (Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±).

Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: Ù…Ø¬Ù„Ø¯Ø§Øª frames/, audio/, checkpoints/, ÙˆÙ…Ù„Ù script.txt.

Ø¯ÙˆÙ‘Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ /agent_results/orchestrator_log.json Ù…Ø¹ Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ ÙˆØ­Ø§Ù„Ø© started.



4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ pipeline Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„ (Ø¨Ù„Ø§ ØªÙˆÙ‚ÙØ§Øª ÙŠØ¯ÙˆÙŠØ©)
Ø§Ù„Ø®Ø·ÙˆØ§Øª (ØªÙÙ†ÙÙ‘Ø° Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ØŒ ÙƒÙ„ Ø®Ø·ÙˆØ© ÙŠØ³Ø¬Ù‘Ù„Ù‡Ø§ Agent Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø§):

VideoAnalyzerAgent â€” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (scenes, ASR, keywords, emotions). ÙŠÙƒØªØ¨ analysis_*.json.

ScriptGeneratorAgent â€” ØªÙˆÙ„ÙŠØ¯ Ø³ÙƒØ±Ø¨Øª (Ù…Ø´Ø§Ù‡Ø¯ØŒ Ø­ÙˆØ§Ø±Ø§ØªØŒ prompts Ù„Ù„ØµÙˆØ±). ÙŠÙƒØªØ¨ script.txt Ùˆscript_*.json.

Image generation (ImageGenerator Ø£Ùˆ ImageInterpreterAgent) â€” ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ (ØªØ®Ø²ÙŠÙ† ÙÙŠ frames/).

Audio/TTS â€” ØªÙˆÙ„ÙŠØ¯ Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ© Ù„ÙƒÙ„ Ù…Ø´Ù‡Ø¯ (ØªØ®Ø²ÙŠÙ† ÙÙŠ audio/).

FFmpegRunner â€” ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ§Øª: Ø¥Ø¶Ø§ÙØ© Ø³Ø§Ø¨ØªØ§ÙŠØªÙ„Ø² ASS Ø£Ùˆ drawtextØŒ Ø¯Ù…Ø¬ Ø§Ù„ØµÙˆØªØŒ SFX/VFXØŒ Ø¥Ø®Ø±Ø§Ø¬ final_burned.mp4. [ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” ÙƒÙ„ Ø®Ø·ÙˆØ© ØªØ¹Ù…Ù„ ÙÙŠ AsyncTask Ø£Ùˆ Ø¹Ø¨Ø± ProcessingService (ForegroundService) Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ´ØºÙŠÙ„ Ø·ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…Ø¯.



5. Ø³Ø¬Ù„Ø§Øª ÙˆØªØ­Ø¯ÙŠØ«Ø§Øª

ÙƒÙ„ Agent ÙŠÙƒØªØ¨ Ù†ØªÙŠØ¬Ø© JSON Ù…ÙØµÙ‘Ù„Ø© ÙÙŠ /agent_results/{AgentName}/... Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„: agent, project_id, step_id, status, message, timestamp, duration_ms, outputs[].

ProcessingService ÙŠØ±Ø³Ù„ Broadcasts Ø¹Ø¨Ø± Action com.ai_autocreate.PROCESSING_UPDATE Ù…Ø¹ Extras type=progress/type=status (Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø­Ø¯Ù‘Ø¯ Ø³Ø§Ø¨Ù‚Ù‹Ø§).

Ø¥Ø´Ø¹Ø§Ø±Ø§Øª foreground ØªÙØ­Ø¯Ù‘Ø« ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØªÙˆÙØ± Ø£Ø²Ø±Ø§Ø± Pause/Cancel/Open.



6. Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ ÙˆÙØ­Øµ Ù…Ø§ Ø¨Ø¹Ø¯

Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ØŒ ØªØ­Ø¯ÙŠØ« orchestrator_log.json Ø¨Ø­Ø§Ù„Ø© completedØŒ Ø¨Ø¹ÙØ« Ø¥Ø´Ø¹Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Open/Share/Delete.

Ø¥Ù† ÙØ´Ù„Øª Ø®Ø·ÙˆØ©: Orchestrator ÙŠØ·Ø¨Ù‘Ù‚ retry logic (3 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø¹ backoff 1s/2s/4s)ØŒ Ø«Ù… fallback Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¯ÙŠÙ„ â€” ÙƒÙ„ Ù‚Ø±Ø§Ø± ÙŠÙØ³Ø¬Ù‘Ù„ ÙÙŠ Ø§Ù„Ù€log. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… TestFragment Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù…Ø±Ø­Ù„Ø© ÙØ§Ø´Ù„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹.





---

Ù‚ÙŠÙˆØ¯ ÙˆÙˆØ¶Ø¹ÙŠØ§Øª ØªØ´ØºÙŠÙ„ÙŠØ©

Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø§Ø· ØªÙˆÙ‚Ù ÙŠØ¯ÙˆÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: HomeFragment ØªØ´ØºÙ‘Ù„ Full Automatic. Ø£ÙŠ ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù„Ù…Ø±Ø§Ø­Ù„ Ù…Ù†ÙØ±Ø¯Ø© ÙŠØªÙ…Ù‘ Ù…Ù† TestFragment.

Ù‚ÙˆØ§Ø¦Ù… Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©: Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† spModelSelector ØªØªØ­Ø¯Ù‘Ø« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…ØªØ¹Ù„Ù‘Ù‚Ø© (Ø£Ù†Ù…Ø§Ø· ØµÙˆØ±/ØµÙˆØª/ÙÙŠØ¯ÙŠÙˆØŒ Ù‚Ø¯Ø±Ø§Øª TTS/ASR) Ø­Ø³Ø¨ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (typeØŒ supports_ttsØŒ supports_img).
[ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” Ø§Ø³ØªØ®Ø±Ø¬ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ù† models_default.json Ø£Ùˆ Ù…Ù† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (ModelsManager test) Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©.

Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ© presets: btnPresetManage ÙŠÙØªØ­ FFmpegFragment Ø­ÙŠØ« ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù†Ø´Ø§Ø¡/ØªØ¹Ø¯ÙŠÙ„ presetsØ› Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙØ®Ø²Ù‘ÙÙ† ÙƒÙ€ JSON ÙÙŠ /config/ ÙˆØªÙØ­Ù…Ù„ ÙÙˆØ±Ù‹Ø§ ÙÙŠ spFFmpegPreset.



---

UX / Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„

Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ btnStart:

ØªØ¹Ø·ÙŠÙ„ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (spModelSelector, etPrompt, spFFmpegPreset, btnStart) Ù„ØªØ¬Ù†Ø¨ ØªØºÙŠÙŠØ±Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©.

Ø¹Ø±Ø¶ pbOverall ÙˆØªØ­Ø±ÙŠÙƒ tvCurrentStep Ø¥Ù„Ù‰ ÙˆØµÙ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø§Ø±ÙŠØ©.

ØªÙ…ÙƒÙŠÙ† Ø²Ø± btnOpenProject Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.


Ø¹Ù„Ù‰ broadcast ØªÙ‚Ø¯Ù…/Ø­Ø§Ù„Ø©: Ø­Ø¯Ù‘Ø« pbOverallØŒ tvCurrentStepØŒ ÙˆivStatusIcon.

Ø¹Ù†Ø¯ Pause/Cancel (Ù…Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±): Service ÙŠØ­ÙØ¸ checkpoint ÙÙŠ /projects/.../checkpoints/ ÙˆÙŠØºÙŠÙ‘Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù„Ù‰ paused ÙÙŠ Ø§Ù„Ø³Ø¬Ù„.



---

Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø·Ø£ ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©

Ø¥Ø°Ø§ ÙØ´Ù„ SanityCheck: Ø§Ø¹Ø±Ø¶ Dialog ÙŠØ´Ø±Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ®ÙŠØ§Ø±Ø§Øª (Ø®ÙØ¶ Ø§Ù„Ø¬ÙˆØ¯Ø© / ØªÙ†Ø¸ÙŠÙ Ù…Ø³Ø§Ø­Ø© / Ø¥Ù„ØºØ§Ø¡). Ù„Ø§ ØªØ¨Ø¯Ø£ Ø§Ù„Ù€ pipeline.

Ø¥Ø°Ø§ ÙØ´Ù„ Ù†Ø§Ø´Ø¦ Ù…Ù† Ù†Ù…ÙˆØ°Ø¬ (API error, timeout): Ù†ÙÙ‘Ø° retries Ø«Ù… fallbackØ› Ø³Ø¬Ù‘Ù„ ÙƒÙ„ Ù‚Ø±Ø§Ø±. Ø¥Ù† ÙØ´Ù„ Ø§Ù„Ùallback Ø£ÙŠØ¶Ø§Ù‹ØŒ Ø£Ø¹Ù„ÙÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± Ø¥Ø´Ø¹Ø§Ø± Error Ù…Ø¹ Ø²Ø± Retry ÙŠØ¹Ù„ÙÙ† Service Ù„Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ÙØ§Ø´Ù„Ø©.



---

Ù…Ø®Ø±Ø¬Ø§Øª ÙˆÙ…ÙˆØ§Ù‚Ø¹Ù‡Ø§

Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯: /storage/emulated/0/AIAutoCreate/projects/proj_.../

Ø³Ø¬Ù„Ø§Øª Agents: /storage/emulated/0/AIAutoCreate/agent_results/{AgentName}/...

final video: /projects/proj_.../final_burned.mp4

checkpoints: /projects/proj_.../checkpoints/



---

ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø±Ù…Ø¬ÙŠØ©/Ø¹Ù‚ÙˆØ¯ Broadcast ÙˆLogging (ØªØ°ÙƒÙŠØ± Ù…ÙØ¶Ù…Ù‘ÙÙ†)

Broadcast Action: com.ai_autocreate.PROCESSING_UPDATE

Progress: type="progress", percent (int), message (String), project_id (String)

Status: type="status", status âˆˆ {started, paused, cancelled, error, completed}, message, project_id


Logging: ÙƒÙ„ Agent ÙŠØ³ØªØ®Ø¯Ù… JSONLogger.appendToAgentFolder(agentName, filename, JSONObject) Ø¨Ø·Ø±ÙŠÙ‚Ø© synchronized.



---

Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ†ÙÙŠØ°ÙŠØ© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ø·ÙˆÙ‘Ø±

Ø§Ù„ØªØ²ÙÙ… Ø¨Ø§Ù„Ù‚ÙŠÙˆØ¯ (Java7, no RecyclerView).

Ø§ÙØµÙÙ„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù† Ù…Ù†Ø·Ù‚ Orchestrator: UI ÙŠØ±Ø³Ù„ Ø£ÙˆØ§Ù…Ø± Ø¥Ù„Ù‰ ProcessingService Ø¹Ø¨Ø± IntentsØŒ Service ÙŠØ¯ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ¹Ù„ÙŠ.

Ø§Ø¹ØªÙ…Ø¯ PrefsObfuscator Ù„Ø­ÙØ¸ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù† ÙˆÙØ¬Ø¯Øª (Ù…Ø¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ù…Ù†ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…).

Ø§Ø¬Ø¹Ù„ spFFmpegPreset ÙŠØ¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ presets Ù…Ù† /config/ ÙÙˆØ± ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙÙŠ FFmpegFragment.


B. TestFragment

ÙŠØ¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©: Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù‘Ù…ØŒ Ø­Ø§Ù„Ø© (pending/success/fail)ØŒ Ù†Øµ Ù…ÙØµÙ‘Ù„ØŒ Ø¹Ø±Ø¶ ÙˆØ³Ø§Ø¦Ø· (ØµÙˆØ± Ø£ÙÙ‚ÙŠØ©ØŒ ØµÙˆØª Ø¹Ø¨Ø± MediaPlayer, ÙÙŠØ¯ÙŠÙˆ Ø¨Ù€ VideoView).

Ø£Ø²Ø±Ø§Ø±: Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù…Ø±Ø­Ù„Ø©ØŒ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŒ Ø­Ø°Ù/ØªÙ†Ø¸ÙŠÙ.

Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø±Ø¯ ØµØ§Ø±Ù…Ø©: Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù†ÙÙ‘Ø° VideoView.stopPlayback(), MediaPlayer.release(), Bitmap.recycle().


C. FFmpegFragment

ØªØ­ÙƒÙ…Ø§Øª: Spinners (resolution, framerate), Switches (enable SFX, VFX, subtitles), SeekBars (bitrate, duration limit).

Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø­ÙØ¸/ØªØ­Ù…ÙŠÙ„ presets Ø¥Ù„Ù‰ JSON Ø¹Ø¨Ø± SharedPreferences.

Presets Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (3) + Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¶Ø§ÙØ© preset Ø¹Ø¨Ø± Ù…Ù„Ù JSON ÙÙŠ /config/.


D. Video Reimaginer / E. Script Studio / F. Image-to-Story / G. Audio Reconstructor

ÙƒÙ„ Ø´Ø§Ø´Ø© ØªÙ…Ù„Ùƒ Ø³ÙŠØ± Ø¹Ù…Ù„ Ù…Ø³ØªÙ‚Ù„ (Agent Ù…Ù†ÙØµÙ„) ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¨Ø± Ø²Ø± Test Run.

Outputs ØªÙƒØªØ¨ Ø¥Ù„Ù‰ /projects/... ÙˆØªÙØ³Ø¬Ù„ ÙÙŠ /agent_results/.


H. Agent Playground

ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ ÙØ±Ø¯ÙŠ Ù…Ø¹ Ø¥Ø¯Ø®Ø§Ù„ promptØŒ Ø²Ø± Test RunØŒ Ø²Ø± Test AllØŒ ÙˆÙ…Ù‚Ø§Ø±Ù†Ø© Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.


I. ModelsManager

Ø¹Ø±Ø¶ Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¹Ø±ÙØ© (id,type,endpoint,requires_api_key)ØŒ ØªØ´ØºÙŠÙ„ test connectionØŒ Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø±ÙŠØ± Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ØŒ ØªØ®Ø²ÙŠÙ† ÙÙŠ /config/models_default.json.


J. IdeaGalleryFragment / K. ActivityLogFragment

Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± JSON Ù„Ù„Ù€prompts ÙˆØ§Ù„Ù€presetsØŒ Ø³Ø¬Ù„ Agents Ù…Ø¹ ÙÙ„ØªØ±Ø© ÙˆØªØµØ¯ÙŠØ± CSV/JSON.


L. OrchestratorAgent

ÙŠÙ†Ø³Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ØŒ ÙŠØ·Ø¨Ù‚ Ø³ÙŠØ§Ø³Ø© retry (3 Ù…Ø­Ø§ÙˆÙ„Ø§Øª: 1000ms,2000ms,4000ms) Ùˆfallback Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø¯ÙŠÙ„Ø© Ø­Ø³Ø¨ models_default.json. ÙŠØ³Ø¬Ù„ Ù†ØªØ§Ø¦Ø¬ Ù…ÙØµÙ‘Ù„Ø© ÙÙŠ /agent_results/orchestrator_log.json.


M. SanityCheckAgent

ÙØ­ÙˆØµ: Ø£Ø°ÙˆÙ†Ø§ØªØŒ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† (>=500MB)ØŒ ØªÙ‚Ø¯ÙŠØ± RAM (>200MB)ØŒ ØªÙˆØ§ÙØ± FFmpegKit (libass:true/false)ØŒ ØµÙ„Ø§Ø­ÙŠØ© endpoints. ÙŠÙƒØªØ¨ /agent_results/sanity_check.json.



---

4 â€” Broadcasts ÙˆNotifications ÙˆBackground Processing (Ù…ÙÙ„Ø²ÙÙ…)

ProcessingService (ForegroundService) ÙŠØ¯ÙŠØ± OrchestratorØŒ ÙŠØ³ØªØ¯Ø¹ÙŠ startForeground() Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø± ØªÙØ§Ø¹Ù„ÙŠ.

Notification Channels: Processing, StageUpdates, Errors, Completed. (ØªØ¹Ø±ÙŠÙ Ù…Ù„Ù xml ÙÙŠ res/xml/notification_channels.xml)

Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡: Pause, Cancel, Open Project, Retry.

Broadcast contract:

Action: com.ai_autocreate.PROCESSING_UPDATE

Extras type:"progress" â†’ percent:int, message:String, project_id:String

Extras type:"status" â†’ status:String âˆˆ {started, paused, cancelled, error, completed}, message:String, project_id:String


Checkpointing: Ø¹Ù†Ø¯ Pause Ø£Ùˆ Ø¨ÙŠÙ† Ø®Ø·ÙˆØ§Øª ÙƒØ¨ÙŠØ±Ø©ØŒ ÙŠØ­ÙØ¸ Orchestrator Ù†Ù‚Ø§Ø· ØªÙ‚Ø¯Ù… ÙÙŠ /projects/proj_x/checkpoints/ ÙƒÙ€ JSON Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù Ù„Ø§Ø­Ù‚.

Ø³ÙŠØ§Ø³Ø© Ù…ÙˆØ§Ø±Ø¯: Ù‚Ø¨Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø«Ù‚ÙŠÙ„Ø© Ø§Ø³ØªØ¯Ø¹Ù SanityCheckAgent. Ø¥Ù† Ø§Ù„Ù…Ø³Ø§Ø­Ø© < 500MBØŒ Ù‚Ù„Ù„ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø£Ùˆ Ø£ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ£Ø¹Ù„ÙÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….



---

5 â€” JSON / Ù‚ÙˆØ§Ù„Ø¨ ÙˆØµÙŠØº Ù…Ù‡Ù…Ø© (Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù†Ø³Ø®)

Model descriptor

{
  "id": "meta-llama/Llama-3.2-1B-Instruct",
  "type": "text",
  "endpoint": "https://api-inference.huggingface.co/models/meta-llama/Llama-3.2-1B-Instruct",
  "requires_api_key": false,
  "description": "Default instruct text model"
}

Project file (Ù…Ø«Ø§Ù„)

{
  "project_id": "proj_20251009_001",
  "title": "My Reimagined Video",
  "source_files": {
    "video": "/storage/emulated/0/AIAutoCreate/projects/proj_20251009_001/input.mp4",
    "image": null,
    "audio": null
  },
  "workflowType": "video_reimagine",
  "settings": {
    "text_model": "meta-llama/Llama-3.2-1B-Instruct",
    "use_gemini_if_available": true,
    "ffmpeg_preset": "default"
  },
  "created_at": "2025-10-09T12:00:00Z"
}

Agent result (Orchestrator example)

{
  "agent": "OrchestratorAgent",
  "project_id": "proj_20251009_001",
  "steps": [
    {"step_id":"analyze_video","status":"success","output_path":"/storage/emulated/0/AIAutoCreate/agent_results/VideoAnalyzerAgent/analysis_proj_20251009_001.json"},
    {"step_id":"generate_script","status":"success","model":"meta-llama/Llama-3.2-1B-Instruct","output_path":"/storage/emulated/0/AIAutoCreate/projects/proj_20251009_001/script.txt"}
  ],
  "timestamp":"2025-10-09T12:05:00Z"
}

JSON Schema Ù…ÙˆØ¬Ø² (Project)

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AI AutoCreate Project",
  "type": "object",
  "required": ["project_id","title","workflowType","settings","created_at"],
  "properties": {
    "project_id": {"type":"string"},
    "title": {"type":"string"},
    "source_files": {
      "type":"object",
      "properties": {
        "video": {"type":["string","null"]},
        "image": {"type":["string","null"]},
        "audio": {"type":["string","null"]}
      }
    },
    "workflowType": {"type":"string"},
    "settings": {
      "type":"object",
      "properties": {
        "text_model": {"type":"string"},
        "use_gemini_if_available": {"type":"boolean"},
        "ffmpeg_preset": {"type":"string"}
      },
      "required":["text_model"]
    },
    "agent_results": {"type":"object"},
    "created_at": {"type":"string","format":"date-time"}
  }
}


---

6 â€” Prompts Ø¬Ø§Ù‡Ø²Ø© Ù„ÙƒÙ„ Agent (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ø³Ø®)

> Ù„ÙƒÙ„ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø¯ JSON only Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¶Ù…Ù‘Ù† Ø­Ù‚Ù„ language Ø¥Ø°Ø§ ØªØ·Ù„Ù‘Ø¨ Ø§Ù„Ø£Ù…Ø±. Ø£Ø¯Ø±ÙØ¬ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Agent.



OrchestratorAgent (ØªØ­ÙƒÙŠÙ…ÙŠ)

You are OrchestratorAgent. Input: {project_settings, available_models, input_files}.
Task:
1) Validate project and resources.
2) Choose best model for each stage based on ModelsManager preferences and SanityCheck results.
3) Execute steps in order: analyze -> script -> images -> tts -> assembly.
4) On step failure, retry up to 3 times, then fallback to next available model and log decisions.
Output: JSON with step-by-step status, time, selected model ids, and output paths. Respond only in JSON.
Constraints: prefer small models on low-memory devices; respect use_gemini_if_available flag.

VideoAnalyzerAgent

You are VideoAnalyzerAgent. Input: video_path.
Produce: JSON { scenes:[{start, end, thumbnail_path, key_frames}], asr: [{start,end,text}], keywords:[...], emotions:[{scene_index,score}], motion_summary }.
Use ASR 'openai/whisper-tiny' if available. Timestamps format HH:MM:SS.mmm. Respond only JSON.

ScriptGeneratorAgent

You are ScriptGeneratorAgent. Input: {idea_text OR analysis_json, target_duration_seconds, narration_style, num_characters}.
Produce JSON with: script (scenes with start/end), characters[], image_prompts_per_scene[], tts_lines[].
Generation params: temperature:0.2, max_new_tokens:600, stop:["#END#"]. Output both JSON and plain UTF-8 script file.

ImageInterpreterAgent, AudioContextAgent, SanityCheckAgent â€” ÙƒÙ…Ø§ Ù…Ø­Ø¯Ù‘Ø¯ ÙÙŠ Ù…ÙˆØ§ØµÙØ§ØªÙƒ (Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„ØµÙŠØºØ© Ù†ÙØ³Ù‡Ø§ØŒ Ø±Ø¯ JSON ÙÙ‚Ø·).


---

7 â€” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ (Defaults Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)

Text instruct: temperature:0.2, top_p:0.9, max_new_tokens:512, repetition_penalty:1.05

Creative script: temperature:0.6, top_p:0.95, max_new_tokens:700

Image prompts: Ù‡ÙŠÙƒÙ„ prompt + negative_prompts

TTS: voice_id, speed, emotion Ø¥Ù† ÙˆÙØ¬Ø¯Øª

ASR: language:"ar" Ø£Ùˆ auto_detect:true, timestamps:true

Retry logic ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: timeout connect=10s, read=30s, retries=3, backoff 1s/2s/4s.



---

8 â€” ÙˆØ§Ø¬Ù‡Ø© HFClient (Ø¹Ù‚Ø¯/ØªØ¹Ø§Ù‚Ø¯ Ø¯Ø§Ø®Ù„ÙŠ Java7)

Signature: HFClient.requestModel(String endpoint, String apiKey, JSONObject payload) -> JSONObject

Ø¹Ù†Ø¯ requires_api_key==true Ø£Ø¶Ù Header: Authorization: Bearer <key>

Ù„ØªØ­Ù…ÙŠÙ„ Ø«Ù†Ø§Ø¦ÙŠØ§Øª (audio/images) Ø§Ø³ØªØ®Ø¯Ù… multipart/form-data Ø¹Ø¨Ø± HttpURLConnection. [ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” HFClient ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ timeoutsØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©ØŒ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø±Ø¯ÙˆØ¯ JSON Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª in-stream.



---

9 â€” PrefsObfuscator (Ù…Ù‚ØªØ±Ø­ ØªÙ†ÙÙŠØ° Java7)

(Ø£Ø¯Ø±Ø¬Øª ÙƒØ§Ù‚ØªØ±Ø§Ø­ ÙÙŠ Ù…ÙˆØ§ØµÙØ§ØªÙƒØ› Ø§Ø­ØªÙØ¸ Ø¨Ù‡ ÙƒÙ…Ø§ Ù‡Ùˆ â€” Ù…Ø«Ø§Ù„ XOR Ù…Ø­ÙÙˆØ¸ ÙÙŠ utils/PrefsObfuscator.java).


---

10 â€” Ø£Ù…Ø«Ù„Ø© I/O ØªÙˆØ¶ÙŠØ­ÙŠØ© (Ø­Ø§Ù„Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…)

HomeFragment Input:


{ "prompt":"Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø±Ø­Ù„Ø© ØµØ­Ø±Ø§ÙˆÙŠØ©", "selected_model":"meta-llama/Llama-3.2-1B-Instruct", "use_gemini":false }

HomeFragment Output: Ù…Ø¬Ù„Ø¯ Ù…Ø´Ø±ÙˆØ¹ ÙŠØ­ØªÙˆÙŠ script.txt, frames/, audio/, final_burned.mp4, Ùˆ/agent_results/orchestrator_log.json.



---

11 â€” FFmpeg / Subtitles (ØªÙ†ÙÙŠØ°ÙŠØ©)

ØªÙØ¶ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… ASS Ø¥Ø°Ø§ ÙƒØ§Ù† libass Ù…ØªØ§Ø­Ù‹Ø§:


ffmpeg -i /path/input.mp4 -vf "subtitles=/path/subs.ass:fontsdir=/storage/emulated/0/AIAutoCreate/fonts" -c:a copy /path/final_burned.mp4

Fallback: drawtext Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… fontfile, box, Ùˆshadow Ø¥Ø°Ø§ libass ØºÙŠØ± Ù…ØªÙˆÙÙ‘Ø±.



---

12 â€” Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù‚Ø¨ÙˆÙ„ (Acceptance tests â€” Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°)

1. Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙŠØ¨Ù†Ù‰ ÙÙŠ AIDE Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ (Java7).


2. HomeFragment Full Automatic ÙŠÙˆÙ„Ù‘Ø¯ Ù…Ø®Ø±Ø¬Ø§Øª ÙÙŠ /projects/ Ùˆ/agent_results/ØŒ ÙŠØ¹Ù…Ù„ Ø¨ÙˆØ¬ÙˆØ¯/ØºÙŠØ§Ø¨ Gemini key.


3. ModelsManager: Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ + Test Connection Ù†Ø§Ø¬Ø­.


4. FFmpegKit: ØªÙ†ÙÙŠØ° command Ø¨Ù†Ø¬Ø§Ø­ (exit code 0) ÙˆØ³Ø¬Ù„ ÙÙŠ orchestrator_log.json.


5. Resource cleanup: Ø¥ØºÙ„Ø§Ù‚ TestFragment ÙŠÙ†Ø§Ø¯ÙŠ stopPlayback()/release()/recycle().


6. SanityCheckAgent ÙŠÙˆÙ„Ù‘Ø¯ /agent_results/sanity_check.json.


7. Ø²Ø± Test Run Ù„ÙƒÙ„ Agent ÙŠØ¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©.


8. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ØªØ³ØªØ®Ø¯Ù… LinearLayout Ø¯Ø§Ø®Ù„ ScrollView â€” Ù„Ø§ RecyclerView.


9. Subtitles: ØªØºÙŠÙŠØ±Ø§Øª SubtitleStyle ØªÙØ·Ø¨Ù‘Ù‚ ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ¹Ù†Ø¯ Ø§Ù„Ø­Ø±Ù‚.




---

13 â€” Ù†Ù‚Ø§Ø· ØªÙ†ÙÙŠØ°ÙŠØ©/Ù‡Ù†Ø¯Ø³ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ù…Ù„ÙˆØ¡Ø©/Ù…Ù‚ØªØ±Ø­Ø©)

Retry/backoff: 3 attempts (1000ms,2000ms,4000ms).

Timeouts: connect=10s, read=30s.

Logging: ÙƒÙ„ Agent ÙŠÙƒØªØ¨ JSON: status, message, timestamp, duration_ms, outputs[]. Ø§Ø³ØªØ®Ø¯Ù… JSONLogger Ù…Ø¹ synchronized file writes.

Disk quota check Ù‚Ø¨Ù„ Ø¹Ù…Ù„ÙŠØ§Øª ÙƒØ¨ÙŠØ±Ø©ØŒ ÙˆØ­Ø¸Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ù† ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© < 500MB Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ¯Ø©.

Project naming: proj_YYYYMMDD_HHMMSS_<rand> Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§Ø±Ø¶.

Retention: Ø§Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± 50 Ù†ØªÙŠØ¬Ø© Agent Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ØŒ ØªÙ†Ø¸ÙŠÙ Ù‚Ø¯ÙŠÙ… ÙÙŠ /temp/.

ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ: Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© ØµØ±ÙŠØ­Ø© Ù‚Ø¨Ù„ Ø±ÙØ¹ Ø¹ÙŠÙ†Ø§Øª ØµÙˆØª Ù„Ù„Ù€ voice cloning. Ø°ÙƒØ± Ø£Ù† PrefsObfuscator Ù„ÙŠØ³ Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ø¹Ù† ØªØ´ÙÙŠØ± Ù‚ÙˆÙŠ.



---

14 â€” Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ (Ù…ÙÙ„Ø²ÙÙ…Ø©)

services/ProcessingService.java (ForegroundService orchestration + notifications + checkpointing).

utils/NotificationUtils.java (Ù‚Ù†ÙˆØ§Øª Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŒ Ø¨Ù†Ø§Ø¡ NotificationCompat Ù…Ø¹ actions).

utils/JSONLogger.java (append/write JSON Ø¨Ø·Ø±ÙŠÙ‚Ø© thread-safe).

config/background_tasks.json (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø¯ÙˆÙ„Ø©).

config/notification_texts.json (ar/en strings).



---

15 â€” Ù…Ø®Ø±Ø¬Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© (Ø¥ØªØ§Ø­Ø© ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨)

Ø£Ù†Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø¢Ù† ØªÙˆÙ„ÙŠØ¯ Ø£ÙŠ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙƒÙ…Ù„ÙØ§Øª Ø´ÙØ±Ø© ÙƒØ§Ù…Ù„Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ / ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ canvas:

HFClient.java (Java7 compatible).

FFmpegRunner.java (Ø´ÙŠÙ„ Ø£Ùˆ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù„FFmpegKit).

ProcessingService.java skeleton ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆBroadcasts.

JSONLogger.java ÙˆPrefsObfuscator.java.

models_default.json ÙƒØ§Ù…Ù„.

README Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ AIDE ÙˆØ¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø§Øª FFmpegKit.


> Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø£ÙŠ Ù…Ù„Ù Ø£Ùˆ Ù…Ù„ÙØ§Øª ØªØ±ÙŠØ¯ Ø£Ù† Ø£Ø¯Ø±Ø¬Ù‡Ø§ Ø§Ù„Ø¢Ù† ÙƒÙ…Ù„ÙØ§Øª Ø´ÙØ±Ø© ÙƒØ§Ù…Ù„Ø© (Ø³Ø£Ø¶Ø¹Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ù…Ù„Ù/Ù‚Ø§Ù„Ø¨ code Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ø³Ø® ÙÙˆØ±Ù‹Ø§).
Ø¥Ù† Ù„Ù… ØªÙØ·Ù„ÙØ¨ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¢Ù† â€” Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ø³Ø® Ø§Ù„ÙÙˆØ±ÙŠ Ø¥Ù„Ù‰ Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ù„ÙƒÙˆØ¯.




---

16 â€” ÙˆØ³ÙˆÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„ØªÙŠ Ø£Ø¯Ø±Ø¬ØªÙ‡Ø§ (Ù„Ù„Ù…Ù‡Ù†Ø¯Ø³/Ø§Ù„Ù…Ø·ÙˆÙ‘ÙØ±)

[ØªÙƒÙ…Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©] â€” ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø± checkpoints/ØŒ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©.

[Ù…Ù‚ØªØ±Ø­ ØªØ­Ø³ÙŠÙ† Ø¯Ù‚Ù‘Ø©] â€” HFClient ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¯Ø¹Ù… multipart + timeouts + retries.

[Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù…Ø§Ù†] â€” ØªÙ†Ø¨ÙŠÙ‡ ØµØ±ÙŠØ­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø®ØµÙˆØµ PrefsObfuscator ÙˆÙ…ÙˆØ§ÙÙ‚Ø© voice-cloning.

Ø§ÙŠØ¶Ø¢ Ù„Ø§ Ù†ØªØ³Ø§Ø¡ Ø§Ù† ØªÙ‚ÙˆÙ… Ø¨Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù„ØªÙŠ ØªØ­ØªØ§Ø¬Ù‡ ÙÙŠ Ø§ÙƒÙˆØ§Ø¯ Ù…Ù„Ù build.gradle

---

17 - Ø§Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù‰ Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª 
Ù…Ø«Ù„ ØªØºÙŠÙŠØ± Ù„ØºØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù„ØºØªÙŠÙ† ÙÙ‚Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ùˆ Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù„Ø§ ØºÙŠØ± Ùˆ Ø§ÙŠØ¶Ø¢ Ø§Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© ØªØºÙŠÙŠØ± Ø§Ù„ØªØ³Ù… Ù…Ù† Ø§Ù„ÙØ§ØªØ­ Ø§Ù„Ù‰ Ø§Ù„Ø¯Ø§ÙƒÙ† Ø§Ùˆ Ø§Ù„Ø¹ÙƒØ³ Ø§Ùˆ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù….

---

18 - Ùˆ Ø§Ù„ÙŠÙƒ Ù†Ø¨Ø²Ø° Ø§Ù† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠÙ‡ Ùˆ ØµÙØ­Ø© Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ Ùˆ ØµÙØ­Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© ÙŠØ¬Ø¨ Ø§Ù† ØªÙƒÙˆÙ† ØªØ¹Ù…Ù„ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ùˆ Ù„ÙƒÙŠÙ† ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø± Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ùˆ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø§ÙƒÙˆØ§Ø¯ Ø§Ù„Ø§Ø­Ø¯Ø« Ø¨Ø¯Ù„ Ø§Ù„Ø§ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø© Ùˆ Ø§ÙƒØ«Ø± Ø§Ù…Ø§Ù†Ø¢ Ùˆ Ù„ÙƒÙŠÙ† ÙŠØ¬Ø¨ Ø§Ù† ØªÙ„ØªØ²Ù… Ø¨ØªÙˆØ§ÙÙ‚Ù‡ Ù…Ø¹ Ø¨Ø±Ù†Ø§Ù…Ø¬ AIDE Ùˆ java 7 .


1 - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© 

fragment_home.xml -
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/frag_root"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@drawable/bg"
    android:padding="15dp"
    android:layoutDirection="rtl">

    <!-- Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©: Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… -->
    <LinearLayout
        android:id="@+id/top_options"
        android:orientation="vertical"
        android:layout_width="match_parent"
        android:layout_height="wrap_content">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/sp_image_style"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/spinner_box" />
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:layout_marginLeft="55dp"/>
        </LinearLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/sp_cover_style"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/spinner_box" />
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØºÙ„Ø§Ù"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:layout_marginLeft="55dp"/>
        </LinearLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/sp_voice"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/spinner_box" />
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØª"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:layout_marginLeft="108dp"/>
        </LinearLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/sp_video_style"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/spinner_box"/>
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù„ÙˆØ¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:layout_marginLeft="53dp"/>
        </LinearLayout>

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/sp_montage"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/spinner_box"/>
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:layout_marginLeft="46dp"/>
        </LinearLayout>

        <LinearLayout
            android:id="@+id/ll_status"
            android:layout_width="match_parent"
            android:layout_height="48dp"
            android:orientation="horizontal"
            android:gravity="center_vertical|right"
            android:layout_marginTop="8dp"
            android:visibility="gone">

            <ProgressBar
                android:id="@+id/pb_small"
                style="?android:attr/progressBarStyleSmall"
                android:layout_width="24dp"
                android:layout_height="24dp"
                android:indeterminate="true"
                android:layout_marginRight="8dp" />

            <TextView
                android:id="@+id/tv_inline_status_small"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©..."
                android:textColor="@color/muted_text"
                android:textSize="14sp" />
        </LinearLayout>
    </LinearLayout>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙˆÙ‚ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù€ prompt -->
    <ScrollView
        android:id="@+id/main_scroll"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:fillViewport="true"
        android:overScrollMode="ifContentScrolls"
        android:layout_below="@id/top_options"
        android:layout_above="@+id/prompt_holder">

        <LinearLayout
            android:orientation="vertical"
            android:layout_width="match_parent"
            android:layout_height="wrap_content">

            <TextView
                android:id="@+id/tv_logs"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Logs"
                android:textColor="@color/highlight_color"
                android:layout_marginBottom="12dp"
                android:textSize="16sp" />

            <VideoView
                android:id="@+id/video_preview"
                android:layout_width="match_parent"
                android:layout_height="200dp"
                android:visibility="gone" />
        </LinearLayout>
    </ScrollView>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø­Ù‚Ù„: ØªØ¨Ù‚Ù‰ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ÙØ±Ø§Ø¬Ù…Ù†Øª ÙˆØªØªØ­Ø±Ùƒ Ù…Ø¹ Ø§Ø¹Ø§Ø¯Ø© ØªØ­Ø¬ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© (adjustResize) -->
    <RelativeLayout
        android:id="@+id/prompt_holder"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_alignParentBottom="true"
        android:layout_marginTop="10dp"
        android:paddingTop="6dp"
        android:paddingBottom="6dp"
        android:background="#000000">

        <EditText
            android:id="@+id/et_prompt"
            android:layout_width="300dp"
            android:layout_height="48dp"
            android:background="@drawable/outline_border"
            android:hint="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..."
            android:paddingLeft="12dp"
            android:paddingRight="12dp"
            android:textColor="@color/highlight_color" />

        <TextView
            android:id="@+id/tv_inline_status"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨..."
            android:textColor="@color/muted_text"
            android:layout_alignParentRight="true"
            android:layout_marginRight="100dp"
            android:layout_marginTop="15dp"
            android:visibility="gone" />

        <Button
            android:id="@+id/btn_go"
            android:layout_width="@dimen/circle_button_size"
            android:layout_height="@dimen/circle_button_size"
            android:layout_alignParentRight="true"
            android:layout_marginRight="0dp"
            android:layout_marginLeft="2dp"
            android:background="@drawable/circle_button"
            android:text="Go"
            android:textColor="@color/highlight_color" />
    </RelativeLayout>
</RelativeLayout>

HomeFragment.java -
package com.example.aiautocreate;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.provider.Settings;
import android.support.v4.app.Fragment;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.ScaleAnimation;
import android.view.inputmethod.InputMethodManager;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.ProgressBar;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;
import android.widget.VideoView;

import org.json.JSONArray;
import org.json.JSONObject;

import java.io.File;
import java.io.FileOutputStream;
import java.util.List;
import java.util.ArrayList;

/**
 * HomeFragment - Ultra-Full Literal Final
 * AIDE-friendly / Java7
 *
 * - ÙŠØ±Ø³Ù„ Ø§Ù„Ù†Øµ + Ø§Ù„ÙˆÙ‚Øª + Ø§Ù„Ø¬ÙˆØ¯Ø© + Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙƒÙ†Øµ ÙˆØ§Ø¶Ø­ Ù…Ø¹ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù„Ù€ Gemini
 * - ÙŠØ­ÙØ¸ Ø§Ù„Ù†Ø§ØªØ¬ ÙƒØ§Ù…Ù„Ø§Ù‹ (SCRIPTS + MSHHD/HAREKA + SSML + SSH)
 * - Parsing Ù…Ø±Ù† ÙŠØ¯Ø¹Ù… Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ù€ JSON Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
 * - Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© + Ø¢Ø®Ø± Ø¨Ø±ÙˆÙ…Ø¨Øª
 * - Ø®ÙŠØ§Ø± ØµÙˆØª Ø«Ø§Ø¨Øª "Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¹ÙŠÙ†Ø© (Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)"
 * - Bootstrap Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Øª + Ø¯Ù…Ø¬ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù‚Ø¨Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
 */
public class HomeFragment extends Fragment implements PipelineManager.Callback {

    private static final String TAG = "HomeFragment";

    // Ù…ÙØ§ØªÙŠØ­ Ø­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø± Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
    private static final String K_UI_IMAGE_STYLE  = "ui_image_style";
    private static final String K_UI_COVER_STYLE  = "ui_cover_style";
    private static final String K_UI_VOICE_CHOICE = "ui_voice_choice";
    private static final String K_UI_VIDEO_STYLE  = "ui_video_style";
    private static final String K_UI_MONTAGE      = "ui_montage_style";
    private static final String K_UI_LAST_PROMPT  = "ui_last_prompt";

    // Ø®ÙŠØ§Ø± Ø«Ø§Ø¨Øª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆØ§Øª Ù„Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¹ÙŠÙ†Ø©
    public static final String VOICE_CLONE_OPTION = "Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¹ÙŠÙ†Ø© (Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)";

    private EditText etPrompt;
    private Button btnGo;
    private TextView tvLogs, tvInlineStatus, tvInlineStatusSmall;
    private VideoView videoPreview;
    private LinearLayout llStatus;
    private ProgressBar pbSmall;

    private Spinner spImageStyle, spCoverStyle, spVoice, spVideoStyle, spMontage;
    private boolean isProcessing = false;
    private PrefManager prefs;

    private final BroadcastReceiver modelsUpdatedReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            if (Constants.ACTION_MODELS_UPDATED.equals(intent.getAction())) {
                if (tvLogs != null) tvLogs.append("ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n");
                buildSpinners();
            }
        }
    };

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View v = inflater.inflate(R.layout.fragment_home, container, false);
        prefs = new PrefManager(getActivity());
        // Bootstrap Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Øª + Ù…Ø¬Ù„Ø¯Ø§Øª
        try { prefs.bootstrapDefaults(); } catch (Throwable ignored) {
            prefs.ensureModelListsDefaults();
            prefs.ensureGeneralStylesDefaults();
            prefs.ensureDefaultDirsExist();
        }
        checkAndRequestAllFilesAccess();

        // Ø±Ø¨Ø· Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        etPrompt        = (EditText) v.findViewById(R.id.et_prompt);
        btnGo           = (Button) v.findViewById(R.id.btn_go);
        tvLogs          = (TextView) v.findViewById(R.id.tv_logs);
        videoPreview    = (VideoView) v.findViewById(R.id.video_preview);
        llStatus        = (LinearLayout) v.findViewById(R.id.ll_status);
        pbSmall         = (ProgressBar) v.findViewById(R.id.pb_small);
        tvInlineStatus  = (TextView) v.findViewById(R.id.tv_inline_status);
        tvInlineStatusSmall = (TextView) v.findViewById(R.id.tv_inline_status_small);

        spImageStyle    = (Spinner) v.findViewById(R.id.sp_image_style);
        spCoverStyle    = (Spinner) v.findViewById(R.id.sp_cover_style);
        spVoice         = (Spinner) v.findViewById(R.id.sp_voice);
        spVideoStyle    = (Spinner) v.findViewById(R.id.sp_video_style);
        spMontage       = (Spinner) v.findViewById(R.id.sp_montage);

        buildSpinners();

        if (btnGo != null) {
            btnGo.setOnClickListener(new View.OnClickListener() {
                    public void onClick(View v) {
                        animateButtonPress(btnGo);
                        if (!isProcessing) {
                            String text = (etPrompt != null) ? etPrompt.getText().toString().trim() : "";
                            if (text.length() == 0) {
                                Toast.makeText(getActivity(), "Ø£Ø¯Ø®Ù„ Ù†Øµ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡", Toast.LENGTH_SHORT).show();
                                return;
                            }
                            if (getActivity() instanceof MainActivity) {
                                if (!((MainActivity) getActivity()).ensureNetworkBeforeStart()) return;
                            }

                            // Ø§Ø­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© + Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª
                            persistUiSelections();
                            hideKeyboard();

                            // Ø¬Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Øª + Ø§Ù„Ø¬ÙˆØ¯Ø© + Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù…Ù† FFmpegFragment
                            SharedPreferences ffmpegPrefs = getActivity().getSharedPreferences("ffmpeg_prefs", Context.MODE_PRIVATE);
                            String style = ffmpegPrefs.getString("last_selected_style", "Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");
                            String prefix = "profile_" + style + "_";

                            String minutes = ffmpegPrefs.getString(prefix + "minutes", "01");
                            String seconds = ffmpegPrefs.getString(prefix + "seconds", "00");
                            String aspect  = ffmpegPrefs.getString(prefix + "aspect",  "16:9");
                            String quality = ffmpegPrefs.getString(prefix + "quality", "1080p");

                            String durationDesc = minutes + " Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ " + seconds + " Ø«Ø§Ù†ÙŠØ©";

                            // ===== Ø¨Ù†Ø§Ø¡ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø´Ø§Ù…Ù„ ÙˆÙ…Ù†Ø¸Ù… Ù…Ø¹ Ø§Ù„Ø±Ù…ÙˆØ² =====
                            StringBuilder sb = new StringBuilder();

// Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                            sb.append("Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ").append(text).append("\n\n");

// Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©
                            sb.append("Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: ").append(durationDesc).append("\n");
                            sb.append("Ø§Ù„Ø¬ÙˆØ¯Ø©: ").append(quality).append("\n");
                            sb.append("Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ").append(aspect).append("\n");

// Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù„ØºØ©
                            sb.append("- Ù„ØºØ© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‚ØµØ© Ø£Ùˆ Ø§Ù„Ø§Ø³ÙƒØ±Ø¨Øª ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø¨Ù‡Ø§ Ù†Øµ Ø§Ù„Ø·Ù„Ø¨.\n");

// Ù‚ÙˆØ§Ø¹Ø¯ SSML
                            sb.append("Ø§Ù„Ø¢Ù† Ø¨Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‚ØµØ© ÙƒØ§Ù…Ù„Ø©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ®Ø±ÙØ¬ Ù†Ø³Ø®Ø© Ø£Ø®Ø±Ù‰ Ø¨ØµÙŠØºØ© SSML Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙˆØª.\n");
                            sb.append("- ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù†Øµ Ø¨Ù€ <speak> ÙˆÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ </speak>.\n");
                            sb.append("- Ø§Ø³ØªØ®Ø¯Ù… <voice name=\"Narrator\"> ... </voice> Ù„Ù„Ø±Ø§ÙˆÙŠ.\n");
                            sb.append("- Ù„ÙƒÙ„ Ø´Ø®ØµÙŠØ© Ø£Ø®Ø±Ù‰ Ø§Ø³ØªØ®Ø¯Ù… <voice name=\"Character1\"> ... </voice>, <voice name=\"Character2\"> ... </voice> ÙˆÙ‡ÙƒØ°Ø§.\n");
                            sb.append("- Ø¶Ø¹ Ø§Ù„Ù†Øµ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù…ÙˆØ² ğŸµ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„ÙŠÙØ³Ù‡Ù‘Ù„ ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† SSML.\n");
                            sb.append("- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±Ø§ÙˆÙŠ ÙÙ‚Ø· â†’ Ø§Ù„Ù…Ù„Ù Ø§Ø³Ù…Ù‡ SCRIPTS_SSML.\n");
                            sb.append("- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±Ø§ÙˆÙŠ + Ø´Ø®ØµÙŠØ§Øª:\n");
                            sb.append("   * Ø§Ù„Ø±Ø§ÙˆÙŠ â†’ SCRIPTS_SSML (ğŸµ<speak><voice name=\"Narrator\">...</voice></speak>ğŸµ).\n");
                            sb.append("   * Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ â†’ SCRIPTS_SSML_V1 (ğŸµ<speak><voice name=\"Character1\">...</voice></speak>ğŸµ).\n");
                            sb.append("   * Ø§Ù„Ø«Ø§Ù†ÙŠØ© â†’ SCRIPTS_SSML_V2ØŒ ÙˆÙ‡ÙƒØ°Ø§.\n");
                            sb.append("- Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ø±Ø§ÙˆÙŠ ÙˆØ´Ø®ØµÙŠØ© ÙˆØ§Ø­Ø¯Ø© â†’ Ø§Ù„Ø±Ø§ÙˆÙŠ ÙŠÙˆØ¶Ø¹ ÙÙŠ SCRIPTS_SSMLØŒ ÙˆØ§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ SCRIPTS_SSML_V1.\n");
                            sb.append("- Ø±Ø§Ø¹Ù Ø£Ù† Ø·ÙˆÙ„ Ø§Ù„Ù†Øµ Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„ÙƒÙ„ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†Ø§Ø³Ø¨ Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: "+durationDesc+".\n");

// Ù…Ø«Ø§Ù„ ØµØºÙŠØ± Ø¹Ù„Ù‰ SSML Ø§Ù„ØµØ­ÙŠØ­
                            sb.append("Ù…Ø«Ø§Ù„ SSML:\n");
                            sb.append("ğŸµ\n");
                            sb.append("<speak xml:lang=\"ar-SA\">\n");
                            sb.append("  <voice name=\"Narrator\">ÙÙŠ Ù…Ø®ØªØ¨Ø± ÙŠØ¹Ø¬ Ø¨Ø§Ù„ÙÙˆØ¶Ù‰...</voice>\n");
                            sb.append("  <break time=\"300ms\"/>\n");
                            sb.append("  <voice name=\"Adham\">Ù„Ù† Ø£Ø³ØªØ³Ù„Ù…! Ù‡Ø°Ø§ Ø§Ø®ØªØ±Ø§Ø¹ÙŠ Ø³ÙŠØ¹Ù…Ù„.</voice>\n");
                            sb.append("</speak>\n");
                            sb.append("ğŸµ\n");

// Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                            sb.append("- ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ù‚ØµØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØµØ§ÙÙŠØ§Ù‹ Ø¨Ø§Ø³Ù… SCRIPTS_SSH.\n");
                            sb.append("- Ù…Ù„Ù SCRIPTS_SSH ÙŠÙˆØ¶Ø¹ ÙÙˆÙ‚ Ù†ØµÙˆØµ SCRIPTS_SSML Ù…Ø¨Ø§Ø´Ø±Ø©.\n");

// Ù‚ÙˆØ§Ø¹Ø¯ ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ ÙˆØ§Ù„Ø­Ø±ÙƒØ§Øª
                            sb.append("- Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ ØªØ³Ù…Ù‰ Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„: MSHHD1ØŒ MSHHD2 ... Ø¥Ù„Ø®.\n");
                            sb.append("- ÙƒÙ„ Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ø®ØµØµ Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ù…Ø´Ù‡Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø­ØµÙˆØ±Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù…Ø²ÙŠÙ† ğŸ˜¶ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©.\n");
                            sb.append("- Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ ØªØ³Ù…Ù‰ Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„: HAREKA1ØŒ HAREKA2 ... Ø¥Ù„Ø®.\n");
                            sb.append("- ÙƒÙ„ Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ø®ØµØµ Ù„ØªØ­Ø±ÙŠÙƒ Ù…Ø´Ù‡Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø­ØµÙˆØ±Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù…Ø²ÙŠÙ† ğŸ¥± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©.\n");

// Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù„ØºØ© Ù„Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª
                            sb.append("- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± ÙˆØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙƒØªÙˆØ¨Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.\n");

// Ø§Ù„Ø´Ø®ØµÙŠØ§Øª
                            sb.append("- Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯Øª Ø´Ø®ØµÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ¹Ø·Ù‰ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø«Ø§Ø¨Øª ÙˆÙ…ØªØ³Ù‚ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…Ù„Ø§Ù…Ø­Ù‡Ø§ ÙˆØ³Ù„ÙˆÙƒÙ‡Ø§. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ´Ù…Ù„ Ø§Ù„ÙˆØµÙ Ø¹Ù†Ø§ØµØ± Ù…Ø«Ù„ Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØŒ Ø§Ù„Ø³Ù…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ù†Ø¨Ø±Ø© Ø§Ù„Ø­Ø¯ÙŠØ«ØŒ ÙˆØ­Ø±ÙƒØ§Øª Ø£Ùˆ Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ù…ÙŠØ²Ø© ØªÙØ³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯.\n");
                            sb.append("- Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯Øª Ø£ÙƒØ«Ø± Ù…Ù† Ø´Ø®ØµÙŠØ©: Ù„ÙƒÙ„ Ø´Ø®ØµÙŠØ© Ø£Ø¹Ø¯ Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ù†ÙØµÙ„ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø£ÙŠØ¶Ø§Ù‹ØŒ ÙŠÙˆØ¶Ø­ Ù‡ÙˆÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ®Ù„ÙÙŠØªÙ‡Ø§ØŒ Ù„Ù‡Ø¬ØªÙ‡Ø§ Ø£Ùˆ Ù†Ø¨Ø±ØªÙ‡Ø§ØŒ Ø³Ù…Ø§ØªÙ‡Ø§ Ø§Ù„Ù†ÙØ³ÙŠØ© ÙˆØ³Ù„ÙˆÙƒÙ‡Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯.\n");

// ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù‚ØµØ© Ø¥Ù„Ù‰ Ù…Ø´Ø§Ù‡Ø¯
                            sb.append("- Ù‚Ø³Ù‘Ù… Ø§Ù„Ù‚ØµØ© Ø¥Ù„Ù‰ Ù…Ø´Ø§Ù‡Ø¯.\n");
                            sb.append("- ÙƒÙ„ Ù…Ø´Ù‡Ø¯ ÙŠØªØ¶Ù…Ù†:\n");
                            sb.append("   * Ù†Øµ Ø§Ù„Ù…Ø´Ù‡Ø¯ (Ø¨Ù„ØºØ© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ø·Ù„Ø¨).\n");
                            sb.append("   * Ø¨Ø±ÙˆÙ…Ø¨Øª ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù…Ø­ØµÙˆØ±Ø§Ù‹ Ø¨ÙŠÙ† ğŸ˜¶...ğŸ˜¶ ÙˆØ¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆÙŠØ¬Ø¨ Ø§Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…ÙØµÙ„ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆÙŠØ¬Ø¨ Ø§Ù† ÙŠÙƒÙˆÙ† Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø­Ø±Ù Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø© ÙÙŠÙ‡ Ù…Ø§ Ø¨ÙŠÙ† 1200 Ø§Ù„Ù‰ 1500 Ø­Ø±Ù ÙˆÙ„Ø§ ÙŠÙ‚Ù„ Ø¹Ù† Ø°Ø§Ù„Ùƒ Ø§Ø¨Ø¯Ø¢.\n");
                            sb.append("   * Ø¨Ø±ÙˆÙ…Ø¨Øª Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø´Ù‡Ø¯ Ù…Ø­ØµÙˆØ±Ø§Ù‹ Ø¨ÙŠÙ† ğŸ¥±...ğŸ¥± ÙˆØ¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆÙŠØ¬Ø¨ Ø§Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…ÙØµÙ„ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ.\n");

// ===== ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ù†Øµ Ù†Ù‡Ø§Ø¦ÙŠ =====
                            String finalPrompt = sb.toString();
                            
                            String gemKey = prefs.getGeminiKey();
                            if (gemKey != null && gemKey.length() > 0) {
                                callGeminiGenerate(finalPrompt);
                            } else {
                                if (tvLogs != null) tvLogs.append("â­ Gemini: Ù„Ø§ Ù…ÙØªØ§Ø­.\n");
                                startProcessing(finalPrompt, false);
                            }
                        } else {
                            cancelProcessing();
                        }
                    }
                });
        }
        return v;
    }

    // Ø¥Ø°Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Android11+
    private void checkAndRequestAllFilesAccess(){
        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.R){
            try {
                if(!android.os.Environment.isExternalStorageManager()){
                    Toast.makeText(getActivity(),"âš  Ø§Ù…Ù†Ø­ Ø¥Ø°Ù† Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª",Toast.LENGTH_LONG).show();
                    Intent i=new Intent(Settings.ACTION_MANAGE_APP_ALL_FILES_ACCESS_PERMISSION);
                    i.setData(Uri.parse("package:" + getActivity().getPackageName()));
                    startActivity(i);
                }
            }catch(Exception ex){
                try{
                    Intent i=new Intent(Settings.ACTION_MANAGE_ALL_FILES_ACCESS_PERMISSION);
                    startActivity(i);
                }catch(Exception ignored){}
            }
        }
    }

    // Ø¨Ù†Ø§Ø¡ Spinners (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªÙ†Ø³Ø§Ø® + Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±Ø§Øª)
    private void buildSpinners() {
        if (getActivity() == null) return;

        // ØªØ£ÙƒÙŠØ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© + ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        prefs.ensureModelListsDefaults();
        prefs.ensureSelectedModelsInLists();
        StylePacks.registerIntoPrefs(prefs);

        List<String> imgStyles = prefs.csvToList(prefs.getModelStyles("image_styles"));
        if(imgStyles.isEmpty()){ imgStyles.add("ÙˆØ§Ù‚Ø¹ÙŠ"); imgStyles.add("ÙƒØ±ØªÙˆÙ†ÙŠ"); }
        setSpinnerAdapter(spImageStyle,imgStyles);

        List<String> coverStyles = prefs.csvToList(prefs.getModelStyles("cover_styles"));
        if(coverStyles.isEmpty()){ coverStyles.add("ØºÙ„Ø§Ù Ø¨Ø³ÙŠØ·"); coverStyles.add("ØºÙ„Ø§Ù Ù…Ù„ÙˆÙ†"); }
        setSpinnerAdapter(spCoverStyle,coverStyles);

        String ttsModel = prefs.getSelectedTtsModel();
        if(ttsModel == null || ttsModel.indexOf('/') < 0){ ttsModel = prefs.getTtsModelId(); }
        List<String> voiceStyles = prefs.csvToList(prefs.getModelVoices(ttsModel));
        if(!voiceStyles.contains(VOICE_CLONE_OPTION)) {
            List<String> tmp = new ArrayList<String>();
            tmp.add(VOICE_CLONE_OPTION);
            for(int i=0;i<voiceStyles.size();i++) tmp.add(voiceStyles.get(i));
            voiceStyles = tmp;
        }
        if(voiceStyles.isEmpty()){ voiceStyles.add("ØµÙˆØª1"); voiceStyles.add("ØµÙˆØª2"); }
        setSpinnerAdapter(spVoice,voiceStyles);

        List<String> videoStyles = prefs.csvToList(prefs.getModelStyles("video_styles"));
        if(videoStyles.isEmpty()){ videoStyles.add("Ø¯Ø±Ø§Ù…ÙŠ"); videoStyles.add("Ø§ÙƒØ´Ù†"); }
        setSpinnerAdapter(spVideoStyle,videoStyles);

        List<String> montageStyles = prefs.csvToList(prefs.getModelStyles("montage_styles"));
        if(montageStyles.isEmpty()){
            montageStyles=new ArrayList<String>();
            montageStyles.add("Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");
            montageStyles.add("Ø­Ù…Ø§Ø³ÙŠ ÙˆØ¬Ø°Ø§Ø¨");
            montageStyles.add("Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙˆØ£Ù†ÙŠÙ‚");
            montageStyles.add("Ù…Ø®ØµØµ");
        }
        setSpinnerAdapter(spMontage,montageStyles);

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
        selectSpinnerValue(spImageStyle,  prefs.getSelection(K_UI_IMAGE_STYLE,  imgStyles.size()>0? imgStyles.get(0):""));
        selectSpinnerValue(spCoverStyle,  prefs.getSelection(K_UI_COVER_STYLE,  coverStyles.size()>0? coverStyles.get(0):""));
        selectSpinnerValue(spVoice,       prefs.getSelection(K_UI_VOICE_CHOICE, voiceStyles.size()>0? voiceStyles.get(0):""));
        selectSpinnerValue(spVideoStyle,  prefs.getSelection(K_UI_VIDEO_STYLE,  videoStyles.size()>0? videoStyles.get(0):""));
        selectSpinnerValue(spMontage,     prefs.getSelection(K_UI_MONTAGE,      montageStyles.size()>0? montageStyles.get(0):""));

        if(etPrompt != null){
            String lastPrompt = prefs.getSelection(K_UI_LAST_PROMPT, "");
            if(lastPrompt.length()>0) etPrompt.setText(lastPrompt);
        }
    }

    private void setSpinnerAdapter(Spinner sp, List<String> items){
        if(getActivity()==null || sp==null) return;
        ArrayAdapter<String> adapter = new ArrayAdapter<String>(getActivity(),
                                                                android.R.layout.simple_spinner_item, items);
        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        sp.setAdapter(adapter);
    }

    private void selectSpinnerValue(Spinner sp,String val){
        if(sp==null||val==null)return;
        for(int i=0;i<sp.getCount();i++){
            Object o=sp.getItemAtPosition(i);
            if(o!=null && val.equals(o.toString())){ sp.setSelection(i); return;}
        }
    }

    private void persistUiSelections() {
        if(spImageStyle!=null && spImageStyle.getSelectedItem()!=null)
            prefs.saveSelection(K_UI_IMAGE_STYLE, spImageStyle.getSelectedItem().toString());
        if(spCoverStyle!=null && spCoverStyle.getSelectedItem()!=null)
            prefs.saveSelection(K_UI_COVER_STYLE, spCoverStyle.getSelectedItem().toString());
        if(spVoice!=null && spVoice.getSelectedItem()!=null)
            prefs.saveSelection(K_UI_VOICE_CHOICE, spVoice.getSelectedItem().toString());
        if(spVideoStyle!=null && spVideoStyle.getSelectedItem()!=null)
            prefs.saveSelection(K_UI_VIDEO_STYLE, spVideoStyle.getSelectedItem().toString());
        if(spMontage!=null && spMontage.getSelectedItem()!=null)
            prefs.saveSelection(K_UI_MONTAGE, spMontage.getSelectedItem().toString());
        if(etPrompt != null)
            prefs.saveSelection(K_UI_LAST_PROMPT, etPrompt.getText().toString());
    }

    // ğŸ”¥ Gemini API Call
    private void callGeminiGenerate(final String promptText) {
        new Thread(new Runnable() {
                public void run() {
                    try {
                        String endpoint = prefs.getGeminiEndpointOrDefault();
                        String apiKey   = prefs.getGeminiKey();

                        // Ø¨Ù†Ø§Ø¡ JSON
                        JSONObject payload = new JSONObject();
                        JSONArray contents = new JSONArray();
                        JSONObject contentObj = new JSONObject();
                        JSONArray parts = new JSONArray();
                        JSONObject part = new JSONObject();
                        part.put("text", promptText);
                        parts.put(part);
                        contentObj.put("parts", parts);
                        contents.put(contentObj);
                        payload.put("contents", contents);

                        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API
                        String response = ApiClient.postJson(endpoint, apiKey, payload.toString());
                        Log.i(TAG, "Gemini RAW Response = " + response);

                        final String generated = parseGeminiResponse(response);

                        if (getActivity() == null) return;
                        getActivity().runOnUiThread(new Runnable() {
                                public void run() {
                                    if (generated != null && generated.length() > 0) {
                                        saveAndBroadcastScript(generated);
                                        startProcessing(promptText, true);
                                    } else {
                                        if (tvLogs != null) tvLogs.append("âš  Gemini Ù„Ù… ÙŠØ±Ø¬Ø¹ Ù†Øµ.\n");
                                        startProcessing(promptText, false);
                                    }
                                }
                            });
                    } catch (final Exception e) {
                        if (getActivity() == null) return;
                        getActivity().runOnUiThread(new Runnable() {
                                public void run() {
                                    if (tvLogs != null) tvLogs.append("âš  Ø®Ø·Ø£ Gemini: " + e.getMessage()+"\n");
                                    startProcessing(promptText,false);
                                }
                            });
                    }
                }
            }).start();
    }

    // ğŸ“¦ Parsing Ù…Ø±Ù† Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    private String parseGeminiResponse(String response) {
        try {
            JSONObject root = new JSONObject(response);

            // Ø§Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù† candidates
            if (root.has("candidates")) {
                JSONArray cands = root.optJSONArray("candidates");
                if (cands != null && cands.length()>0) {
                    JSONObject cand0 = cands.optJSONObject(0);

                    // 1) Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ: content.parts[].text
                    if (cand0.has("content")) {
                        JSONObject content = cand0.optJSONObject("content");
                        JSONArray partsArr = content.optJSONArray("parts");
                        if (partsArr != null && partsArr.length() > 0) {
                            for (int i=0;i<partsArr.length();i++) {
                                JSONObject part = partsArr.optJSONObject(i);
                                if (part != null && part.has("text")) {
                                    return part.optString("text");
                                }
                            }
                        }
                    }

                    // 2) field Ø¨Ø§Ø³Ù… text Ù…Ø¨Ø§Ø´Ø±Ø©
                    if (cand0.has("text")) {
                        return cand0.optString("text");
                    }

                    // 3) field Ø¨Ø§Ø³Ù… output
                    if (cand0.has("output")) {
                        return cand0.optString("output");
                    }

                    // 4) fallback: Ù†Ø­Ø§ÙˆÙ„ Ù†Ø±Ø¬Ø¹ ÙƒÙ„ Ø§Ù„ÙƒØ§Ø¦Ù† ÙƒØ³Ø·Ø± Ù†Øµ
                    return cand0.toString();
                }
            }

            // fallback: Ø§Ù„Ù†Øµ Ø¨Ø£ÙƒÙ…Ù„Ù‡
            return response;

        } catch(Exception e) {
            Log.e(TAG,"parseGeminiResponse error:"+e.getMessage());
            return null;
        }
    }

    // ===== Ø­ÙØ¸ Ø§Ù„Ø§Ø³ÙƒØ±Ø¨Øª ÙˆÙ…Ù„ÙØ§ØªÙ‡ (Ø¨Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ğŸ˜¶ / ğŸ¥± / ğŸµ) =====
    private void saveAndBroadcastScript(String text){
        try{
            File dir = new File(prefs.getScriptsPath());
            if(!dir.exists()) dir.mkdirs();

            // 1) Ø­ÙØ¸ Ø§Ù„Ù†Øµ Ø§Ù„Ø®Ø§Ù… ÙƒØ§Ù…Ù„ ÙƒÙ…Ø±Ø¬Ø¹
            File fullScript=new File(dir,"script_"+System.currentTimeMillis()+".txt");
            FileOutputStream fos=new FileOutputStream(fullScript);
            fos.write(text.getBytes("UTF-8")); fos.close();

            // 2) Ø­ÙØ¸ Ù†Øµ Ø§Ù„Ù‚ØµØ© Ø§Ù„ØµØ§ÙÙŠ (SCRIPTS_SSH) ÙƒÙ…Ø§ Ù‡Ùˆ (Ø¥Ù† ÙˆÙØ¬Ø¯)
            if(text.contains("SCRIPTS_SSH")){
                int start = text.indexOf("SCRIPTS_SSH");
                String sshContent = text.substring(start);
                File ssh=new File(dir,"SCRIPTS_SSH.txt");
                FileOutputStream fos2=new FileOutputStream(ssh);
                fos2.write(sshContent.getBytes("UTF-8"));
                fos2.close();
            }

            // 3) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„ØµÙˆØ± (MSHHDn) Ù…Ù† Ø¨ÙŠÙ† ğŸ˜¶ â€¦ ğŸ˜¶
            for(int i=1;;i++){
                String marker = "MSHHD"+i;
                if(text.contains(marker)){
                    String snippet = extractBetween(text, "ğŸ˜¶", "ğŸ˜¶", marker);
                    if(snippet != null && snippet.length() > 0){
                        File f=new File(dir,marker+".txt");
                        if(!f.exists()){
                            FileOutputStream fo=new FileOutputStream(f);
                            fo.write(snippet.getBytes("UTF-8"));
                            fo.close();
                        }
                    }
                } else break;
            }

            // 4) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø­Ø±ÙƒØ© (HAREKAn) Ù…Ù† Ø¨ÙŠÙ† ğŸ¥± â€¦ ğŸ¥±
            for(int i=1;;i++){
                String marker = "HAREKA"+i;
                if(text.contains(marker)){
                    String snippet = extractBetween(text, "ğŸ¥±", "ğŸ¥±", marker);
                    if(snippet != null && snippet.length() > 0){
                        File f=new File(dir,marker+".txt");
                        if(!f.exists()){
                            FileOutputStream fo=new FileOutputStream(f);
                            fo.write(snippet.getBytes("UTF-8"));
                            fo.close();
                        }
                    }
                } else break;
            }

            // 5) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†ØµÙˆØµ SSML (ğŸµ â€¦ ğŸµ)
            if(text.contains("SCRIPTS_SSML")){
                String snippet = extractBetween(text,"ğŸµ","ğŸµ","SCRIPTS_SSML");
                if(snippet != null && snippet.length() > 0){
                    File f=new File(dir,"SCRIPTS_SSML.txt");
                    FileOutputStream fo=new FileOutputStream(f);
                    fo.write(snippet.getBytes("UTF-8"));
                    fo.close();
                }
            }
            // SSML Ù„Ù„Ø´Ø®ØµÙŠØ§Øª
            for(int i=1;;i++){
                String marker="SCRIPTS_SSML_V"+i;
                if(text.contains(marker)){
                    String snippet = extractBetween(text,"ğŸµ","ğŸµ",marker);
                    if(snippet != null && snippet.length() > 0){
                        File f=new File(dir,marker+".txt");
                        FileOutputStream fo=new FileOutputStream(f);
                        fo.write(snippet.getBytes("UTF-8"));
                        fo.close();
                    }
                } else break;
            }

            if (tvLogs != null) tvLogs.append("âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³ÙƒØ±Ø¨Øª + Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ù…ÙˆØ².\n");
        }catch(Exception e){
            Log.e(TAG,"save script fail:"+e.getMessage());
        }
    }

    /**
     * ØªØ¨Ø­Ø« Ø¹Ù† marker Ø«Ù… ØªØ³ØªØ®Ø±Ø¬ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¨ÙŠÙ† Ø±Ù…Ø²ÙŠ startSymbol Ùˆ endSymbol Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù‡.
     * Ù…Ø«Ø§Ù„: extractBetween(text,"ğŸ˜¶","ğŸ˜¶","MSHHD1") â†’ ÙŠØ±Ø¬Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„ØµÙˆØ±Ø© ÙÙ‚Ø·.
     */
    private String extractBetween(String text, String startSymbol, String endSymbol, String marker){
        try{
            int mIdx = text.indexOf(marker);
            if(mIdx < 0) return null;
            int start = text.indexOf(startSymbol, mIdx);
            int end   = text.indexOf(endSymbol, start+startSymbol.length());
            if(start >= 0 && end > start){
                return text.substring(start+startSymbol.length(), end).trim();
            }
        }catch(Exception e){
            Log.e(TAG,"extractBetween error:"+e.getMessage());
        }
        return null;
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø§ÙŠØ¨Ù„Ø§ÙŠÙ†
    private void startProcessing(String prompt, boolean skipGemini){
        isProcessing=true;
        if(llStatus!=null) llStatus.setVisibility(View.VISIBLE);
        if(tvInlineStatus!=null) tvInlineStatus.setVisibility(View.VISIBLE);
        if(tvInlineStatusSmall!=null) tvInlineStatusSmall.setVisibility(View.VISIBLE);
        if(pbSmall!=null) pbSmall.setVisibility(View.VISIBLE);
        if(btnGo!=null) btnGo.setText("X");
        if(etPrompt!=null) etPrompt.setEnabled(false);

        Context ctx=getActivity(); if(ctx==null) return;
        Intent i=new Intent(ctx,PipelineService.class);
        i.putExtra("prompt",prompt);
        i.putExtra("skip_gemini",skipGemini);

        if(spImageStyle!=null && spImageStyle.getSelectedItem()!=null)
            i.putExtra("image_style", spImageStyle.getSelectedItem().toString());
        if(spCoverStyle!=null && spCoverStyle.getSelectedItem()!=null)
            i.putExtra("cover_style", spCoverStyle.getSelectedItem().toString());
        if(spVoice!=null && spVoice.getSelectedItem()!=null)
            i.putExtra("voice_choice", spVoice.getSelectedItem().toString());
        if(spVideoStyle!=null && spVideoStyle.getSelectedItem()!=null)
            i.putExtra("video_style", spVideoStyle.getSelectedItem().toString());

        SharedPreferences ffmpegPrefs=ctx.getSharedPreferences("ffmpeg_prefs",Context.MODE_PRIVATE);
        String selectedStyle = (spMontage!=null && spMontage.getSelectedItem()!=null)
            ? spMontage.getSelectedItem().toString()
            : ffmpegPrefs.getString("last_selected_style","Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");

        ffmpegPrefs.edit().putString("last_selected_style", selectedStyle).apply();
        i.putExtra("current_style", selectedStyle);
        i.putExtra("montage_style", selectedStyle);

        String prefix = "profile_" + selectedStyle + "_";
        String minutes = ffmpegPrefs.getString(prefix + "minutes", "00");
        String seconds = ffmpegPrefs.getString(prefix + "seconds", "30");
        String aspect  = ffmpegPrefs.getString(prefix + "aspect",  "16:9");
        String quality = ffmpegPrefs.getString(prefix + "quality", "1080p");

        i.putExtra("video_minutes",minutes);
        i.putExtra("video_seconds",seconds);
        i.putExtra("aspect_ratio",aspect);
        i.putExtra("video_quality",quality);

        if(Build.VERSION.SDK_INT>=Build.VERSION_CODES.O) ctx.startForegroundService(i);
        else ctx.startService(i);
    }

    private void cancelProcessing(){
        Context ctx=getActivity();
        if(ctx!=null){
            try { ctx.stopService(new Intent(ctx,PipelineService.class)); } catch(Exception ignored){}
            if (tvLogs != null) tvLogs.append("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡.\n");
        }
        restoreUi();
    }

    private void restoreUi(){
        isProcessing=false;
        if(llStatus!=null) llStatus.setVisibility(View.GONE);
        if(tvInlineStatus!=null) tvInlineStatus.setVisibility(View.GONE);
        if(tvInlineStatusSmall!=null) tvInlineStatusSmall.setVisibility(View.GONE);
        if(pbSmall!=null) pbSmall.setVisibility(View.GONE);
        if(btnGo!=null) btnGo.setText("Go");
        if(etPrompt!=null) etPrompt.setEnabled(true);
    }

    private void animateButtonPress(View v){
        if(v==null)return;
        ScaleAnimation sa=new ScaleAnimation(1f,0.92f,1f,0.92f,
                                             ScaleAnimation.RELATIVE_TO_SELF,0.5f,ScaleAnimation.RELATIVE_TO_SELF,0.5f);
        sa.setDuration(120); sa.setRepeatCount(1); sa.setRepeatMode(ScaleAnimation.REVERSE);
        v.startAnimation(sa);
    }

    // ===== Pipeline Callbacks =====
    public void onStageProgress(final String stage, final String msg){
        if(getActivity()==null)return;
        getActivity().runOnUiThread(new Runnable(){ public void run(){
                    if (tvLogs != null) tvLogs.append(stage+": "+msg+"\n");
                }});
    }

    public void onFinished(final String outPath){
        if(getActivity()==null)return;
        getActivity().runOnUiThread(new Runnable(){ public void run(){
                    if (tvLogs != null) tvLogs.append("âœ” Ø§Ù†ØªÙ‡Ù‰:"+outPath+"\n");
                    // Ø§Ø­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    persistUiSelections();
                    restoreUi();
                    try{
                        if(videoPreview!=null){
                            videoPreview.setVideoPath(outPath);
                            videoPreview.start();
                        }
                    }catch(Exception ignored){}
                }});
    }

    public void onError(final String stage, final String msg){
        if(getActivity()==null)return;
        getActivity().runOnUiThread(new Runnable(){ public void run(){
                    if (tvLogs != null) tvLogs.append("âš  Ø®Ø·Ø£ "+stage+": "+msg+"\n");
                    persistUiSelections();
                    restoreUi();
                }});
    }

    public void onCancelled(){
        if(getActivity()==null)return;
        getActivity().runOnUiThread(new Runnable(){ public void run(){
                    if (tvLogs != null) tvLogs.append("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\n");
                    persistUiSelections();
                    restoreUi();
                }});
    }

    private void hideKeyboard(){
        try{
            if(getActivity()==null || etPrompt==null) return;
            InputMethodManager imm=(InputMethodManager)getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);
            if(imm!=null) imm.hideSoftInputFromWindow(etPrompt.getWindowToken(),0);
        }catch(Exception ignored){}
    }

    @Override public void onResume(){
        super.onResume();
        if(getActivity()!=null){
            getActivity().registerReceiver(modelsUpdatedReceiver,new IntentFilter(Constants.ACTION_MODELS_UPDATED));
        }
        buildSpinners();
    }

    @Override public void onPause(){
        super.onPause();
        if(getActivity()!=null){
            try{ getActivity().unregisterReceiver(modelsUpdatedReceiver); }catch(Exception ignored){}
        }
    }

    @Override
    public void onDestroyView(){
        super.onDestroyView();
        try{
            if(videoPreview!=null){ videoPreview.stopPlayback(); }
        }catch(Exception ignored){}
    }
}


2 - ØµÙØ­Ø© Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ 

fragment_ffmpeg.xml -
<?xml version="1.0" encoding="utf-8"?>
<!-- fragment_ffmpeg.xml (Ù…Ø¹Ø¯Ù‘Ù„ â€” Ù…ÙØ¯Ù…Ø¬ØŒ ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„ØªÙØ¹ÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§ÙØŒ Ø¬ÙˆØ¯Ø©/Ù†Ø³Ø¨Ø©ØŒ ÙˆÙ…Ø³Ø§Ø±Ø§Øª) -->
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/fragment_ffmpeg_root"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fillViewport="true"
    android:background="@drawable/bg"
    android:layoutDirection="rtl"
    android:padding="12dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <!-- in-app notification container -->
        <FrameLayout
            android:id="@+id/inapp_notif_container"
            android:layout_width="match_parent"
            android:layout_height="wrap_content" />

        <!-- ===== Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="72dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/spinner_style"
                android:layout_width="160dp"
                android:layout_height="@dimen/spinner_height"
                android:background="@drawable/outline_border"
                android:spinnerMode="dropdown"
                android:entries="@array/ffmpeg_styles"
                android:contentDescription="Ø§Ø®ØªØ± Ø§Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬" />
            <TextView
                android:id="@+id/tv_label_style"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬"
                android:textColor="@color/highlight_color"
                android:textSize="18sp"
                android:textStyle="bold"
                android:gravity="right"
                android:layout_marginLeft="16dp" />
        </LinearLayout>

        <View android:layout_width="match_parent" android:layout_height="12dp" />

        <!-- ===== Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ===== -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:paddingTop="8dp"
            android:paddingBottom="8dp">

            <Spinner
                android:id="@+id/spinner_minutes"
                android:layout_width="54dp"
                android:layout_height="40dp"
                android:background="@drawable/outline_border"
                android:spinnerMode="dropdown"
                android:entries="@array/spinner_minutes"
                android:contentDescription="Ø¯Ù‚Ø§Ø¦Ù‚" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø¯Ù‚ÙŠÙ‚Ø©"
                android:textColor="#FFFFFF"
                android:textSize="14sp"
                android:textStyle="bold"
                android:layout_marginStart="8dp"
                android:layout_marginLeft="8dp" />

            <View android:layout_width="18dp" android:layout_height="wrap_content" />

            <Spinner
                android:id="@+id/spinner_seconds"
                android:layout_width="54dp"
                android:layout_height="40dp"
                android:background="@drawable/outline_border"
                android:spinnerMode="dropdown"
                android:entries="@array/spinner_seconds"
                android:contentDescription="Ø«ÙˆØ§Ù†ÙŠ" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Ø«Ø§Ù†ÙŠØ©"
                android:textColor="#FFFFFF"
                android:textSize="14sp"
                android:textStyle="bold"
                android:layout_marginStart="8dp"
                android:layout_marginLeft="8dp" />

            <TextView
                android:id="@+id/tv_video_time_title"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="ÙˆÙ‚Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
                android:textColor="#FFFFFF"
                android:textSize="16sp"
                android:textStyle="bold"
                android:gravity="right"
                android:layout_marginLeft="10dp" />
        </LinearLayout>

        <View android:layout_width="match_parent" android:layout_height="12dp" />

        <!-- ===== Ø¹Ù†Ø§ØµØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù: Ø§Ù„ØµÙˆØªØŒ Ø§Ù„Ø¨ØµØ±ÙŠØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§ØªØŒ Ø°ÙƒÙŠ ===== -->

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical">

            <!-- ÙƒÙ„ Ø¹Ù†ØµØ±: Ù…ÙØªØ§Ø­ ØªÙØ¹ÙŠÙ„ + Ø§Ø³Ù… + Spinner Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± (ÙŠÙÙ†Ø´Ø£/ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ­Ø¯) -->

            <!-- ===== Master model / Aggregator (Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ­Ø¯ Ø§Ù„Ø°ÙŠ ÙŠÙ‚Ø±Ø± ÙƒÙ„ Ø´ÙŠØ¡) ===== -->
                <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_model_master"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙŠØªØ­ÙƒÙ… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_model_master"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/models_aggregator"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¬Ù…ÙŠØ¹" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù†Ù…ÙˆØ°Ø¬ Ù…ÙˆØ­Ù‘Ø¯ (ÙŠØªØ­ÙƒÙ… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹) â€” Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙØ¹ÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>

            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="10dp" />
            
            <!-- Audio effect (Auto model) -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_audio_enabled"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_audio_effects"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/audio_effects"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¤Ø«Ø± Ø§Ù„ØµÙˆØªÙŠ" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù…Ø¤Ø«Ø± ØµÙˆØªÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ/Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>

            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="10dp" />

            <!-- Visual effect (Auto model) -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_visual_enabled"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ«Ø±Ø§Øª Ø§Ø§Ù„Ø¨ØµØ±ÙŠØ©"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_visual_effects"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/visual_effects"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¤Ø«Ø± Ø§Ù„Ø¨ØµØ±ÙŠ" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù…Ø¤Ø«Ø± Ø¨ØµØ±ÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ/Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>

            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="10dp" />

            <!-- Transitions (Auto model) -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_transitions_enabled"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_transitions"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/transitions"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª (ØªÙ„Ù‚Ø§Ø¦ÙŠ/Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>

            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="10dp" />

            <!-- ===== Smart count (enable + choice) ===== -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_smartcount_enabled"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ø¹Ø¯Ø¯ Ø°ÙƒÙŠ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª/Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_smart_count"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/spinner_smart_count"
                        android:contentDescription="Ø¹Ø¯Ø¯ Ø°ÙƒÙŠ" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù†Ù…ÙˆØ²Ø¬ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ùˆ Ø§Ù„Ù…ÙˆØ«Ø±Ø§Øª"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>

            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="10dp" />

            <!-- ===== Subtitles (ØªÙ… ØªØ¶Ù…ÙŠÙ† ØªÙØ¹ÙŠÙ„ + Ù†Ù…ÙˆØ°Ø¬ ASR) ===== -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_subtitles"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø©"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_model_subtitle"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/models_asr"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ±Ø¬Ù…Ø© (ASR)" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ±Ø¬Ù…Ø© (ASR)"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>
            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="12dp" />

            <!-- ===== Background music (ØªÙˆÙ„ÙŠØ¯/ØªÙ…ÙƒÙŠÙ†) ===== -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Switch
                        android:id="@+id/switch_music"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© (ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª)"
                        android:textColor="@color/highlight_color"
                        android:textSize="16sp"
                        android:gravity="right" />
                </LinearLayout>

                <View android:layout_width="match_parent" android:layout_height="6dp" />

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="56dp"
                    android:orientation="horizontal"
                    android:gravity="center_vertical">
                    <Spinner
                        android:id="@+id/spinner_model_music_bg"
                        android:layout_width="160dp"
                        android:layout_height="40dp"
                        android:background="@drawable/outline_border"
                        android:spinnerMode="dropdown"
                        android:entries="@array/models_music_bg"
                        android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©" />
                    <TextView
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©"
                        android:textColor="@color/highlight_color"
                        android:textSize="15sp"
                        android:gravity="right" />
                </LinearLayout>
            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="16dp" />

            <!-- ===== Ø¬ÙˆØ¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ùˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶:Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ===== -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="56dp"
                android:orientation="horizontal"
                android:gravity="center_vertical">
                <Spinner
                    android:id="@+id/spinner_video_quality"
                    android:layout_width="80dp"
                    android:layout_height="40dp"
                    android:background="@drawable/outline_border"
                    android:spinnerMode="dropdown"
                    android:entries="@array/video_qualities"
                    android:contentDescription="Ø¬ÙˆØ¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" />
                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Ø¬ÙˆØ¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
                    android:textColor="@color/highlight_color"
                    android:textSize="15sp"
                    android:gravity="right"
                    android:layout_marginLeft="12dp" />

                <View android:layout_width="16dp" android:layout_height="wrap_content" />

                <Spinner
                    android:id="@+id/spinner_aspect_ratio"
                    android:layout_width="80dp"
                    android:layout_height="40dp"
                    android:background="@drawable/outline_border"
                    android:spinnerMode="dropdown"
                    android:entries="@array/aspect_ratios"
                    android:contentDescription="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶:Ø§Ù„Ø§Ø±ØªÙØ§Ø¹" />
                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶:Ø§Ù„Ø§Ø±ØªÙØ§Ø¹"
                    android:textColor="@color/highlight_color"
                    android:textSize="15sp"
                    android:gravity="right" />
            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="18dp" />

        </LinearLayout>

        <!-- ===== Ù†Ù…ÙˆØ°Ø¬ Ø´Ø§Ù…Ù„ ÙŠØ¬Ù‡Ù‘Ø² ÙˆÙŠÙˆÙ„Ù‘Ø¯ Ø£ÙˆØ§Ù…Ø± FFmpegkit ===== -->            
        <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="56dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Switch
                android:id="@+id/switch_master_orchestrator_enabled"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="" />
            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù†Ù…ÙˆØ²Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ø§Ù„Ù‰ Ø§ÙˆÙ…Ø± "
                android:textColor="@color/highlight_color"
                android:textSize="16sp"
                android:gravity="right" />
        </LinearLayout>

        <View android:layout_width="match_parent" android:layout_height="6dp" />

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="56dp"
            android:orientation="horizontal"
            android:gravity="center_vertical">
            <Spinner
                android:id="@+id/spinner_master_orchestrator"
                android:layout_width="160dp"
                android:layout_height="40dp"
                android:background="@drawable/outline_border"
                android:spinnerMode="dropdown"
                android:entries="@array/models_orchestrator"
                android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆØ±ÙƒØ³ØªØ±Ø§" />
            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆØ±ÙƒØ³ØªØ±Ø§ (ÙŠÙ†ØªØ¬ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª + Ø£ÙˆØ§Ù…Ø± FFmpegkit)"
                android:textColor="@color/highlight_color"
                android:textSize="15sp"
                android:gravity="right" />
        </LinearLayout>

    </LinearLayout>

    <View android:layout_width="match_parent" android:layout_height="10dp" />
   
        <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹/Ø§Ù„Ù…Ø®Ø·Ø· (ÙŠÙˆØ¬Ø¯ Ù‡Ù†Ø§ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† @@@@) ===== -->   
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="56dp"
                android:orientation="horizontal"
                android:gravity="center_vertical">
                <Switch
                    android:id="@+id/switch_reviewer_enabled"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="" />
                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="ØªÙ‚Ø¹ÙŠÙ„  Ù„Ù†Ù…ÙˆØ²Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ø±ÙŠØ§Ù„Ù‡ Ø§Ù„Ù‰ Ø§Ù„Ø§ÙˆØ±ÙƒÙŠØ³ØªØ±Ø§ffmpegkit"
                    android:textColor="@color/highlight_color"
                    android:textSize="16sp"
                    android:gravity="right" />
            </LinearLayout>

            <View android:layout_width="match_parent" android:layout_height="6dp" />

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="56dp"
                android:orientation="horizontal"
                android:gravity="center_vertical">
                <Spinner
                    android:id="@+id/spinner_model_reviewer"
                    android:layout_width="160dp"
                    android:layout_height="40dp"
                    android:background="@drawable/outline_border"
                    android:spinnerMode="dropdown"
                    android:entries="@array/models_reviewer"
                    android:contentDescription="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹/Ø§Ù„Ù…Ø®Ø·Ø·" />
                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ (ÙŠÙ‚Ø±Ø£ Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø³ÙƒØ±Ø¨Øª ÙˆÙŠÙ‚ØªØ±Ø­ Ø§Ù„Ù…Ø®Ø·Ø· Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª)"
                    android:textColor="@color/highlight_color"
                    android:textSize="15sp"
                    android:gravity="right" />
            </LinearLayout>

        </LinearLayout>

        <!-- ===== Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·ØŒ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶Ù‡Ø§ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…) ===== -->
        <TextView
            android:id="@+id/tv_paths_title"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ (ØªÙ†Ø²ÙŠÙ„/Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ)"
            android:textColor="@color/highlight_color"
            android:textSize="15sp"
            android:textStyle="bold"
            android:gravity="center" />

        <TextView
            android:id="@+id/tv_path_scripts"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="/storage/emulated/0/AIAutoCreate/SCRIPTS"
            android:textColor="#DDDDDD"
            android:textSize="13sp"
            android:paddingTop="6dp" />

        <TextView
            android:id="@+id/tv_path_images"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="/storage/emulated/0/AIAutoCreate/IMAGES"
            android:textColor="#DDDDDD"
            android:textSize="13sp"
            android:paddingTop="2dp" />

        <TextView
            android:id="@+id/tv_path_videos"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="/storage/emulated/0/AIAutoCreate/VIDEOS"
            android:textColor="#DDDDDD"
            android:textSize="13sp"
            android:paddingTop="2dp" />

        <TextView
            android:id="@+id/tv_path_audios"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="/storage/emulated/0/AIAutoCreate/AUDIOS"
            android:textColor="#DDDDDD"
            android:textSize="13sp"
            android:paddingTop="2dp" />

        <TextView
            android:id="@+id/tv_path_errors"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="/storage/emulated/0/AIAutoCreate/ERRORS"
            android:textColor="#FF6B6B"
            android:textSize="13sp"
            android:paddingTop="2dp"
            android:paddingBottom="12dp" />

        <!-- ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸/Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ===== -->
        <Button
            android:id="@+id/btn_save_ffmpeg"
            android:layout_width="match_parent"
            android:layout_height="64dp"
            android:text="Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª"
            android:textColor="#FFFFFF"
            android:textSize="22sp"
            android:textStyle="bold"
            android:background="@drawable/outline_border"
            android:layout_marginBottom="12dp" />

        <Button
            android:id="@+id/btn_reload_style"
            android:layout_width="match_parent"
            android:layout_height="48dp"
            android:text="Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©"
            android:textColor="#FFFFFF"
            android:textSize="14sp"
            android:background="@drawable/outline_border"
            android:layout_marginBottom="18dp" />

        <TextView
            android:id="@+id/tv_ffmpeg_note"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ­Ø¯ ÙŠÙ‚ÙˆÙ… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙØ¹ÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…."
            android:textColor="#BBBBBB"
            android:textSize="12sp"
            android:gravity="center"
            android:layout_marginBottom="28dp" />

    </LinearLayout>

</ScrollView>

FFmpegFragment.java - 
package com.example.aiautocreate;

import android.content.Context;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.support.annotation.NonNull;
import android.support.v4.app.Fragment;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.animation.ScaleAnimation;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.CompoundButton;
import android.widget.Spinner;
import android.widget.Switch;
import android.widget.Toast;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

/**
 * FFmpegFragment - Ultra-Full Literal (Enhanced)
 * Java7/AIDE Compatible
 *
 * - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆÙ‚Øª + Ø§Ù„Ø¬ÙˆØ¯Ø© + Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ + Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙÙŠØ©
 * - ÙƒÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­ÙÙˆØ¸/Ù…Ø³ØªØ±Ø¬Ø¹ Ø­Ø³Ø¨ Style
 * - SharedPreferences: ffmpeg_prefs
 * - Ø¯Ù…Ø¬ PrefManager Ù„Ù‚ÙŠÙ… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© + Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
 */
public class FFmpegFragment extends Fragment {

    private static final String TAG = "FFmpegFragment";
    private static final String PREFS_NAME = "ffmpeg_prefs";

    // UI Elements
    private Spinner spStyle, spMinutes, spSeconds, spAspect, spQuality;
    private Spinner spMaster, spReviewer, spSmart, spMasterOrch;
    private Spinner spAudio, spVisual, spTransitions, spSubtitle, spMusic;
    private Switch swMaster, swReviewer, swSmart, swMasterOrch;
    private Switch swAudio, swVisual, swTransitions, swSubtitles, swMusic;
    private Button btnSave;

    private PrefManager prefManager;

    public FFmpegFragment() {}
    public static FFmpegFragment newInstance() { return new FFmpegFragment(); }

    @Override
    public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        View root = inflater.inflate(R.layout.fragment_ffmpeg, container, false);

        // init PrefManager + ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
        prefManager = new PrefManager(getContext());
        prefManager.ensureDefaultDirsExist();
        Log.i(TAG,"BaseDir = "+ new File(prefManager.getBaseDirPath()).getAbsolutePath());

        // find views
        spStyle   = safeFind(root,R.id.spinner_style);
        spMinutes = safeFind(root,R.id.spinner_minutes);
        spSeconds = safeFind(root,R.id.spinner_seconds);
        spAspect  = safeFind(root,R.id.spinner_aspect_ratio);
        spQuality = safeFind(root,R.id.spinner_video_quality);

        spMaster = safeFind(root,R.id.spinner_model_master);
        swMaster = safeFind(root,R.id.switch_model_master);

        spReviewer = safeFind(root,R.id.spinner_model_reviewer);
        swReviewer = safeFind(root,R.id.switch_reviewer_enabled);

        spSmart = safeFind(root,R.id.spinner_smart_count);
        swSmart = safeFind(root,R.id.switch_smartcount_enabled);

        spMasterOrch = safeFind(root,R.id.spinner_master_orchestrator);
        swMasterOrch = safeFind(root,R.id.switch_master_orchestrator_enabled);

        spAudio = safeFind(root,R.id.spinner_audio_effects);
        swAudio = safeFind(root,R.id.switch_audio_enabled);

        spVisual = safeFind(root,R.id.spinner_visual_effects);
        swVisual = safeFind(root,R.id.switch_visual_enabled);

        spTransitions = safeFind(root,R.id.spinner_transitions);
        swTransitions = safeFind(root,R.id.switch_transitions_enabled);

        spSubtitle = safeFind(root,R.id.spinner_model_subtitle);
        swSubtitles = safeFind(root,R.id.switch_subtitles);

        spMusic = safeFind(root,R.id.spinner_model_music_bg);
        swMusic = safeFind(root,R.id.switch_music);

        btnSave = safeFind(root, R.id.btn_save_ffmpeg);

        // setup spinners/adapters
        setupAdapters();
        initSwitchBehavior();

        // Ø§Ø¶Ø¨Ø· Ø§Ù„Ù€ Style Ø­Ø³Ø¨ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙÙˆØ¸ (Ø¥Ù† ÙˆÙØ¬Ø¯) Ø«Ù… Ø­Ù…Ù‘Ù„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
        applyLastSelectedStyleOrDefault();
        loadProfile();

        // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù€ Style â†’ Ø­Ù…Ù‘Ù„ Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©
        if(spStyle!=null){
            spStyle.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
                    public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
                        loadProfile();
                    }
                    public void onNothingSelected(AdapterView<?> parent) {}
                });
        }

        if(btnSave!=null){
            btnSave.setOnClickListener(new View.OnClickListener(){
                    public void onClick(View v){
                        animateButtonPress(v);
                        saveProfile();
                        Toast.makeText(getContext(),"âœ” ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ",Toast.LENGTH_SHORT).show();
                        try{
                            // Ø¥Ø¹Ù„Ø§Ù… Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø£Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØºÙŠÙ‘Ø±Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            getActivity().sendBroadcast(new android.content.Intent(Constants.ACTION_MODELS_UPDATED)
                                                        .putExtra(Constants.EXTRA_STAGE,"ffmpeg_profile")
                                                        .putExtra(Constants.EXTRA_MESSAGE,"ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù Ù†Ù…Ø· FFmpeg"));
                        }catch(Exception ignored){}
                    }
                });
        }

        return root;
    }

    // ========== Setup Adapters ==========
    private void setupAdapters(){
        if(getActivity()==null) return;

        // Styles
        setAdapter(spStyle,new String[]{"Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª","Ø­Ù…Ø§Ø³ÙŠ ÙˆØ¬Ø°Ø§Ø¨","Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙˆØ£Ù†ÙŠÙ‚","Ù…Ø®ØµØµ"});

        // ÙˆÙ‚Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        setAdapter(spMinutes,buildRange(0,10));
        setAdapter(spSeconds,buildRange(0,59));

        // Ù†Ø³Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        setAdapter(spAspect,new String[]{"16:9","9:16","1:1","4:3","21:9"});

        // Ø§Ù„Ø¬ÙˆØ¯Ø© (Ø­Ø±ÙˆÙ ØµØºÙŠØ±Ø© 2k/4k Ù„ØªØªÙˆØ§ÙÙ‚ Ù…Ø¹ PipelineManager.computeTargetSize)
        setAdapter(spQuality,new String[]{"480p","720p","1080p","2k","4k"});

        // Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø¶Ø§ÙÙŠØ©: Ø¯Ù…Ø¬ Ù‚ÙŠÙ… PrefManager Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© + Ø¨Ø¯Ø§Ø¦Ù„
        List<String> masterList = new ArrayList<String>();
        addUnique(masterList, prefManager.getOrchestrator());
        addUnique(masterList, "huggingface/ffmpeg-orch-small");
        addUnique(masterList, "huggingface/ffmpeg-orch-base");
        addUnique(masterList, "huggingface/ffmpeg-orch-pro");
        setAdapter(spMaster, masterList);

        List<String> reviewerList = new ArrayList<String>();
        addUnique(reviewerList, prefManager.getReviewer());
        addUnique(reviewerList, "huggingface/reviewer-small");
        addUnique(reviewerList, "huggingface/reviewer-base");
        addUnique(reviewerList, "huggingface/reviewer-large");
        setAdapter(spReviewer, reviewerList);

        List<String> smartList = new ArrayList<String>();
        addUnique(smartList, prefManager.getSmartCount());
        addUnique(smartList, "huggingface/smartcount-small");
        addUnique(smartList, "huggingface/smartcount-base");
        addUnique(smartList, "huggingface/smartcount-large");
        setAdapter(spSmart, smartList);

        List<String> orchList = new ArrayList<String>();
        addUnique(orchList, prefManager.getOrchestrator());
        addUnique(orchList, "orchestrator/v1-small");
        addUnique(orchList, "orchestrator/v1-balanced");
        addUnique(orchList, "orchestrator/v1-highquality");
        setAdapter(spMasterOrch, orchList);

        // ØªØ£Ø«ÙŠØ±Ø§Øª (Ø£Ù…Ø«Ù„Ø© Ø¹Ø§Ù…Ø© â€“ ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§)
        setAdapter(spAudio,new String[]{"audio-fx-small","audio-fx-base","audio-fx-pro"});
        setAdapter(spVisual,new String[]{"visual-fx-small","visual-fx-base","visual-fx-pro"});
        setAdapter(spTransitions,new String[]{"transition-fade","transition-cut","transition-zoom"});
        setAdapter(spSubtitle,new String[]{"asr-small","asr-base","asr-pro"});
        setAdapter(spMusic,new String[]{"music-bg-small","music-bg-base","music-bg-pro"});
    }

    private void setAdapter(Spinner sp,String[] arr){
        if(sp==null||getActivity()==null) return;
        ArrayAdapter<String> ad=new ArrayAdapter<String>(getActivity(),android.R.layout.simple_spinner_item,arr);
        ad.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        sp.setAdapter(ad);
    }

    private void setAdapter(Spinner sp,List<String> list){
        if(sp==null||getActivity()==null) return;
        ArrayAdapter<String> ad=new ArrayAdapter<String>(getActivity(),android.R.layout.simple_spinner_item,list);
        ad.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        sp.setAdapter(ad);
    }

    private List<String> buildRange(int from,int to){
        List<String> out=new ArrayList<String>();
        for(int i=from;i<=to;i++){
            if(i<10){ out.add("0"+i); } else { out.add(""+i); }
        }
        return out;
    }

    private void addUnique(List<String> list, String v){
        if(list==null||v==null) return;
        String t=v.trim();
        if(t.length()==0) return;
        if(!list.contains(t)) list.add(t);
    }

    // ========== Switch Binding ==========
    private void initSwitchBehavior(){
        bindSwitch(swMaster,spMaster);
        bindSwitch(swReviewer,spReviewer);
        bindSwitch(swSmart,spSmart);
        bindSwitch(swMasterOrch,spMasterOrch);
        bindSwitch(swAudio,spAudio);
        bindSwitch(swVisual,spVisual);
        bindSwitch(swTransitions,spTransitions);
        bindSwitch(swSubtitles,spSubtitle);
        bindSwitch(swMusic,spMusic);
    }

    private void bindSwitch(final Switch sw,final Spinner sp){
        if(sw==null||sp==null) return;
        sp.setEnabled(sw.isChecked());
        sw.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener(){
                public void onCheckedChanged(CompoundButton b,boolean c){ sp.setEnabled(c);}
            });
    }

    // ========== Save/Load Profiles ==========
    private void saveProfile(){
        Context ctx=getContext(); if(ctx==null) return;
        SharedPreferences prefs=ctx.getSharedPreferences(PREFS_NAME,Context.MODE_PRIVATE);
        SharedPreferences.Editor ed=prefs.edit();

        String style=getVal(spStyle,"Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");
        String prefix="profile_"+style+"_";

        // Ø­ÙØ¸ Ø¢Ø®Ø± style Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ HomeFragment
        ed.putString("last_selected_style", style);

        ed.putString(prefix+"minutes",getVal(spMinutes,"00"));
        ed.putString(prefix+"seconds",getVal(spSeconds,"30"));
        ed.putString(prefix+"aspect",getVal(spAspect,"16:9"));
        ed.putString(prefix+"quality",getVal(spQuality,"1080p"));

        saveSwitchSpinner(ed,prefix,"master",swMaster,spMaster);
        saveSwitchSpinner(ed,prefix,"reviewer",swReviewer,spReviewer);
        saveSwitchSpinner(ed,prefix,"smart",swSmart,spSmart);
        saveSwitchSpinner(ed,prefix,"orch",swMasterOrch,spMasterOrch);
        saveSwitchSpinner(ed,prefix,"audio",swAudio,spAudio);
        saveSwitchSpinner(ed,prefix,"visual",swVisual,spVisual);
        saveSwitchSpinner(ed,prefix,"trans",swTransitions,spTransitions);
        saveSwitchSpinner(ed,prefix,"sub",swSubtitles,spSubtitle);
        saveSwitchSpinner(ed,prefix,"music",swMusic,spMusic);

        ed.apply();

        Log.i(TAG,"âœ” Profile saved for "+style+" | Quality="+getVal(spQuality,"1080p")+" | Aspect="+getVal(spAspect,"16:9"));
    }

    private void loadProfile(){
        Context ctx=getContext(); if(ctx==null) return;
        SharedPreferences prefs=ctx.getSharedPreferences(PREFS_NAME,Context.MODE_PRIVATE);

        String style=getVal(spStyle,"Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");
        String prefix="profile_"+style+"_";

        selectVal(spMinutes,prefs.getString(prefix+"minutes","00"));
        selectVal(spSeconds,prefs.getString(prefix+"seconds","30"));
        selectVal(spAspect,prefs.getString(prefix+"aspect","16:9"));
        selectVal(spQuality,prefs.getString(prefix+"quality","1080p"));

        loadSwitchSpinner(prefs,prefix,"master",swMaster,spMaster);
        loadSwitchSpinner(prefs,prefix,"reviewer",swReviewer,spReviewer);
        loadSwitchSpinner(prefs,prefix,"smart",swSmart,spSmart);
        loadSwitchSpinner(prefs,prefix,"orch",swMasterOrch,spMasterOrch);
        loadSwitchSpinner(prefs,prefix,"audio",swAudio,spAudio);
        loadSwitchSpinner(prefs,prefix,"visual",swVisual,spVisual);
        loadSwitchSpinner(prefs,prefix,"trans",swTransitions,spTransitions);
        loadSwitchSpinner(prefs,prefix,"sub",swSubtitles,spSubtitle);
        loadSwitchSpinner(prefs,prefix,"music",swMusic,spMusic);
    }

    private void saveSwitchSpinner(SharedPreferences.Editor ed,String prefix,String key,Switch sw,Spinner sp){
        ed.putBoolean(prefix+key+"_on",sw!=null && sw.isChecked());
        if(sw!=null && sw.isChecked() && sp!=null){ ed.putString(prefix+key,getVal(sp,"")); }
    }

    private void loadSwitchSpinner(SharedPreferences prefs,String prefix,String key,Switch sw,Spinner sp){
        boolean on=prefs.getBoolean(prefix+key+"_on",false);
        if(sw!=null) sw.setChecked(on);
        String val=prefs.getString(prefix+key,"");
        selectVal(sp,val);
        if(sp!=null) sp.setEnabled(on);
    }

    // ========== Utils ==========
    private String getVal(Spinner sp,String def){
        if(sp==null||sp.getSelectedItem()==null) return def;
        String v=sp.getSelectedItem().toString();
        if(v==null||v.trim().length()==0) return def;
        return v.trim();
    }

    private void selectVal(Spinner sp,String v){
        if(sp==null||v==null) return;
        for(int i=0;i<sp.getCount();i++){
            Object o=sp.getItemAtPosition(i);
            if(o!=null && v.equals(o.toString())){ sp.setSelection(i); return; }
        }
    }

    private void applyLastSelectedStyleOrDefault(){
        try{
            Context ctx=getContext(); if(ctx==null) return;
            SharedPreferences prefs=ctx.getSharedPreferences(PREFS_NAME,Context.MODE_PRIVATE);
            String last = prefs.getString("last_selected_style","Ù‚ØµØµ ÙˆØ±ÙˆØ§ÙŠØ§Øª");
            selectVal(spStyle,last);
        }catch(Exception ignored){}
    }

    private void animateButtonPress(View v){
        if(v==null) return;
        ScaleAnimation sa=new ScaleAnimation(1f,0.92f,1f,0.92f,
                                             ScaleAnimation.RELATIVE_TO_SELF,0.5f,
                                             ScaleAnimation.RELATIVE_TO_SELF,0.5f);
        sa.setDuration(120); sa.setRepeatCount(1); sa.setRepeatMode(ScaleAnimation.REVERSE);
        v.startAnimation(sa);
    }

    @SuppressWarnings("unchecked")
    private <T extends View> T safeFind(View root,int id){
        if(root==null) return null;
        View v=root.findViewById(id);
        return (v!=null)? (T)v : null;
    }
}


3 - ØµÙØ­Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ© 

fragment_test.xml - 
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@drawable/bg"
    android:padding="15dp">

    <!-- notification placeholder (fixed at top of fragment) -->
    <FrameLayout
        android:id="@+id/inapp_notif_container"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"/>

    <!-- title -->
    <TextView
        android:id="@+id/tv_test"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±Ø¨Ø©"
        android:textSize="18sp"
        android:textStyle="bold"
        android:paddingTop="8dp"
        android:paddingBottom="6dp" />

    <!-- operations list: scrollable container -->
    <ScrollView
        android:id="@+id/ops_scroll"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:fillViewport="true">

        <LinearLayout
            android:id="@+id/ops_container"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:paddingBottom="12dp" />
    </ScrollView>
</LinearLayout>

operation_card.xml - 
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/op_card_root"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:layout_marginTop="8dp"
    android:layout_marginBottom="8dp"
    android:padding="12dp"
    android:background="@drawable/outline_border" >

    <!-- Title row -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:gravity="center_vertical">

        <ImageView
            android:id="@+id/op_icon"
            android:layout_width="28dp"
            android:layout_height="28dp"
            android:layout_marginEnd="8dp"
            android:contentDescription="status icon"
            android:src="@drawable/ic_check_circle"
            android:visibility="gone" />

        <TextView
            android:id="@+id/op_title"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"
            android:textColor="@color/highlight_color"
            android:textSize="16sp"
            android:ellipsize="end"
            android:maxLines="2" />
    </LinearLayout>

    <!-- Status line -->
    <TextView
        android:id="@+id/op_status"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯..."
        android:textSize="14sp"
        android:layout_marginTop="6dp"
        android:textColor="@android:color/darker_gray" />

    <!-- Per-card horizontal progress (hidden by default) -->
    <ProgressBar
        android:id="@+id/op_progress"
        style="?android:attr/progressBarStyleHorizontal"
        android:layout_width="match_parent"
        android:layout_height="6dp"
        android:layout_marginTop="8dp"
        android:indeterminate="false"
        android:max="100"
        android:progress="0"
        android:visibility="gone" />

    <!-- Text content (collapsed by default) -->
    <TextView
        android:id="@+id/op_content"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:text=""
        android:textSize="16sp"
        android:layout_marginTop="12dp"
        android:padding="6dp"
        android:lineSpacingExtra="2dp"
        android:ellipsize="end"
        android:maxLines="3" />

    <!-- Divider between text and media -->
    <View
        android:id="@+id/op_media_divider"
        android:layout_width="match_parent"
        android:layout_height="1dp"
        android:layout_marginTop="10dp"
        android:layout_marginBottom="8dp"
        android:background="@android:color/darker_gray"
        android:visibility="gone" />

    <!-- Media container: NO ScrollView â€” Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§ (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
    <LinearLayout
        android:id="@+id/op_media_container"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:visibility="gone"
        android:animateLayoutChanges="true"
        android:paddingTop="4dp"
        android:paddingBottom="4dp">

        <!-- Images row: Ø£ÙÙ‚ÙŠ. Ø¶Ø¹ ImageView Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ op_media_images -->
        <HorizontalScrollView
            android:id="@+id/op_media_images_scroll"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:visibility="gone"
            android:fillViewport="false"
            android:scrollbars="none"
            android:layout_marginBottom="8dp">

            <LinearLayout
                android:id="@+id/op_media_images"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:paddingLeft="4dp"
                android:paddingStart="4dp"
                android:paddingRight="4dp"
                android:paddingEnd="4dp" />
        </HorizontalScrollView>

        <!-- Video placeholder (Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹) -->
        <VideoView
            android:id="@+id/op_media_video"
            android:layout_width="match_parent"
            android:layout_height="200dp"
            android:layout_marginBottom="8dp"
            android:visibility="gone" />

        <!-- Audio area: Ø²Ø± ØªØ´ØºÙŠÙ„ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù„Ù -->
        <LinearLayout
            android:id="@+id/op_media_audio"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:visibility="gone"
            android:layout_marginBottom="8dp">

            <ImageView
                android:id="@+id/op_audio_play_btn"
                android:layout_width="40dp"
                android:layout_height="40dp"
                android:src="@android:drawable/ic_media_play"
                android:contentDescription="play" />

            <TextView
                android:id="@+id/op_audio_label"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:layout_marginStart="8dp"
                android:text="audio.mp3"
                android:ellipsize="end"
                android:maxLines="1" />
        </LinearLayout>

    </LinearLayout>

</LinearLayout>

TestFragment.java - 
package com.example.aiautocreate;

import android.app.Activity;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.media.MediaPlayer;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.support.v4.app.Fragment;
import android.text.TextUtils;
import android.text.method.ScrollingMovementMethod;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewTreeObserver;
import android.view.ViewGroup;
import android.view.ViewGroup.LayoutParams;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.MediaController; // note: from android.widget
import android.widget.ProgressBar;
import android.widget.ScrollView;
import android.widget.TextView;
import android.widget.Toast;
import android.widget.VideoView;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedInputStream;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * TestFragment - Ultra-Full Literal (AIDE/Java7 Compatible)
 * - ÙŠØ¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±Ø¨Ø© ÙƒØ¨Ø·Ø§Ù‚Ø§Øª (Script/Image/TTS/Video ...)
 * - Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© In-App Notification Ù…Ø¹ ØªÙ‚Ø¯Ù… ÙƒÙ„ÙŠ
 * - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨Ø«ÙˆØ« Ø§Ù„ØªÙ‚Ø¯Ù…/Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ù…Ù† PipelineService Ùˆ/Ø£Ùˆ Constants
 * - Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (ØµÙˆØ±/ØµÙˆØª/ÙÙŠØ¯ÙŠÙˆ) Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
 * - Ø­Ù…Ø§ÙŠØ© Nulls + Ø¥Ø¯Ø§Ø±Ø© MediaPlayer + ØªÙˆØ§ÙÙ‚ Java7/AIDE
 */
public class TestFragment extends Fragment {
    private static final String TAG = "TestFragment";

    private View rootView;
    private android.widget.FrameLayout notifContainer;
    private View currentInAppNotif = null;

    // Ops UI
    private ScrollView opsScroll;
    private LinearLayout opsContainer;

    // Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø³Ø¨ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬
    private Map<String, View> opCards = new LinkedHashMap<String, View>();
    private Map<String, Boolean> cardCompleted = new LinkedHashMap<String, Boolean>();

    // Ø¹Ø¯Ø§Ø¯ Ù…ÙØ§ØªÙŠØ­ ØµÙ†Ø§Ø¹ÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    private long syntheticCounter = 0L;

    // Ù…ÙˆÙ„Ø¯ IDs Ù…ØªÙˆØ§ÙÙ‚
    private static final AtomicInteger sNextGeneratedId = new AtomicInteger(1);

    // Media players Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø©
    private Map<String, MediaPlayer> mediaPlayers = new LinkedHashMap<String, MediaPlayer>();

    // Handler Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    private Handler uiHandler = new Handler();

    // ÙÙ„ØªØ± Ù…ÙˆØ­Ø¯ Ù„Ù„Ø¨Ø«ÙˆØ«
    private IntentFilter pipelineFilter = null;

    // ===== Receiver =====
    private BroadcastReceiver pipelineReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context c, Intent intent) {
            try {
                if (intent == null) return;
                String action = intent.getAction();
                if (action == null) return;

                try { Log.d(TAG, "Received action=" + action + " extras=" + extrasSummary(intent)); } catch (Exception ignored) {}

                // Ø¯Ø¹Ù… Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª: PipelineService.* Ùˆ Constants.*
                boolean isProgress =
                    equalsSafe(action, PipelineService.ACTION_PROGRESS) ||
                    equalsSafe(action, Constants.ACTION_PROGRESS);
                boolean isFinished =
                    equalsSafe(action, PipelineService.ACTION_FINISHED) ||
                    equalsSafe(action, Constants.ACTION_FINISHED);

                if (isProgress || isFinished) {
                    String stage = firstNonEmpty(
                        intent.getStringExtra(PipelineService.EXTRA_STAGE),
                        intent.getStringExtra(Constants.EXTRA_STAGE)
                    );
                    String msg = firstNonEmpty(
                        intent.getStringExtra(PipelineService.EXTRA_MESSAGE),
                        intent.getStringExtra(Constants.EXTRA_MESSAGE)
                    );

                    int progress = 0;
                    try {
                        progress = intent.getIntExtra("progress", 0);
                        if (progress <= 0) {
                            progress = intent.getIntExtra(Constants.EXTRA_PROGRESS, progress);
                        }
                    } catch (Exception ignored) {}

                    int total = 7;
                    int completedEst = estimateCompleted(stage);
                    String title = "ÙŠØªÙ… ØªÙ†ÙÙŠØ°: " + (stage != null ? stage : "");
                    showInAppNotification(title, completedEst, total, Math.max(0, Math.min(100, progress)));

                    onStageProgress(stage, msg, progress, intent);

                    // Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    String finalResult = extractFinalResult(intent);
                    if (finalResult != null && stage != null) {
                        String extracted = extractScriptIfJson(finalResult);
                        if (extracted == null) {
                            if (looksLikeJson(finalResult)) {
                                Log.d(TAG, "Final result looks like JSON but extraction failed. Showing placeholder.");
                            } else {
                                extracted = finalResult;
                            }
                        }
                        showFinalResultFor(stage, extracted != null ? extracted : "ØªÙ… Ø¥Ù†ØªØ§Ø¬ Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù†ØµÙ‘ÙŠØ© â€” Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„.", intent);
                    } else if (isFinished) {
                        markCardCompletedForStage(stage, intent, null);
                    }
                }
            } catch (Throwable t) {
                Log.w(TAG, "pipelineReceiver error: " + t.getMessage());
            }
        }
    };

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        rootView = inflater.inflate(R.layout.fragment_test, container, false);

        // bind views
        try { notifContainer = (android.widget.FrameLayout) rootView.findViewById(R.id.inapp_notif_container); }
        catch (Exception e) { notifContainer = null; Log.d(TAG, "inapp_notif_container lookup failed: " + e.getMessage()); }

        try {
            opsScroll = (ScrollView) rootView.findViewById(R.id.ops_scroll);
            opsContainer = (LinearLayout) rootView.findViewById(R.id.ops_container);
        } catch (Exception e) {
            opsScroll = null; opsContainer = null;
            Log.d(TAG, "ops container lookup failed: " + e.getMessage());
        }

        // Ø¹Ù†ÙˆØ§Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ù† Ù„Ù… ÙŠÙˆØ¬Ø¯
        try {
            TextView tv = (TextView) rootView.findViewById(R.id.tv_test);
            if (tv != null) {
                tv.setText("Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±Ø¨Ø©");
            } else {
                if (opsContainer != null) {
                    TextView tvGen = new TextView(getActivity());
                    try { tvGen.setId(generateViewIdCompat()); } catch (Exception ignored) {}
                    tvGen.setText("Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ¬Ø±Ø¨Ø©");
                    tvGen.setTextSize(18);
                    int pad = dpToPx(8);
                    tvGen.setPadding(pad, pad, pad, pad);
                    opsContainer.addView(tvGen, 0);
                    Log.d(TAG, "tv_test missing â€” created programmatically inside ops_container");
                }
            }
        } catch (Exception ex) {
            Log.w(TAG, "Error ensuring tv_test: " + ex.getMessage());
        }

        return rootView;
    }

    @Override
    public void onResume() {
        super.onResume();
        // register receiver
        try {
            if (pipelineFilter == null) {
                pipelineFilter = new IntentFilter();
                pipelineFilter.addAction(PipelineService.ACTION_PROGRESS);
                pipelineFilter.addAction(PipelineService.ACTION_FINISHED);
                // Ø£ÙŠØ¶Ø§Ù‹ Ø¨Ø«ÙˆØ« Constants
                pipelineFilter.addAction(Constants.ACTION_PROGRESS);
                pipelineFilter.addAction(Constants.ACTION_FINISHED);
            }
            Context ctx = getActivity();
            if (ctx != null) {
                try {
                    ctx.registerReceiver(pipelineReceiver, pipelineFilter);
                } catch (IllegalArgumentException ia) {
                    Log.w(TAG, "Receiver already registered or registration failed: " + ia.getMessage());
                }
            } else {
                Log.w(TAG, "onResume: getActivity() returned null");
            }
        } catch (Exception e) {
            Log.w(TAG, "registerReceiver failed: " + e.getMessage());
        }
    }

    @Override
    public void onPause() {
        try {
            Context ctx = getActivity();
            if (ctx != null) {
                try { ctx.unregisterReceiver(pipelineReceiver); }
                catch (IllegalArgumentException ia) { Log.d(TAG, "unregisterReceiver ignored: " + ia.getMessage()); }
            }
        } catch (Exception e) {
            Log.d(TAG, "onPause unregister error: " + e.getMessage());
        }
        super.onPause();
    }

    @Override
    public void onDestroyView() {
        try { hideInAppNotification(); } catch (Exception ignored) {}
        releaseAllMediaPlayers();
        super.onDestroyView();
    }

    // ===== In-app notification =====
    public void showInAppNotification(String title, int completed, int total, int progressPercent) {
        if (notifContainer == null) return;

        if (currentInAppNotif != null) {
            updateInAppNotification(title, completed, total, progressPercent);
            return;
        }

        LayoutInflater li = LayoutInflater.from(getActivity());
        final View v = li.inflate(R.layout.inapp_notification, notifContainer, false);
        TextView tvTitle = (TextView) v.findViewById(R.id.notif_title);
        TextView tvCounter = (TextView) v.findViewById(R.id.notif_counter);
        ProgressBar pb = (ProgressBar) v.findViewById(R.id.notif_progress);
        if (tvTitle != null) tvTitle.setText(title != null ? title : "");
        if (tvCounter != null) tvCounter.setText(String.valueOf(completed) + "/" + String.valueOf(total));
        if (pb != null) { pb.setMax(100); pb.setProgress(Math.max(0, Math.min(100, progressPercent))); }

        try {
            v.setTranslationY(-200f);
            notifContainer.addView(v);
            v.animate().translationY(0f).setDuration(220).start();
        } catch (Exception e) {
            try { notifContainer.addView(v); } catch (Exception ignored) {}
        }
        currentInAppNotif = v;
    }

    public void updateInAppNotification(String title, int completed, int total, int progressPercent) {
        if (currentInAppNotif == null) return;
        try {
            TextView tvTitle = (TextView) currentInAppNotif.findViewById(R.id.notif_title);
            TextView tvCounter = (TextView) currentInAppNotif.findViewById(R.id.notif_counter);
            ProgressBar pb = (ProgressBar) currentInAppNotif.findViewById(R.id.notif_progress);
            if (tvTitle != null && title != null) tvTitle.setText(title);
            if (tvCounter != null) tvCounter.setText(String.valueOf(completed) + "/" + String.valueOf(total));
            if (pb != null) pb.setProgress(Math.max(0, Math.min(100, progressPercent)));
        } catch (Exception e) { Log.w(TAG, "updateInAppNotification failed: " + e.getMessage()); }
    }

    public void hideInAppNotification() {
        if (currentInAppNotif == null) return;
        final View v = currentInAppNotif;
        currentInAppNotif = null;
        try {
            v.animate().translationY(-200f).setDuration(180).withEndAction(new Runnable() {
                    @Override
                    public void run() {
                        try {
                            if (notifContainer != null) notifContainer.removeView(v);
                            else {
                                android.view.ViewParent parent = v.getParent();
                                if (parent instanceof ViewGroup) ((ViewGroup) parent).removeView(v);
                            }
                        } catch (Exception ignored) {}
                    }
                }).start();
        } catch (Exception e) {
            try { if (notifContainer != null) notifContainer.removeView(v); } catch (Exception ignored) {}
        }
    }

    // ===== Stage progress =====
    public void onStageProgress(final String stage, final String message, final int progress, final Intent intent) {
        if (!isAdded() || opsContainer == null) return;

        final Runnable uiTask = new Runnable() {
            @Override public void run() {
                try {
                    Context ctx = getActivity();
                    if (ctx == null && rootView != null) ctx = rootView.getContext();
                    if (ctx == null) {
                        try { Toast.makeText(getActivity(), "Ø®Ø·Ø£: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙŠØ§Ù‚ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", Toast.LENGTH_SHORT).show(); } catch (Exception ignored) {}
                        return;
                    }

                    String group = getOperationGroup(stage);
                    String activeKey = findLatestActiveCardKeyForGroup(group);
                    if (activeKey != null && opCards.containsKey(activeKey)) {
                        View card = opCards.get(activeKey);
                        Boolean completed = cardCompleted.get(activeKey);
                        if (completed == null || !completed) {
                            String msgToShow = shouldIgnoreProgressMessage(message) ? null : message;
                            updateCardView(card, msgToShow, progress);
                            if ("script".equals(group) && message != null && message.length() > 0 && !shouldIgnoreProgressMessage(message)) {
                                String toAppend = message;
                                if (looksLikeJson(message)) {
                                    String ext = extractScriptIfJson(message);
                                    toAppend = (ext != null) ? ext : "[JSON output streaming â€” Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡]";
                                }
                                appendToCardContent(card, toAppend);
                            }
                        }
                        scrollToCard(card);
                        return;
                    }

                    String newKey = createNewCardKey(group);
                    String displayTitle = displayTitleForGroup(group);
                    String initialMsg = shouldIgnoreProgressMessage(message) ? null : message;

                    View card = createOperationCard(ctx, displayTitle, initialMsg, progress);
                    try { card.setTag(R.id.op_title, group != null ? group.toLowerCase() : ""); } catch (Exception ignored) {}
                    try { card.setTag(R.id.op_status, newKey); } catch (Exception ignored) {}

                    if ("script".equals(group) && message != null && message.length() > 0 && !shouldIgnoreProgressMessage(message)) {
                        String toAppend = message;
                        if (looksLikeJson(message)) {
                            String ext = extractScriptIfJson(message);
                            toAppend = (ext != null) ? ext : "[JSON output streaming â€” Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡]";
                        }
                        appendToCardContent(card, toAppend);
                    }

                    opCards.put(newKey, card);
                    cardCompleted.put(newKey, false);
                    opsContainer.addView(card);
                    card.setVisibility(View.VISIBLE);

                    card.postDelayed(new Runnable() {
                            @Override public void run() {
                                try { if (opsScroll != null) opsScroll.fullScroll(View.FOCUS_DOWN); } catch (Exception ignored) {}
                            }
                        }, 120);

                } catch (Exception e) {
                    try { Toast.makeText(getActivity(), "Ø®Ø·Ø£ Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", Toast.LENGTH_SHORT).show(); } catch (Exception ignored) {}
                }
            }
        };

        try {
            Activity act = getActivity();
            if (act != null) act.runOnUiThread(uiTask);
            else uiHandler.post(uiTask);
        } catch (Exception e) {
            uiHandler.post(uiTask);
        }
    }

    // overload (Ø¨Ø¯ÙˆÙ† intent)
    public void onStageProgress(final String stage, final String message, final int progress) {
        onStageProgress(stage, message, progress, null);
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    public void showFinalResultFor(final String stage, final String finalText, final Intent intent) {
        if (!isAdded() || opsContainer == null) return;

        final Runnable uiTask = new Runnable() {
            @Override public void run() {
                try {
                    Context ctx = getActivity();
                    if (ctx == null && rootView != null) ctx = rootView.getContext();
                    if (ctx == null) return;

                    String group = getOperationGroup(stage);
                    String activeKey = findLatestActiveCardKeyForGroup(group);
                    View card = (activeKey != null) ? opCards.get(activeKey) : null;

                    if (card == null) {
                        String newKey = createNewCardKey(group);
                        card = createOperationCard(ctx, displayTitleForGroup(group), "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©...", 100);
                        try { card.setTag(R.id.op_title, group != null ? group.toLowerCase() : ""); } catch (Exception ignored) {}
                        try { card.setTag(R.id.op_status, newKey); } catch (Exception ignored) {}
                        opCards.put(newKey, card);
                        cardCompleted.put(newKey, false);
                        opsContainer.addView(card);
                        card.setVisibility(View.VISIBLE);
                        activeKey = newKey;
                    }

                    TextView content = (TextView) card.findViewById(R.id.op_content);
                    TextView status = (TextView) card.findViewById(R.id.op_status);
                    ProgressBar pb = (ProgressBar) card.findViewById(R.id.op_progress);
                    ImageView icon = (ImageView) card.findViewById(R.id.op_icon);

                    String displayText = finalText;
                    if (displayText != null && looksLikeJson(displayText)) {
                        String ext = extractScriptIfJson(displayText);
                        if (ext != null) displayText = ext;
                        else {
                            Log.d(TAG, "showFinalResultFor: JSON but extraction failed.");
                            displayText = "Ù†ØªÙŠØ¬Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„ÙƒÙ† Ù„ÙŠØ³Øª Ù†ØµØ§Ù‹ ØµØ±ÙŠØ­Ø§Ù‹ â€” Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„ Ù„Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ø®Ø§Ù….";
                        }
                    }

                    boolean failed = detectFailure(intent, finalText);

                    // Ø¹Ø±Ø¶ ÙˆØ³Ø§Ø¦Ø· Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                    String groupCanonical = getOperationGroup(stage);
                    if ("image".equals(groupCanonical)) {
                        displayImagesInCard(card, displayText, activeKey);
                    } else if ("tts".equals(groupCanonical)) {
                        displayAudioInCard(card, displayText, activeKey);
                    } else if ("video".equals(groupCanonical)) {
                        displayVideoInCard(card, displayText, activeKey);
                    } else {
                        if (content != null) {
                            content.setText(displayText != null ? displayText : (failed ? "Ø­Ø¯Ø« Ø®Ø·Ø£ â€” Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„." : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù†ØµÙŠØ©."));
                            content.setMinLines(1);
                            content.setMaxLines(Integer.MAX_VALUE);
                            content.setEllipsize(null);
                            content.setHorizontallyScrolling(false);
                            content.setTextIsSelectable(true);
                            content.setMovementMethod(new ScrollingMovementMethod());
                            ViewGroup.LayoutParams lp = content.getLayoutParams();
                            if (lp != null) { lp.height = LayoutParams.WRAP_CONTENT; content.setLayoutParams(lp); }
                        }
                    }

                    if (status != null) status.setText(failed ? "âŒ ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" : "âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");
                    if (pb != null) pb.setVisibility(View.GONE);

                    if (icon != null) {
                        try {
                            int rid = getDrawableIdSafely(failed ? "ic_error" : "ic_check_circle");
                            if (rid == 0) rid = failed ? android.R.drawable.ic_dialog_alert : android.R.drawable.checkbox_on_background;
                            icon.setImageResource(rid);
                            icon.setVisibility(View.VISIBLE);
                        } catch (Exception ignored) {}
                    }

                    if (activeKey != null) {
                        cardCompleted.put(activeKey, true);
                        try { card.setTag(R.id.op_content, true); } catch (Exception ignored) {}
                        try {
                            TextView c = (TextView) card.findViewById(R.id.op_content);
                            if (c != null) { c.setMaxLines(Integer.MAX_VALUE); c.setEllipsize(null); }
                        } catch (Exception ignored) {}
                    }

                    scrollToCard(card);
                } catch (Exception e) {
                    Log.d(TAG, "showFinalResultFor error: " + e.getMessage());
                }
            }
        };

        try {
            Activity act = getActivity();
            if (act != null) act.runOnUiThread(uiTask);
            else uiHandler.post(uiTask);
        } catch (Exception e) {
            uiHandler.post(uiTask);
        }
    }

    public void showFinalResultFor(final String opKey, final String finalText) {
        showFinalResultFor(opKey, finalText, null);
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    private void updateCardView(View card, String message, int progress) {
        try {
            TextView status = (TextView) card.findViewById(R.id.op_status);
            if (status != null) status.setText((message != null && message.length() > 0) ? message : ("Ø§Ù„ØªÙ‚Ø¯Ù…: " + progress + "%"));
            try {
                View perProgress = card.findViewById(R.id.op_progress);
                if (perProgress instanceof ProgressBar) {
                    ((ProgressBar) perProgress).setMax(100);
                    ((ProgressBar) perProgress).setProgress(Math.max(0, Math.min(100, progress)));
                    perProgress.setVisibility((progress > 0 && progress < 100) ? View.VISIBLE : View.GONE);
                }
            } catch (Exception ignored) {}
        } catch (Exception ignored) {}
    }

    // Ø¥Ù„Ø­Ø§Ù‚ Ù†Øµ Ø¯Ø§Ø®Ù„ op_content (Ù„Ø¨Ø« Ø§Ù„Ø³ÙƒØ±Ø¨Øª)
    private void appendToCardContent(View card, String message) {
        try {
            if (card == null || message == null) return;
            TextView content = (TextView) card.findViewById(R.id.op_content);
            if (content == null) return;
            String prev = content.getText() != null ? content.getText().toString() : "";
            if (TextUtils.isEmpty(prev)) {
                content.setText(message);
            } else {
                if (!prev.endsWith(message)) {
                    content.setText(prev + "\n" + message);
                }
            }
            content.setMaxLines(6);
            content.setEllipsize(android.text.TextUtils.TruncateAt.END);
        } catch (Exception ignored) {}
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
    private View createOperationCard(Context ctx, String title, String message, int progress) {
        LayoutInflater li = LayoutInflater.from(ctx);
        View card = li.inflate(R.layout.operation_card, opsContainer, false);
        try {
            TextView tvTitle = (TextView) card.findViewById(R.id.op_title);
            TextView tvStatus = (TextView) card.findViewById(R.id.op_status);
            TextView tvContent = (TextView) card.findViewById(R.id.op_content);
            ImageView iv = (ImageView) card.findViewById(R.id.op_icon);
            ProgressBar pb = (ProgressBar) card.findViewById(R.id.op_progress);

            if (tvTitle != null) tvTitle.setText((title != null) ? title : "Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©");
            if (tvStatus != null) tvStatus.setText((message != null && message.length() > 0) ? message : ("Ø§Ù„ØªÙ‚Ø¯Ù…: " + progress + "%"));
            if (tvContent != null) {
                tvContent.setText("");
                tvContent.setMinLines(1);
                tvContent.setMaxLines(3);
                tvContent.setEllipsize(android.text.TextUtils.TruncateAt.END);
                tvContent.setHorizontallyScrolling(false);
                tvContent.setTextIsSelectable(true);
                tvContent.setMovementMethod(new ScrollingMovementMethod());
                ViewGroup.LayoutParams lp = tvContent.getLayoutParams();
                if (lp != null) { lp.height = LayoutParams.WRAP_CONTENT; tvContent.setLayoutParams(lp); }
            }

            if (iv != null) iv.setVisibility(View.GONE);
            if (pb != null) {
                if (progress > 0 && progress < 100) {
                    pb.setVisibility(View.VISIBLE);
                    pb.setMax(100);
                    pb.setProgress(Math.max(0, Math.min(100, progress)));
                } else {
                    pb.setVisibility(View.GONE);
                }
            }

            try { card.setTag(R.id.op_content, false); } catch (Exception ignored) {}

            card.setOnClickListener(new View.OnClickListener() {
                    @Override public void onClick(View v) {
                        try {
                            TextView c = (TextView) v.findViewById(R.id.op_content);
                            Object t = null;
                            try { t = v.getTag(R.id.op_content); } catch (Exception ignored) {}
                            boolean expanded = (t instanceof Boolean) && ((Boolean) t).booleanValue();
                            if (!expanded) {
                                if (c != null) { c.setMaxLines(Integer.MAX_VALUE); c.setEllipsize(null); }
                                try { v.setTag(R.id.op_content, true); } catch (Exception ignored) {}
                            } else {
                                if (c != null) { c.setMaxLines(3); c.setEllipsize(android.text.TextUtils.TruncateAt.END); }
                                try { v.setTag(R.id.op_content, false); } catch (Exception ignored) {}
                            }
                        } catch (Exception ignored) {}
                    }
                });

        } catch (Exception ignored) {}

        LinearLayout.LayoutParams lp = new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT);
        lp.setMargins(dpToPx(8), dpToPx(6), dpToPx(8), dpToPx(6));
        card.setLayoutParams(lp);
        card.setVisibility(View.VISIBLE);
        return card;
    }

    private void scrollToCard(final View card) {
        try {
            if (opsScroll == null || card == null) return;
            card.getViewTreeObserver().addOnPreDrawListener(new ViewTreeObserver.OnPreDrawListener() {
                    @Override public boolean onPreDraw() {
                        card.getViewTreeObserver().removeOnPreDrawListener(this);
                        try { opsScroll.smoothScrollTo(0, card.getTop()); } catch (Exception ignored) {}
                        return true;
                    }
                });
        } catch (Exception ignored) {}
    }

    private String findLatestActiveCardKeyForGroup(String group) {
        if (group == null) return null;
        try {
            List<String> keys = new ArrayList<String>(opCards.keySet());
            for (int i = keys.size() - 1; i >= 0; i--) {
                String k = keys.get(i);
                View v = opCards.get(k);
                if (v == null) continue;
                try {
                    Object tag = v.getTag(R.id.op_title);
                    if (tag instanceof String) {
                        if (group.equals(((String) tag).toLowerCase())) {
                            Boolean completed = cardCompleted.get(k);
                            if (completed == null || !completed) return k;
                        }
                        continue;
                    }
                } catch (Exception ignored) {}

                TextView tvTitle = (TextView) v.findViewById(R.id.op_title);
                if (tvTitle == null) continue;
                String t = (tvTitle.getText() != null) ? tvTitle.getText().toString().toLowerCase() : "";
                if (t.equals(group) || t.equals(displayTitleForGroup(group).toLowerCase())) {
                    Boolean completed = cardCompleted.get(k);
                    if (completed == null || !completed) return k;
                }
            }
        } catch (Exception ignored) {}
        return null;
    }

    private void markCardCompletedForStage(String stage, Intent intent, String finalText) {
        String group = getOperationGroup(stage);
        String activeKey = findLatestActiveCardKeyForGroup(group);
        if (activeKey != null) {
            cardCompleted.put(activeKey, true);
            View card = opCards.get(activeKey);
            if (card != null) {
                TextView status = (TextView) card.findViewById(R.id.op_status);
                View perProgress = card.findViewById(R.id.op_progress);
                ImageView icon = (ImageView) card.findViewById(R.id.op_icon);

                boolean failed = detectFailure(intent, finalText);

                if (status != null) status.setText(failed ? "âŒ ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" : "âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©");
                if (perProgress != null) perProgress.setVisibility(View.GONE);

                if (icon != null) {
                    try {
                        int rid = getDrawableIdSafely(failed ? "ic_error" : "ic_check_circle");
                        if (rid == 0) rid = failed ? android.R.drawable.ic_dialog_alert : android.R.drawable.checkbox_on_background;
                        icon.setImageResource(rid);
                        icon.setVisibility(View.VISIBLE);
                    } catch (Exception ignored) {}
                }

                try {
                    TextView ctv = (TextView) card.findViewById(R.id.op_content);
                    if (ctv != null) { ctv.setMaxLines(Integer.MAX_VALUE); ctv.setEllipsize(null); }
                    card.setTag(R.id.op_content, true);
                } catch (Exception ignored) {}
            }
        }
    }

    private String createNewCardKey(String stageOrGroup) {
        syntheticCounter++;
        String safeStage = (stageOrGroup == null) ? "stage" : stageOrGroup.replaceAll("\\s+","_");
        return safeStage + "_" + System.currentTimeMillis() + "_" + syntheticCounter;
    }

    private String getOperationGroup(String stage) {
        if (stage == null) return "unknown";
        String s = stage.toLowerCase();
        if (s.contains("script") || s.contains("scenario") || s.contains("script_generated") || s.contains("script_eval")) return "script";
        if (s.contains("image") || s.contains("images") || s.contains("sd") || s.contains("stable-diffusion") || s.contains("sdxl")) return "image";
        if (s.contains("check") || s.contains("verify") || s.contains("clip") || s.contains("embedding")) return "check";
        if (s.contains("tts") || s.contains("audio") || s.contains("wav") || s.contains("coqui") || s.contains("tts_generated")) return "tts";
        if (s.contains("asr") || s.contains("silence") || s.contains("tts_check") || s.contains("audio_check")) return "asr";
        if (s.contains("video") || s.contains("assemble") || s.contains("ffmpeg") || s.contains("img2vid") || s.contains("assemble_video")) return "video";
        return stage.replaceAll("\\s+","_").toLowerCase();
    }

    private String displayTitleForGroup(String group) {
        if (group == null) return "Operation";
        if ("script".equals(group)) return "Script";
        if ("image".equals(group))  return "Image";
        if ("check".equals(group))  return "Check";
        if ("tts".equals(group))    return "TTS";
        if ("asr".equals(group))    return "ASR";
        if ("video".equals(group))  return "Video";
        if (group.length() > 0) return group.substring(0,1).toUpperCase() + group.substring(1);
        return "Operation";
    }

    private boolean detectFailure(Intent it, String finalText) {
        try {
            if (it != null) {
                Bundle extras = it.getExtras();
                if (extras != null) {
                    if (extras.containsKey("success")) {
                        try {
                            Object o = extras.get("success");
                            if (o instanceof Boolean) return !((Boolean) o).booleanValue();
                            int v = extras.getInt("success", 1);
                            if (v == 0) return true;
                        } catch (Exception ignored) {}
                    }
                    for (String k : extras.keySet()) {
                        String kl = k.toLowerCase();
                        if (kl.contains("error") || kl.contains("fail") || kl.contains("exception")) return true;
                    }
                }
            }
            if (finalText != null) {
                String l = finalText.toLowerCase();
                if (l.contains("error") || l.contains("failed") || l.contains("exception") || l.contains("traceback") || l.contains("not found")) return true;
            }
        } catch (Exception ignored) {}
        return false;
    }

    // ===== MEDIA DISPLAY =====

    private List<String> parsePathsFromText(String text) {
        List<String> out = new ArrayList<String>();
        if (text == null) return out;
        String[] parts = text.split("[\\r?\\n,;]+");
        for (int i=0;i<parts.length;i++) {
            String p = parts[i];
            if (p == null) continue;
            String t = p.trim();
            if (t.length() == 0) continue;
            out.add(t);
        }
        return out;
    }

    private void displayImagesInCard(final View card, final String displayText, final String cardKey) {
        try {
            if (card == null) return;
            final Context ctx = getActivity();
            if (ctx == null) return;

            View mediaDivider = card.findViewById(R.id.op_media_divider);
            View mediaContainer = card.findViewById(R.id.op_media_container);
            View imagesScroll = card.findViewById(R.id.op_media_images_scroll);
            LinearLayout imagesRow = (LinearLayout) card.findViewById(R.id.op_media_images);

            final TextView content = (TextView) card.findViewById(R.id.op_content);
            if (content != null) content.setVisibility(View.GONE);

            List<String> paths = parsePathsFromText(displayText);

            if (mediaDivider != null) mediaDivider.setVisibility(View.VISIBLE);
            if (mediaContainer != null) mediaContainer.setVisibility(View.VISIBLE);

            if (imagesRow != null) {
                imagesRow.removeAllViews();
                if (paths.size() == 0) {
                    TextView tv = new TextView(ctx);
                    tv.setText(displayText != null ? displayText : "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù„Ù„Ø¹Ø±Ø¶");
                    imagesRow.addView(tv);
                } else {
                    for (int i=0;i<paths.size();i++) {
                        final String p = paths.get(i);
                        final ImageView iv = new ImageView(ctx);
                        LinearLayout.LayoutParams ivLp = new LinearLayout.LayoutParams(dpToPx(160), dpToPx(120));
                        ivLp.setMargins(dpToPx(6), dpToPx(6), dpToPx(6), dpToPx(6));
                        iv.setLayoutParams(ivLp);
                        iv.setAdjustViewBounds(true);
                        iv.setScaleType(ImageView.ScaleType.CENTER_CROP);
                        iv.setImageResource(android.R.drawable.progress_indeterminate_horizontal);
                        imagesRow.addView(iv);

                        if (p == null) continue;

                        if (p.startsWith("http://") || p.startsWith("https://")) {
                            new Thread(new Runnable() {
                                    @Override public void run() {
                                        final Bitmap bmp = downloadBitmapFromUrl(p);
                                        uiHandler.post(new Runnable() {
                                                @Override public void run() {
                                                    try { if (bmp != null) iv.setImageBitmap(bmp); else iv.setImageResource(android.R.drawable.ic_menu_report_image); }
                                                    catch (Exception ignored) {}
                                                }
                                            });
                                    }
                                }).start();
                        } else {
                            try {
                                Bitmap b = null;
                                String pathNormalized = p;
                                if (p.startsWith("file://")) pathNormalized = p.substring(7);
                                if (pathNormalized.startsWith("/")) b = BitmapFactory.decodeFile(pathNormalized);

                                if (b != null) {
                                    iv.setImageBitmap(b);
                                } else {
                                    try {
                                        Uri u = Uri.parse(p);
                                        InputStream is = null;
                                        try {
                                            if (ctx.getContentResolver() != null) {
                                                is = ctx.getContentResolver().openInputStream(u);
                                            }
                                            if (is != null) {
                                                Bitmap bm = BitmapFactory.decodeStream(is);
                                                if (bm != null) iv.setImageBitmap(bm);
                                                is.close();
                                            } else {
                                                iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                            }
                                        } catch (Exception e) {
                                            iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                        } finally {
                                            try { if (is != null) is.close(); } catch (Exception ignored) {}
                                        }
                                    } catch (Exception e) {
                                        iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                    }
                                }
                            } catch (Exception e) {
                                try { iv.setImageResource(android.R.drawable.ic_menu_report_image); } catch (Exception ignored) {}
                            }
                        }
                    }
                }
                if (imagesScroll != null) imagesScroll.setVisibility(View.VISIBLE);
                return;
            }

            if (mediaContainer instanceof ViewGroup) {
                ViewGroup cont = (ViewGroup) mediaContainer;
                cont.removeAllViews();
                if (paths.size() == 0) {
                    TextView tv = new TextView(ctx);
                    tv.setText(displayText != null ? displayText : "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù„Ù„Ø¹Ø±Ø¶");
                    cont.addView(tv);
                } else {
                    for (int i=0;i<paths.size();i++) {
                        final String p = paths.get(i);
                        final ImageView iv = new ImageView(ctx);
                        LinearLayout.LayoutParams ivLp = new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, dpToPx(200));
                        ivLp.setMargins(0, dpToPx(6), 0, dpToPx(6));
                        iv.setLayoutParams(ivLp);
                        iv.setAdjustViewBounds(true);
                        iv.setScaleType(ImageView.ScaleType.FIT_CENTER);
                        iv.setImageResource(android.R.drawable.progress_indeterminate_horizontal);
                        cont.addView(iv);

                        if (p == null) continue;

                        if (p.startsWith("http://") || p.startsWith("https://")) {
                            new Thread(new Runnable() {
                                    @Override public void run() {
                                        final Bitmap bmp = downloadBitmapFromUrl(p);
                                        uiHandler.post(new Runnable() {
                                                @Override public void run() {
                                                    try { if (bmp != null) iv.setImageBitmap(bmp); else iv.setImageResource(android.R.drawable.ic_menu_report_image); }
                                                    catch (Exception ignored) {}
                                                }
                                            });
                                    }
                                }).start();
                        } else {
                            try {
                                Bitmap b = null;
                                String pathNormalized = p;
                                if (p.startsWith("file://")) pathNormalized = p.substring(7);
                                if (pathNormalized.startsWith("/")) b = BitmapFactory.decodeFile(pathNormalized);

                                if (b != null) {
                                    iv.setImageBitmap(b);
                                } else {
                                    try {
                                        Uri u = Uri.parse(p);
                                        InputStream is = null;
                                        try {
                                            if (ctx.getContentResolver() != null) {
                                                is = ctx.getContentResolver().openInputStream(u);
                                            }
                                            if (is != null) {
                                                Bitmap bm = BitmapFactory.decodeStream(is);
                                                if (bm != null) iv.setImageBitmap(bm);
                                                is.close();
                                            } else {
                                                iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                            }
                                        } catch (Exception e) {
                                            iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                        } finally {
                                            try { if (is != null) is.close(); } catch (Exception ignored) {}
                                        }
                                    } catch (Exception e) {
                                        iv.setImageResource(android.R.drawable.ic_menu_report_image);
                                    }
                                }
                            } catch (Exception e) {
                                try { iv.setImageResource(android.R.drawable.ic_menu_report_image); } catch (Exception ignored) {}
                            }
                        }
                    }
                }
                return;
            }

            // fallback Ù†ØµÙŠ
            try {
                TextView tv = new TextView(ctx);
                tv.setText(displayText != null ? displayText : "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ³Ø§Ø¦Ø· Ù„Ù„Ø¹Ø±Ø¶");
                ViewGroup parent = null;
                int idx = -1;
                if (content != null && content.getParent() instanceof ViewGroup) {
                    parent = (ViewGroup) content.getParent();
                    idx = parent.indexOfChild(content);
                }
                if (parent != null && idx >= 0) parent.addView(tv, idx + 1);
                else if (card instanceof ViewGroup) ((ViewGroup) card).addView(tv);
            } catch (Exception ignored) {}
        } catch (Exception e) {
            Log.d(TAG, "displayImagesInCard failed: " + e.getMessage());
        }
    }

    private void displayAudioInCard(final View card, final String displayText, final String cardKey) {
        try {
            if (card == null) return;
            final Context ctx = getActivity();
            if (ctx == null) return;

            View mediaDivider = card.findViewById(R.id.op_media_divider);
            View mediaContainer = card.findViewById(R.id.op_media_container);
            final TextView content = (TextView) card.findViewById(R.id.op_content);
            if (content != null) content.setVisibility(View.GONE);

            List<String> paths = parsePathsFromText(displayText);
            final String audioPath = paths.size() > 0 ? paths.get(0) : null;

            LinearLayout container = new LinearLayout(ctx);
            container.setOrientation(LinearLayout.HORIZONTAL);
            LinearLayout.LayoutParams clp = new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT);
            container.setLayoutParams(clp);
            container.setPadding(dpToPx(6), dpToPx(6), dpToPx(6), dpToPx(6));

            final ImageButton playBtn = new ImageButton(ctx);
            playBtn.setImageResource(android.R.drawable.ic_media_play);
            LinearLayout.LayoutParams btnLp = new LinearLayout.LayoutParams(dpToPx(48), dpToPx(48));
            playBtn.setLayoutParams(btnLp);
            container.addView(playBtn);

            final TextView label = new TextView(ctx);
            label.setText(audioPath != null ? audioPath : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ØµÙˆØªÙŠ");
            LinearLayout.LayoutParams labLp = new LinearLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
            labLp.setMargins(dpToPx(8), 0, 0, 0);
            label.setLayoutParams(labLp);
            container.addView(label);

            if (mediaDivider != null) mediaDivider.setVisibility(View.VISIBLE);
            if (mediaContainer != null) mediaContainer.setVisibility(View.VISIBLE);

            if (mediaContainer instanceof ViewGroup) {
                try { ((ViewGroup) mediaContainer).addView(container); }
                catch (Exception ignored) { if (card instanceof ViewGroup) ((ViewGroup) card).addView(container); }
            } else {
                try {
                    if (content != null && content.getParent() instanceof ViewGroup) {
                        ViewGroup parent = (ViewGroup) content.getParent();
                        int idx = parent.indexOfChild(content);
                        parent.addView(container, idx + 1);
                    } else if (card instanceof ViewGroup) ((ViewGroup) card).addView(container);
                } catch (Exception e) {
                    try { if (card instanceof ViewGroup) ((ViewGroup) card).addView(container); } catch (Exception ignored) {}
                }
            }

            if (audioPath == null) {
                playBtn.setEnabled(false);
                return;
            }

            playBtn.setOnClickListener(new View.OnClickListener() {
                    @Override public void onClick(View v) {
                        try {
                            MediaPlayer mp = mediaPlayers.get(cardKey);
                            if (mp == null) {
                                mp = new MediaPlayer();
                                mediaPlayers.put(cardKey, mp);
                                try {
                                    if (audioPath.startsWith("http://") || audioPath.startsWith("https://")) {
                                        mp.setDataSource(audioPath);
                                    } else {
                                        if (audioPath.startsWith("content://") || audioPath.startsWith("file://")) {
                                            mp.setDataSource(ctx, Uri.parse(audioPath));
                                        } else {
                                            mp.setDataSource(audioPath);
                                        }
                                    }
                                    mp.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
                                            @Override public void onPrepared(MediaPlayer m) {
                                                try { m.start(); playBtn.setImageResource(android.R.drawable.ic_media_pause); } catch (Exception ignored) {}
                                            }
                                        });
                                    mp.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {
                                            @Override public void onCompletion(MediaPlayer m) {
                                                try { playBtn.setImageResource(android.R.drawable.ic_media_play); m.seekTo(0); } catch (Exception ignored) {}
                                            }
                                        });
                                    mp.prepareAsync();
                                } catch (Exception ex) {
                                    Log.d(TAG, "audio setDataSource failed: " + ex.getMessage());
                                    try { mp.release(); } catch (Exception ignored) {}
                                    mediaPlayers.remove(cardKey);
                                    playBtn.setEnabled(false);
                                }
                            } else {
                                if (mp.isPlaying()) {
                                    mp.pause();
                                    playBtn.setImageResource(android.R.drawable.ic_media_play);
                                } else {
                                    mp.start();
                                    playBtn.setImageResource(android.R.drawable.ic_media_pause);
                                }
                            }
                        } catch (Exception ex) {
                            Log.d(TAG, "audio play error: " + ex.getMessage());
                        }
                    }
                });

        } catch (Exception e) {
            Log.d(TAG, "displayAudioInCard failed: " + e.getMessage());
        }
    }

    private void displayVideoInCard(final View card, final String displayText, final String cardKey) {
        try {
            if (card == null) return;
            final Context ctx = getActivity();
            if (ctx == null) return;

            final View mediaDivider = card.findViewById(R.id.op_media_divider);
            final View mediaContainer = card.findViewById(R.id.op_media_container);
            final ViewGroup mediaParent = (mediaContainer instanceof ViewGroup) ? (ViewGroup) mediaContainer : null;
            final TextView content = (TextView) card.findViewById(R.id.op_content);
            if (content != null) content.setVisibility(View.GONE);

            List<String> paths = parsePathsFromText(displayText);
            final String vidPath = paths.size() > 0 ? paths.get(0) : null;

            if (mediaDivider != null) mediaDivider.setVisibility(View.VISIBLE);
            if (mediaContainer != null) mediaContainer.setVisibility(View.VISIBLE);

            if (vidPath == null) {
                TextView tv = new TextView(ctx);
                tv.setText("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ø¹Ø±Ø¶");
                try {
                    if (mediaParent != null) {
                        mediaParent.addView(tv);
                    } else if (content != null && content.getParent() instanceof ViewGroup) {
                        ViewGroup parent = (ViewGroup) content.getParent();
                        int idx = parent.indexOfChild(content);
                        parent.addView(tv, idx + 1);
                    } else if (card instanceof ViewGroup) {
                        ((ViewGroup) card).addView(tv);
                    }
                } catch (Exception ignored) {}
                return;
            }

            final VideoView vv = new VideoView(ctx);
            LinearLayout.LayoutParams vlp = new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, dpToPx(240));
            vv.setLayoutParams(vlp);

            // Ø§Ø³ØªØ®Ø¯Ù… android.widget.MediaController Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙÙŠ AIDE
            final android.widget.MediaController mc = new android.widget.MediaController(ctx);
            vv.setMediaController(mc);
            mc.setAnchorView(vv);

            try {
                if (mediaParent != null) {
                    mediaParent.addView(vv);
                } else {
                    if (content != null && content.getParent() instanceof ViewGroup) {
                        ViewGroup parent = (ViewGroup) content.getParent();
                        int idx = parent.indexOfChild(content);
                        parent.addView(vv, idx + 1);
                    } else if (card instanceof ViewGroup) {
                        ((ViewGroup) card).addView(vv);
                    }
                }
            } catch (Exception ignored) {}

            try {
                Uri u = Uri.parse(vidPath);
                vv.setVideoURI(u);
                vv.requestFocus();
                vv.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
                        @Override public void onPrepared(MediaPlayer mp) {
                            // Ù„Ø§ ØªØ´ØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                        }
                    });
                vv.setOnErrorListener(new MediaPlayer.OnErrorListener() {
                        @Override public boolean onError(MediaPlayer mp, int what, int extra) {
                            try {
                                TextView tv = new TextView(ctx);
                                tv.setText("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
                                if (mediaParent != null) {
                                    mediaParent.addView(tv);
                                } else if (content != null && content.getParent() instanceof ViewGroup) {
                                    ViewGroup parent = (ViewGroup) content.getParent();
                                    int idx = parent.indexOfChild(content);
                                    parent.addView(tv, idx + 1);
                                } else if (card instanceof ViewGroup) {
                                    ((ViewGroup) card).addView(tv);
                                }
                            } catch (Exception ignored) {}
                            return true; // ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø®Ø·Ø£
                        }
                    });
            } catch (Exception e) {
                Log.d(TAG, "video set uri failed: " + e.getMessage());
                TextView tv = new TextView(ctx);
                tv.setText("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
                try {
                    if (mediaParent != null) {
                        mediaParent.addView(tv);
                    } else if (content != null && content.getParent() instanceof ViewGroup) {
                        ViewGroup parent = (ViewGroup) content.getParent();
                        parent.addView(tv);
                    }
                } catch (Exception ignored) {}
            }
        } catch (Exception e) {
            Log.d(TAG, "displayVideoInCard failed: " + e.getMessage());
        }
    }

    private Bitmap downloadBitmapFromUrl(String urlStr) {
        InputStream is = null;
        HttpURLConnection conn = null;
        try {
            URL url = new URL(urlStr);
            conn = (HttpURLConnection) url.openConnection();
            conn.setConnectTimeout(8000);
            conn.setReadTimeout(15000);
            conn.setInstanceFollowRedirects(true);
            is = new BufferedInputStream(conn.getInputStream());
            Bitmap b = BitmapFactory.decodeStream(is);
            try { is.close(); } catch (Exception ignored) {}
            if (conn != null) conn.disconnect();
            return b;
        } catch (Exception e) {
            Log.d(TAG, "downloadBitmapFromUrl failed: " + e.getMessage());
            try { if (is != null) is.close(); } catch (Exception ignored) {}
            try { if (conn != null) conn.disconnect(); } catch (Exception ignored) {}
            return null;
        }
    }

    private void releaseAllMediaPlayers() {
        try {
            List<String> keys = new ArrayList<String>(mediaPlayers.keySet());
            for (int i=0;i<keys.size();i++) {
                String k = keys.get(i);
                try {
                    MediaPlayer mp = mediaPlayers.get(k);
                    if (mp != null) {
                        try { if (mp.isPlaying()) mp.stop(); } catch (Exception ignored) {}
                        try { mp.release(); } catch (Exception ignored) {}
                    }
                } catch (Exception ignored) {}
                mediaPlayers.remove(k);
            }
        } catch (Exception ignored) {}
    }

    // ===== JSON/script extraction =====
    private String extractScriptIfJson(String raw) {
        if (raw == null) return null;
        String trimmed = raw.trim();
        if (trimmed.length() == 0) return null;
        if (!(trimmed.startsWith("{") || trimmed.startsWith("["))) return null;

        try {
            JSONObject j = null;
            if (trimmed.startsWith("{")) {
                j = new JSONObject(trimmed);
            } else {
                JSONArray a = new JSONArray(trimmed);
                if (a.length() > 0) {
                    Object first = a.opt(0);
                    if (first instanceof JSONObject) j = (JSONObject) first;
                    else {
                        try { j = new JSONObject(String.valueOf(first)); } catch (Exception ignored) {}
                    }
                }
            }
            if (j == null) return null;

            String[] directKeys = new String[] {"script","final_script","script_text","content","result","output","final_result","text"};
            for (int i=0;i<directKeys.length;i++) {
                String k = directKeys[i];
                if (j.has(k)) {
                    Object o = j.opt(k);
                    if (o instanceof String) {
                        String s = (String) o;
                        if (!TextUtils.isEmpty(s)) return cleanExtractedText(s);
                    } else if (o instanceof JSONArray) {
                        JSONArray arr = (JSONArray) o;
                        StringBuilder sb = new StringBuilder();
                        for (int idx=0; idx<arr.length(); idx++) {
                            Object el = arr.opt(idx);
                            if (el != null) {
                                if (sb.length() > 0) sb.append('\n');
                                sb.append(el.toString());
                            }
                        }
                        if (sb.length() > 0) return cleanExtractedText(sb.toString());
                    } else {
                        String s = (o != null) ? o.toString() : null;
                        if (!TextUtils.isEmpty(s)) return cleanExtractedText(s);
                    }
                }
            }

            if (j.has("candidates")) {
                try {
                    JSONArray cand = j.optJSONArray("candidates");
                    if (cand != null && cand.length() > 0) {
                        StringBuilder out = new StringBuilder();
                        for (int ci=0; ci<cand.length(); ci++) {
                            try {
                                JSONObject candObj = cand.optJSONObject(ci);
                                if (candObj == null) continue;
                                Object contentObj = candObj.opt("content");
                                if (contentObj instanceof JSONObject) {
                                    JSONObject content = (JSONObject) contentObj;
                                    if (content.has("parts")) {
                                        JSONArray parts = content.optJSONArray("parts");
                                        if (parts != null) {
                                            for (int pi=0; pi<parts.length(); pi++) {
                                                Object part = parts.opt(pi);
                                                if (part instanceof JSONObject) {
                                                    JSONObject p = (JSONObject) part;
                                                    String txt = p.optString("text", null);
                                                    if (!TextUtils.isEmpty(txt) && !shouldIgnoreProgressMessage(txt)) {
                                                        if (out.length() > 0) out.append('\n');
                                                        out.append(txt);
                                                    }
                                                } else if (part instanceof String) {
                                                    String txt = (String) part;
                                                    if (!TextUtils.isEmpty(txt) && !shouldIgnoreProgressMessage(txt)) {
                                                        if (out.length() > 0) out.append('\n');
                                                        out.append(txt);
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if (content.has("text")) {
                                        String txt = content.optString("text", null);
                                        if (!TextUtils.isEmpty(txt) && !shouldIgnoreProgressMessage(txt)) {
                                            if (out.length() > 0) out.append('\n');
                                            out.append(txt);
                                        }
                                    }
                                } else if (contentObj instanceof String) {
                                    String txt = (String) contentObj;
                                    if (!TextUtils.isEmpty(txt) && !shouldIgnoreProgressMessage(txt)) {
                                        if (out.length() > 0) out.append('\n');
                                        out.append(txt);
                                    }
                                }
                            } catch (Exception ignoreCand) {}
                        }
                        if (out.length() > 0) return cleanExtractedText(out.toString());
                    }
                } catch (Exception je) {
                    Log.d(TAG, "candidates parse failed: " + je.getMessage());
                }
            }

            String[] nested = new String[] {"data","outputs","choices","items"};
            for (int i=0;i<nested.length;i++) {
                String key = nested[i];
                if (j.has(key)) {
                    try {
                        Object o = j.opt(key);
                        if (o instanceof JSONObject) {
                            JSONObject sub = (JSONObject) o;
                            String[] subKeys = new String[]{"script","content","text"};
                            for (int k=0;k<subKeys.length;k++) {
                                String k2 = subKeys[k];
                                if (sub.has(k2)) {
                                    String s = sub.optString(k2, null);
                                    if (!TextUtils.isEmpty(s)) return cleanExtractedText(s);
                                }
                            }
                        } else if (o instanceof JSONArray) {
                            JSONArray arr = (JSONArray) o;
                            StringBuilder sb = new StringBuilder();
                            for (int ii=0; ii<arr.length(); ii++) {
                                Object el = arr.opt(ii);
                                if (el instanceof JSONObject) {
                                    JSONObject jo = (JSONObject) el;
                                    String[] subKeys = new String[]{"script","content","text"};
                                    for (int k=0;k<subKeys.length;k++) {
                                        String k2 = subKeys[k];
                                        if (jo.has(k2)) {
                                            String s = jo.optString(k2, null);
                                            if (!TextUtils.isEmpty(s)) {
                                                if (sb.length() > 0) sb.append('\n');
                                                sb.append(s);
                                            }
                                        }
                                    }
                                } else if (el instanceof String) {
                                    if (sb.length() > 0) sb.append('\n');
                                    sb.append((String) el);
                                }
                            }
                            if (sb.length() > 0) return cleanExtractedText(sb.toString());
                        }
                    } catch (Exception ignored) {}
                }
            }

            try {
                StringBuilder collected = new StringBuilder();
                collectTextFromJson(j, collected);
                if (collected.length() > 0) {
                    String cleaned = cleanExtractedText(collected.toString());
                    if (!TextUtils.isEmpty(cleaned)) return cleaned;
                }
            } catch (Exception ignored) {}

            String longest = extractLongestTextBlock(trimmed);
            if (!TextUtils.isEmpty(longest)) return cleanExtractedText(longest);

        } catch (JSONException je) {
            Log.d(TAG, "extractScriptIfJson: json parse failed: " + je.getMessage());
        } catch (Throwable t) {
            Log.d(TAG, "extractScriptIfJson error: " + t.getMessage());
        }
        return null;
    }

    private void collectTextFromJson(Object node, StringBuilder out) {
        try {
            if (node == null) return;
            if (node instanceof JSONObject) {
                JSONObject jo = (JSONObject) node;
                JSONArray names = jo.names();
                if (names == null) return;
                for (int i=0;i<names.length();i++) {
                    String key = names.optString(i);
                    Object val = jo.opt(key);
                    collectTextFromJson(val, out);
                }
            } else if (node instanceof JSONArray) {
                JSONArray ja = (JSONArray) node;
                for (int i=0;i<ja.length();i++) collectTextFromJson(ja.opt(i), out);
            } else if (node instanceof String) {
                String s = ((String) node).trim();
                if (s.length() < 20) return;
                if (shouldIgnoreProgressMessage(s)) return;
                if (looksLikeJson(s)) return;
                if (out.length() > 0) out.append('\n');
                out.append(s);
            } else {
                String s = node.toString();
                if (s != null && s.length() >= 40) {
                    if (!shouldIgnoreProgressMessage(s) && !looksLikeJson(s)) {
                        if (out.length() > 0) out.append('\n');
                        out.append(s);
                    }
                }
            }
        } catch (Exception ignored) {}
    }

    private String extractLongestTextBlock(String s) {
        if (s == null) return null;
        try {
            // ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© UNICODE_CHARACTER_CLASS Ù„ØªÙˆØ§ÙÙ‚ Ø£ÙˆØ³Ø¹
            java.util.regex.Pattern p = java.util.regex.Pattern.compile("([\\p{L}\\p{N}\\s\\p{P}]{40,})");
            java.util.regex.Matcher m = p.matcher(s);
            String best = null;
            while (m.find()) {
                String cand = m.group(1);
                if (cand == null) continue;
                cand = cand.trim();
                int braces = 0;
                for (int i=0;i<cand.length();i++) {
                    char ch = cand.charAt(i);
                    if (ch == '{' || ch == '}' || ch == '[' || ch == ']') braces++;
                }
                if (braces > 6 && cand.length() < 400) continue;
                if (shouldIgnoreProgressMessage(cand)) continue;
                if (best == null || cand.length() > best.length()) best = cand;
            }
            if (best != null) return best.replace("\\n", "\n").replace("\\\"", "\"").trim();
        } catch (Exception ignored) {}
        return null;
    }

    private boolean looksLikeJson(String s) {
        if (s == null) return false;
        String t = s.trim();
        return t.startsWith("{") || t.startsWith("[");
    }

    private String cleanExtractedText(String s) {
        if (s == null) return null;
        String out = s.replace("\\n", "\n").replace("\\r", "\r").replace("\\\"", "\"").replace("\\'", "'").trim();
        try {
            String[] lines = out.split("\\r?\\n");
            StringBuilder sb = new StringBuilder();
            for (int i=0;i<lines.length;i++) {
                String line = lines[i];
                if (line == null) continue;
                String trimmed = line.trim();
                if (trimmed.length() == 0) continue;
                if (shouldIgnoreProgressMessage(trimmed)) continue;
                if (trimmed.length() < 3) continue;
                if (sb.length() > 0) sb.append('\n');
                sb.append(trimmed);
            }
            out = sb.toString().trim();
        } catch (Exception ignored) {}
        while (out.startsWith("\n")) out = out.substring(1);
        while (out.endsWith("\n")) out = out.substring(0, out.length()-1);
        return out.length() > 0 ? out : null;
    }

    private String truncateForLog(String s) {
        if (s == null) return "";
        if (s.length() > 800) return s.substring(0, 800) + "...(truncated)";
        return s;
    }

    private String extractFinalResult(Intent intent) {
        if (intent == null) return null;
        try {
            Bundle extras = intent.getExtras();
            if (extras == null) return null;

            String[] commonKeys = new String[] {"final_result","script","result","output","extra_result","EXTRA_RESULT"};
            for (int i=0;i<commonKeys.length;i++) {
                String k = commonKeys[i];
                if (extras.containsKey(k)) {
                    Object o = extras.get(k);
                    if (o instanceof String) {
                        String v = (String) o;
                        if (!TextUtils.isEmpty(v)) return v;
                    } else if (o != null) {
                        String v = o.toString();
                        if (!TextUtils.isEmpty(v)) return v;
                    }
                }
            }

            for (String k : extras.keySet()) {
                try {
                    String kl = k.toLowerCase();
                    if (kl.contains("result") || kl.contains("final") || kl.contains("output") || kl.contains("script")) {
                        Object o = extras.get(k);
                        if (o instanceof String) {
                            String v = (String) o;
                            if (!TextUtils.isEmpty(v)) return v;
                        } else if (o != null) {
                            String v = o.toString();
                            if (!TextUtils.isEmpty(v)) return v;
                        }
                    }
                } catch (Exception ignored) {}
            }
            Log.d(TAG, "extractFinalResult: no textual result key found. Extras keys: " + extras.keySet().toString());
        } catch (Throwable t) {
            Log.w(TAG, "extractFinalResult failed: " + t.getMessage());
        }
        return null;
    }

    private int getDrawableIdSafely(String name) {
        try {
            Context ctx = getContext();
            if (ctx == null) ctx = getActivity();
            if (ctx == null) return 0;
            if (name == null || name.length() == 0) return 0;
            int id = ctx.getResources().getIdentifier(name, "drawable", ctx.getPackageName());
            return id;
        } catch (Exception e) {
            Log.d(TAG, "getDrawableIdSafely error: " + e.getMessage());
            return 0;
        }
    }

    private int estimateCompleted(String stage) {
        if (stage == null) return 0;
        String s = stage.toLowerCase();
        if (s.contains("script") || s.contains("scenario") || s.contains("script_generated")) return 1;
        if (s.contains("image") || s.contains("images") || s.contains("sd") || s.contains("stable-diffusion") || s.contains("sdxl")) return 2;
        if (s.contains("check") || s.contains("verify") || s.contains("clip") || s.contains("embedding")) return 3;
        if (s.contains("tts") || s.contains("audio") || s.contains("wav") || s.contains("coqui") || s.contains("tts_generated")) return 4;
        if (s.contains("asr") || s.contains("silence") || s.contains("tts_check") || s.contains("audio_check")) return 5;
        if (s.contains("video") || s.contains("assemble") || s.contains("ffmpeg") || s.contains("img2vid") || s.contains("assemble_video")) return 6;
        if (s.contains("finished") || s.contains("done") || s.contains("complete") || s.contains("success")) return 7;
        return 0;
    }

    private int dpToPx(int dp) {
        try {
            final float scale = getResources().getDisplayMetrics().density;
            return (int) (dp * scale + 0.5f);
        } catch (Exception e) {
            return dp;
        }
    }

    private int generateViewIdCompat() {
        try {
            if (android.os.Build.VERSION.SDK_INT >= 17) {
                try { return View.generateViewId(); } catch (Throwable ignored) {}
            }
        } catch (Throwable ignored) {}
        // fallback Java7/AIDE-safe
        for (;;) {
            final int result = sNextGeneratedId.get();
            int newValue = result + 1;
            if (newValue > 0x00FFFFFF) newValue = 1;
            if (sNextGeneratedId.compareAndSet(result, newValue)) return result;
        }
    }

    // utils
    private boolean equalsSafe(String a, String b){ return a != null && b != null && a.equals(b); }
    private String firstNonEmpty(String a, String b){
        if (a != null && a.trim().length() > 0) return a.trim();
        if (b != null && b.trim().length() > 0) return b.trim();
        return null;
    }

    private String extrasSummary(Intent it) {
        if (it == null) return "{}";
        try {
            Bundle extras = it.getExtras();
            if (extras == null) return "{}";
            StringBuilder sb = new StringBuilder("{");
            boolean first = true;
            for (String k : extras.keySet()) {
                if (!first) sb.append(", ");
                first = false;
                Object o = extras.get(k);
                String v = (o == null) ? "null" : o.toString();
                if (v.length() > 120) v = v.substring(0, 120) + "...";
                sb.append(k).append("=").append(v);
            }
            sb.append("}");
            return sb.toString();
        } catch (Throwable t) {
            return "{error summarizing extras}";
        }
    }

    // ignore noisy/placeholder progress messages (AIDE-safe)
    private boolean shouldIgnoreProgressMessage(String msg) {
        if (msg == null) return true;
        String m = msg.trim();
        if (m.length() == 0) return true;
        String ml = m.toLowerCase();

        if ("ok".equals(ml) || "done".equals(ml) || "working".equals(ml) ||
            "loading".equals(ml) || "processing".equals(ml) || "...".equals(ml)) return true;

        if (ml.startsWith("progress") || ml.startsWith("uploading") || ml.startsWith("downloading")) return true;

        // ignore pure percentage like "50%"
        try { if (m.matches("^\\s*\\d{1,3}%\\s*$")) return true; } catch (Exception ignored) {}

        // ignore only dots/commas/dashes
        try { if (m.matches("^[\\.|,\\-â€“â€”]+$")) return true; } catch (Exception ignored) {}

        return false;
    }
}


---
19 - Ø§ÙŠØ¶Ø¢ Ø§Ø¶Ù Ø¯ÙŠØ§Ù„ÙˆØ¬ Ù…ÙˆØ­Ø¯ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ø­ØªØ±Ø§ÙÙŠ ØªØªØºÙŠØ± ÙÙŠÙ‡ ÙÙ‚Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ùˆ Ø§Ù„Ø§Ø³Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ø§Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ø§Ù„Ù„ØªÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠÙ‡Ø§  Ùˆ Ù…Ø§ Ø§Ù„Ù‰ Ø°Ø§Ù„Ùƒ
---

20 - Ø§ÙŠØ¶Ø¢ Ø§Ù„ÙŠÙƒ Ù…Ø«Ø§Ù„ Ù„Ø·Ø±ÙŠÙ‚Ø© Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠÙ‡ Ø§Ù„Ù„ØªÙŠ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© 

Ø§Ù„ÙŠÙƒ ÙƒÙˆØ¯ Ù„Ù„Ù…Ø«Ø§Ù„ Ùˆ Ù„ÙƒÙŠÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„ÙŠÙ‡ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„ØªÙŠ ØªØ±Ù‰Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø© Ùˆ Ù„ÙƒÙŠÙ† ÙŠØ¬Ø¨ Ø§Ù† ØªØ­Ø¯Ø« Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ùˆ ØªØ³ÙŠØ± Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ§Ø· 

Ø§Ù„ÙŠÙƒ ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø«Ø§Ù„ 

package com.example.aiautocreate;

import android.content.Context;
import android.util.Log;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;

import org.json.JSONObject;

import java.io.File;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.FileInputStream;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.ByteArrayOutputStream;
import java.io.OutputStream;
import java.io.OutputStreamWriter;

import java.net.URL;
import java.net.HttpURLConnection;
import java.net.URLEncoder;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;

/**
 * PipelineManager - Ultra-Full Literal (Image/TTS/Video pipeline + Always-Finish + Enforced Dims + StylePacks + Robust HF + 402 Model-ID + JSON/Bytes handling)
 * - Java7 Compatible + AIDE-safe
 * - Ø§Ù„ØµÙˆØ±: ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Accept Ø¥Ù„Ù‰ image/png + Ø¥ØµÙ„Ø§Ø­ ØªØ±Ù…ÙŠØ² URL Ù„Ù„Ù…ÙˆØ¯ÙŠÙ„ (owner/repo) Ù„ØªÙØ§Ø¯ÙŠ 400/404
 * - Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© + multipart fallback
 * - TTS: Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø°ÙƒÙŠØ© + fallback Ø¨Ø³ÙŠØ·
 * - Logging Ù…ÙˆØ³Ø¹ + Always-Finish
 */
public class PipelineManager {
    private static final String TAG="PipelineManager";
    private static final String VOICE_CLONE_OPTION = "Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¹ÙŠÙ†Ø© (Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)";

    // Negative prompt Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØµÙˆØ±
    private static final String DEFAULT_NEGATIVE =
    "lowres, blurry, bad anatomy, deformed, watermark, text, jpeg artifacts, worst quality, low quality, noisy";

    public interface Callback{
        void onStageProgress(String stage,String msg);
        void onFinished(String out);
        void onError(String stage,String msg);
        void onCancelled();
    }

    private Context ctx;
    private Callback cb;
    private boolean cancelled=false;
    private PrefManager pref;
    private File logFile;

    // Ø¢Ø®Ø± Ù…Ø¯Ø© Ù„ØºØ§ÙŠØ§Øª placeholder
    private int lastDurationMs = 0;

    // Ø§Ø®ØªÙŠØ§Ø± Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù„Ø­Ù‚Ù† Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø³ØªØ§ÙŠÙ„
    private String selectedImageStyle = null;

    // Ø­Ø§Ù„Ø© Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ© (402) + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø°ÙŠ Ù†ÙØ¯Øª Ø­ØµØªÙ‡
    private volatile boolean hfQuotaExceeded = false;
    private String hfQuotaModel = "";
    private String hfQuotaStage = "";

    public PipelineManager(Context c,Callback callback){
        ctx=c; cb=callback; pref=new PrefManager(c);
        try{
            File logDir=new File(pref.getErrorsPath());
            if(!logDir.exists()) logDir.mkdirs();
            logFile=new File(logDir,"pipeline_log.txt");
        }catch(Exception e){ logFile=null; }
    }

    public void cancel(){ cancelled=true; }
    public boolean isCancelled(){ return cancelled; }

    public void runPipeline(String prompt,
                            String imageStyle,
                            String coverStyle,
                            String voiceChoice,
                            String montageStyle,
                            int videoDurationMs,
                            String aspectRatio,
                            String videoQuality,
                            String audioFx,
                            String visualFx,
                            String transFx,
                            String smartSel,
                            String subsModel,
                            String musicBg,
                            String masterAgg,
                            String reviewer,
                            String orch){
        cancelled=false;
        hfQuotaExceeded=false;
        hfQuotaModel=""; hfQuotaStage="";
        lastDurationMs = videoDurationMs;

        // Ø§Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø± Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø­Ù‚Ù† ØªÙˆÙƒÙ†Ø² Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
        this.selectedImageStyle = imageStyle;

        try{
            // 0) Ù…Ø³Ø§Ø±Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©
            File scriptsDir = new File(pref.getScriptsPath());
            File imagesDir  = new File(pref.getImagesPath());
            File videosDir  = new File(pref.getVideosPath());
            File audiosDir  = new File(pref.getAudiosPath());
            if(!scriptsDir.exists()) scriptsDir.mkdirs();
            if(!imagesDir.exists()) imagesDir.mkdirs();
            if(!videosDir.exists()) videosDir.mkdirs();
            if(!audiosDir.exists()) audiosDir.mkdirs();

            // Ø­Ø³Ø§Ø¨ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† (aspect + quality)
            int[] size = computeTargetSize(aspectRatio, videoQuality);
            int targetW = size[0];
            int targetH = size[1];
            logAndCb("dims", "Target = "+targetW+"x"+targetH+" ("+aspectRatio+" | "+videoQuality+")");

            String pshort = shortText(prompt, 60);
            logAndCb("script","âœ… Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¬Ø§Ù‡Ø²: "+(pshort.length()>0? pshort : "no-prompt"));

            // 1) ØµÙˆØ±
            if(!hfQuotaExceeded) processImagesFromScripts(scriptsDir, imagesDir, aspectRatio, targetW, targetH);
            if(hfQuotaExceeded){
                logAndCb("pipeline","â›” ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø³Ø¨Ø¨ Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ© Ø¹Ù„Ù‰ HF (model="+hfQuotaModel+", stage="+hfQuotaStage+")");
            }

            // 2) TTS
            if(!hfQuotaExceeded) processTtsFromScripts(scriptsDir, audiosDir, voiceChoice);

            // 3) ÙÙŠØ¯ÙŠÙˆ
            if(!hfQuotaExceeded) processImg2VidFromScripts(scriptsDir, imagesDir, videosDir, aspectRatio, videoDurationMs, targetW, targetH);

            // 4) Ù…Ø±Ø§Ø­Ù„ Ø¥Ø¶Ø§ÙÙŠØ© (Logging ÙÙ‚Ø· Ù‡Ù†Ø§)
            stage("audiofx",audioFx,null);
            stage("visualfx",visualFx,null);
            stage("transitions",transFx,null);
            stage("smart",smartSel,null);
            stage("subs",subsModel,null);
            stage("music",musicBg,null);
            stage("masteragg",masterAgg,null);
            stage("reviewer",reviewer,null);
            stage("orch",orch,null);

            if(checkCancel()) return;
            logAndCb("assemble","ğŸ”§ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠâ€¦");
            assembleFinal();
        }catch(Exception e){
            safeCbError("pipeline","Exception: "+e.getMessage());
            writeToFile("ERROR pipeline: "+e.getMessage());
            Log.e(TAG,"runPipeline failed",e);
        }
    }

    private void stage(String stageName,String value,String aspect){
        if(checkCancel()) return;
        if(notEmpty(value)){
            if("image".equals(stageName)&&notEmpty(aspect)){
                try{
                    AspectRatioUtils.Dimension d=AspectRatioUtils.parseAspect(aspect);
                    logAndCb(stageName,"ğŸ–¼ "+value+" | "+d.width+"x"+d.height+" ("+d.label+")");
                }catch(Exception e){
                    logAndCb(stageName,"ğŸ–¼ "+value+" | aspect="+aspect);
                }
            }else{
                logAndCb(stageName,"â–¶ "+stageName+": "+value);
            }
            simulate();
        } else {
            logAndCb(stageName,"â­ Skip "+stageName+" (empty/disabled)");
        }
    }

    private boolean notEmpty(String s){ return s!=null && s.trim().length()>0; }
    private boolean checkCancel(){
        if(cancelled){
            if(cb!=null) cb.onCancelled();
            writeToFile("âš  CANCELLED");
            return true;
        }
        return false;
    }
    private void simulate(){ try{ Thread.sleep(500);}catch(Exception ignored){} }

    private void assembleFinal(){
        try{
            File vids=new File(pref.getVideosPath());
            File auds=new File(pref.getAudiosPath());
            boolean hasV = vids.exists() && vids.listFiles()!=null && vids.listFiles().length>0;
            boolean hasA = auds.exists() && auds.listFiles()!=null && auds.listFiles().length>0;

            if(!hasV) {
                logAndCb("assemble","âš  Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª - Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ");
                writeToFile("assemble: no videos in "+vids.getAbsolutePath());
            }
            if(!hasA) {
                logAndCb("assemble","âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª - Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠ ØªØ¬Ø±ÙŠØ¨ÙŠ");
                writeToFile("assemble: no audios in "+auds.getAbsolutePath());
            }

            String outPath=pref.getVideoEndPath()+"/final_"+System.currentTimeMillis()+".mp4";
            ensureParentDir(outPath);
            createPlaceholderMp4(outPath, lastDurationMs);

            logAndCb("assemble","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø±Ø¬: "+outPath);
            if(cb!=null) cb.onFinished(outPath);
            writeToFile("âœ… Finished (placeholder): "+outPath);
        }catch(Exception e){
            safeCbError("assemble","Exception: "+e.getMessage());
            writeToFile("assemble exception: "+e.getMessage());
        }
    }

    private void ensureParentDir(String path){
        try{
            File f = new File(path);
            File parent = f.getParentFile();
            if(parent!=null && !parent.exists()) parent.mkdirs();
        }catch(Exception ignored){}
    }

    private void createPlaceholderMp4(String outPath, int durationMs){
        FileOutputStream fos = null;
        try{
            fos = new FileOutputStream(outPath);
            String header = "AI-AutoCreate Placeholder MP4\n";
            fos.write(header.getBytes("UTF-8"));

            int bytes = Math.max(1024, Math.min(256*1024, durationMs<=0? 32*1024 : durationMs/10));
            byte[] buf = new byte[1024];
            for(int i=0;i<buf.length;i++) buf[i] = (byte)(i & 0xFF);
            int written = 0;
            while(written < bytes){
                int toWrite = Math.min(1024, bytes - written);
                fos.write(buf, 0, toWrite);
                written += toWrite;
            }
            fos.flush();
        }catch(Exception e){
            writeToFile("createPlaceholderMp4 failed: "+e.getMessage());
        }finally{
            try{ if(fos!=null) fos.close(); }catch(Exception ignored){}
        }
    }

    private void logAndCb(String stage,String msg){
        if(cb!=null) cb.onStageProgress(stage,msg);
        writeToFile(stage+" => "+msg);
        Log.i(TAG,stage+" => "+msg);
    }

    private void writeToFile(String text){
        try{
            if(logFile==null) return;
            FileWriter fw=new FileWriter(logFile,true);
            PrintWriter pw=new PrintWriter(fw);
            pw.println(System.currentTimeMillis()+" | "+text);
            pw.flush();
            pw.close();
        }catch(Exception ignored){}
    }

    private void logReqPayload(String url, String payload){
        try{
            if(payload==null) payload="";
            String cut = payload;
            if(cut.length()>1000) cut = cut.substring(0,1000) + "...(truncated)";
            writeToFile("REQ to "+url+" | payload="+cut);
        }catch(Exception ignored){}
    }

    private void safeCbError(String stage,String msg){
        try{ if(cb!=null) cb.onError(stage,msg); }catch(Exception ignored){}
        Log.e(TAG,stage+" ERROR: "+msg);
    }

    private String shortText(String s,int max){
        if(s==null) return "";
        String t=s.trim();
        if(t.length()<=max) return t;
        return t.substring(0,max)+"...";
    }

    // ====== ØµÙˆØ± ======
    private void processImagesFromScripts(File scriptsDir, File imagesDir, String aspect, int targetW, int targetH){
        if(checkCancel()) return;
        if(hfQuotaExceeded){ logAndCb("image","â›” ØªÙ… ØªØ®Ø·ÙŠ Ø§Ù„ØµÙˆØ±: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ© (model="+hfQuotaModel+")"); return; }

        List<File> list = listNumberedFiles(scriptsDir, "MSHHD", ".txt");
        if(list.isEmpty()){
            logAndCb("image","â­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª MSHHD ÙÙŠ "+scriptsDir.getAbsolutePath());
            return;
        }
        String hfToken = pref.getHfToken();
        String selectedModelId = pref.getSelectedSdModel();
        String endpoint = pref.getHfSdUrl();

        boolean isRefiner = isSdxlRefinerModel(selectedModelId);
        String effectiveModelId = isRefiner ? "stabilityai/stable-diffusion-xl-base-1.0" : selectedModelId;

        for(int i=0;i<list.size();i++){
            if(checkCancel()) return;
            if(hfQuotaExceeded){ logAndCb("image","â›” ØªÙˆÙ‚Ù Ø§Ù„ØµÙˆØ±: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ©"); return; }

            File f = list.get(i);
            int idx = extractIndex(f.getName(), "MSHHD");
            String promptRaw = readAll(f);

            String p1 = StylePacks.patchPromptForImage(this.selectedImageStyle, effectiveModelId, promptRaw);
            String finalPrompt = patchPromptForModel(effectiveModelId, p1);

            String outName = "MSHHD"+idx+"_MG.png";
            File outFile = new File(imagesDir, outName);

            int[] genSize = preferredGenSizeForModel(effectiveModelId, aspect);
            int genW = genSize[0], genH = genSize[1];
            ImagePreset preset = imagePresetForModel(effectiveModelId);

            logAndCb("image","ğŸ–¼ "+outName+" | gen "+genW+"x"+genH+" â†’ "+targetW+"x"+targetH+" ("+aspect+")");

            byte[] img = null;
            Exception lastEx = null;

            try{
                if(endpoint!=null && endpoint.trim().length()>0){
                    // endpoint Ù…Ø®ØµØµ â†’ Ø¬Ø±Ù‘Ø¨ JSON variants Ù…Ø¨Ø§Ø´Ø±Ø©
                    try{
                        img = tryImageJsonVariants(endpoint, (isHfEndpoint(endpoint)? hfToken : null), finalPrompt, genW, genH, preset, true);
                        if(img!=null && img.length>0){
                            logAndCb("image","âœ… endpoint (json-variants)");
                        }
                    }catch(Exception exEnd){
                        lastEx = exEnd;
                        if(handleIfQuotaExceeded(exEnd,"image", endpoint)) return;
                    }
                } else {
                    String[] candidates = imageModelCandidates(effectiveModelId);
                    for(int c=0;c<candidates.length;c++){
                        String mid = candidates[c];
                        String url = hfModelApiUrl(mid);
                        try{
                            img = tryImageJsonVariants(url, hfToken, finalPrompt, genW, genH, preset, true);
                            if(img!=null && img.length>0){
                                logAndCb("image","âœ… model="+mid+" (json-variants)");
                                break;
                            }
                        }catch(Exception exTry){
                            lastEx = exTry;
                            if(handleIfQuotaExceeded(exTry,"image", mid)) return;
                            int code = parseHttpCodeFromMessage(exTry.getMessage());
                            if(code==404 || code==403){
                                writeToFile("image try alt "+mid+" => "+exTry.getMessage());
                                continue;
                            }
                            if(code>=500 && code<600){
                                int smallW = Math.max(512, (genW/2/8)*8);
                                int smallH = Math.max(512, (genH/2/8)*8);
                                try{
                                    img = tryImageJsonVariants(url, hfToken, finalPrompt, smallW, smallH, new ImagePreset(Math.max(1,preset.steps-4), Math.max(0.1,preset.guidance-0.5)), true);
                                    if(img!=null && img.length>0){
                                        logAndCb("image","âœ… model="+mid+" (small + variants)");
                                        break;
                                    }
                                }catch(Exception exSmall){
                                    lastEx = exSmall;
                                    if(handleIfQuotaExceeded(exSmall,"image", mid)) return;
                                }
                            }
                        }
                    }
                }
            }catch(Exception e){ lastEx = e; }

            // Fallback Ø¥Ø¶Ø§ÙÙŠ (Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø³ÙŠØ·Ø©: inputs + parameters ÙÙ‚Ø·)
            if (img == null || img.length == 0) {
                try {
                    String paramsJson =
                        "{"
                        + "\"width\":" + genW + ","
                        + "\"height\":" + genH + ","
                        + "\"num_inference_steps\":" + preset.steps + ","
                        + "\"guidance_scale\":" + preset.guidance + ","
                        + "\"negative_prompt\":\"" + escapeJson(DEFAULT_NEGATIVE) + "\""
                        + "}";
                    img = hfImageSimpleJson(hfToken, effectiveModelId, finalPrompt, paramsJson);
                    if (img != null && img.length > 0) {
                        logAndCb("image","âœ… legacy JSON route model="+effectiveModelId);
                    }
                } catch (Exception exLegacy) {
                    lastEx = exLegacy;
                    if (handleIfQuotaExceeded(exLegacy, "image", effectiveModelId)) return;
                }
            }

            if(img!=null && img.length>0){
                try{
                    byte[] toSave = resizeImageBytes(img, targetW, targetH);
                    FileOutputStream fos=new FileOutputStream(outFile);
                    fos.write(toSave); fos.close();
                    logAndCb("image","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ "+outFile.getAbsolutePath());
                }catch(Exception e){
                    logAndCb("image","âš  ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©: "+e.getMessage());
                }
            } else {
                if(lastEx!=null) logAndCb("image","âš  ÙØ´Ù„ "+outName+": "+lastEx.getMessage());
                else logAndCb("image","âš  ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ "+outName);
            }
            simulate();
        }
    }

    // ====== ÙÙŠØ¯ÙŠÙˆ ======
    private void processImg2VidFromScripts(File scriptsDir, File imagesDir, File videosDir, String aspectRatio, int videoDurationMs, int targetW, int targetH){
        if(checkCancel()) return;
        if(hfQuotaExceeded){ logAndCb("img2vid","â›” ØªÙ… ØªØ®Ø·ÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ© (model="+hfQuotaModel+")"); return; }

        List<File> list = listNumberedFiles(scriptsDir, "HAREKA", ".txt");
        if(list.isEmpty()){
            logAndCb("img2vid","â­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª HAREKA ÙÙŠ "+scriptsDir.getAbsolutePath());
            return;
        }
        String hfToken = pref.getHfToken();
        String modelId = pref.getSelectedImg2VidModel();

        int[] inSize = preferredVideoInputSizeForModel(modelId, aspectRatio);
        int inW = inSize[0], inH = inSize[1];

        int perClipMs = Math.max(1500, videoDurationMs / Math.max(1, list.size()));

        for(int i=0;i<list.size();i++){
            if(checkCancel()) return;
            if(hfQuotaExceeded){ logAndCb("img2vid","â›” ØªÙˆÙ‚Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ©"); return; }

            File f = list.get(i);
            int idx = extractIndex(f.getName(), "HAREKA");
            String motionPrompt = readAll(f);

            File baseImg = new File(imagesDir, "MSHHD"+idx+"_MG.png");
            if(!baseImg.exists()){
                logAndCb("img2vid","âš  Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: "+("MSHHD"+idx+"_MG.png")+"ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆ ØªØ¬Ø±ÙŠØ¨ÙŠ");
            }

            String outName = "HAREKA"+idx+"_VO.mp4";
            File outFile = new File(videosDir, outName);

            MotionParams mp = parseMotionPrompt(motionPrompt, perClipMs);
            VideoDefaults vd = videoDefaultsForModel(modelId, mp, perClipMs, inW, inH);

            logAndCb("img2vid","ğŸ "+outName+" | in "+inW+"x"+inH+" | "+vd.fps+"fps, "+vd.frames+"f, steps="+vd.steps+", g="+vd.guidance+(vd.motionIntensity!=null?(", motion_intensity="+vd.motionIntensity):""));

            boolean ok=false;
            try{
                byte[] vid = null;
                if(baseImg.exists()){
                    byte[] imgBytes = readBytes(baseImg);
                    imgBytes = resizeImageBytes(imgBytes, inW, inH);
                    vid = callImg2Vid(modelId, imgBytes, motionPrompt, vd, mp, inW, inH, hfToken);
                }

                if(vid!=null && vid.length>0){
                    FileOutputStream fos=new FileOutputStream(outFile);
                    fos.write(vid); fos.close();
                    ok=true;
                    logAndCb("img2vid","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ "+outFile.getAbsolutePath());
                }
            }catch(Exception e){
                writeToFile("img2vid gen fail: "+e.getMessage());
                logAndCb("img2vid","âš  ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: "+e.getMessage());
            }

            if(!ok){
                createPlaceholderMp4(outFile.getAbsolutePath(), Math.max(2000, perClipMs));
                logAndCb("img2vid","âš  ÙÙŠØ¯ÙŠÙˆ ØªØ¬Ø±ÙŠØ¨ÙŠ: "+outFile.getAbsolutePath());
            }
            simulate();
        }
    }

    // ====== TTS ======
    private void processTtsFromScripts(File scriptsDir, File audiosDir, String voiceChoice){
        if(checkCancel()) return;
        if(hfQuotaExceeded){ logAndCb("tts","â›” ØªÙ… ØªØ®Ø·ÙŠ TTS: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ© (model="+hfQuotaModel+")"); return; }

        List<File> ordered = new ArrayList<File>();
        File narrator = new File(scriptsDir, "SCRIPTS_SSML.txt");
        if(narrator.exists()) ordered.add(narrator);
        List<File> chars = listNumberedFiles(scriptsDir, "SCRIPTS_SSML_V", ".txt");
        for(int i=0;i<chars.size();i++) ordered.add(chars.get(i));
        if(ordered.isEmpty()){
            logAndCb("tts","â­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª SSML ÙÙŠ "+scriptsDir.getAbsolutePath());
            return;
        }

        String ttsUrl  = pref.getTtsUrl();
        String hfToken = pref.getHfToken();
        String ttsModel= pref.getSelectedTtsModel();

        for(int i=0;i<ordered.size();i++){
            if(checkCancel()) return;
            if(hfQuotaExceeded){ logAndCb("tts","â›” ØªÙˆÙ‚Ù TTS: Ù†ÙØ§Ø¯ Ø§Ù„Ø­ØµØ©"); return; }

            File f = ordered.get(i);
            String base = f.getName().replace(".txt","");
            String ssml = readAll(f);
            String text = stripSsml(ssml);
            String outName = base+"_AU.wav";
            File outFile = new File(audiosDir, outName);
            logAndCb("tts","ğŸ”Š ØªØ­ÙˆÙŠÙ„ "+base+" ...");

            byte[] audio=null;
            try{
                if(ttsUrl!=null && ttsUrl.trim().length()>0){
                    JSONObject jo = new JSONObject();
                    jo.put("ssml", ssml);
                    jo.put("voice", voiceChoice!=null? voiceChoice:"");

                    boolean useClone = VOICE_CLONE_OPTION.equals(voiceChoice)
                        && pref.getUseVoiceClone()
                        && pref.getVoiceSamplePath().length()>0;
                    jo.put("use_clone", useClone);

                    if(useClone){
                        String refPath = pref.getVoiceSamplePath();
                        String b64 = readFileB64(refPath);
                        jo.put("clone_b64", b64);
                        jo.put("clone_data_url", "data:audio/wav;base64,"+b64);
                        jo.put("clone_uri", refPath);
                        jo.put("sample_rate_hz", 24000);
                    }

                    try{
                        String payload = jo.toString();
                        logReqPayload(ttsUrl, payload);
                        HttpResp r = httpPostJsonResp(ttsUrl, payload, null, "audio/*,application/json", 70000, 120000);
                        audio = ensureAudioBytes(r);
                    }catch(Exception exTtsUrl){
                        if(handleIfQuotaExceeded(exTtsUrl,"tts", ttsUrl)) return;
                        throw exTtsUrl;
                    }
                } else {
                    String url = hfModelApiUrl(ttsModel);

                    boolean wantClone = VOICE_CLONE_OPTION.equals(voiceChoice)
                        && pref.getVoiceSamplePath().length()>0;

                    String dataUrl = null;
                    if(wantClone){
                        String refPath = pref.getVoiceSamplePath();
                        String b64 = readFileB64(refPath);
                        dataUrl = "data:audio/wav;base64,"+b64;
                    }

                    String group = ttsGroupForModel(ttsModel);
                    boolean got=false;

                    if(wantClone && (group.equals("xtts") || group.equals("valle") || group.equals("yourtts"))){
                        String payloadSpeaker =
                            "{"
                            + "\"inputs\":\""+escapeJson(text)+"\","
                            + "\"speaker_wav\":\""+escapeJson(dataUrl)+"\","
                            + "\"parameters\":{\"sample_rate\":24000},"
                            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
                            + "}";
                        try{
                            logReqPayload(url, payloadSpeaker);
                            HttpResp rA = httpPostJsonResp(url, payloadSpeaker, hfToken, "audio/*,application/json", 90000, 150000);
                            audio = ensureAudioBytes(rA);
                            got = (audio!=null && audio.length>0);
                        }catch(Exception exA){
                            if(handleIfQuotaExceeded(exA,"tts", ttsModel)) return;
                            writeToFile("hf tts speaker_wav failed: "+exA.getMessage());
                        }
                    }

                    if(!got){
                        String payloadTextOnly =
                            "{"
                            + "\"inputs\":\""+escapeJson(text)+"\","
                            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
                            + "}";
                        try{
                            logReqPayload(url, payloadTextOnly);
                            HttpResp r = httpPostJsonResp(url, payloadTextOnly, hfToken, "audio/*,application/json", 70000, 120000);
                            audio = ensureAudioBytes(r);
                            got = (audio!=null && audio.length>0);
                        }catch(Exception ex){
                            if(handleIfQuotaExceeded(ex,"tts", ttsModel)) return;
                            writeToFile("hf tts text-only failed: "+ex.getMessage());
                        }
                    }

                    if(wantClone && !got){
                        String payloadClone =
                            "{"
                            + "\"inputs\":{\"text\":\""+escapeJson(text)+"\",\"audio\":\""+escapeJson(dataUrl)+"\"},"
                            + "\"parameters\":{\"sample_rate\":24000},"
                            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
                            + "}";
                        try{
                            logReqPayload(url, payloadClone);
                            HttpResp r2 = httpPostJsonResp(url, payloadClone, hfToken, "audio/*,application/json", 90000, 150000);
                            audio = ensureAudioBytes(r2);
                        }catch(Exception ex2){
                            if(handleIfQuotaExceeded(ex2,"tts", ttsModel)) return;
                            writeToFile("hf tts clone failed: "+ex2.getMessage());
                        }
                    }
                }
            }catch(Exception e){
                writeToFile("tts fail: "+e.getMessage());
                logAndCb("tts","âš  ÙØ´Ù„ "+base+": "+e.getMessage());
            }

            if (audio == null || audio.length == 0) {
                try{
                    String pjson = "{\"sample_rate\":24000}";
                    String url = hfModelApiUrl(ttsModel);
                    String payload = (pjson==null) ? "{\"inputs\":\""+escapeJson(text)+"\"}" : "{\"inputs\":\""+escapeJson(text)+"\",\"parameters\":"+pjson+"}";
                    logReqPayload(url, payload);
                    audio = hfTtsSimpleJson(hfToken, ttsModel, text, pjson);
                    if(audio != null && audio.length > 0){
                        logAndCb("tts","âœ… HF simple JSON route");
                    }
                }catch(Exception exSimple){
                    if(handleIfQuotaExceeded(exSimple,"tts", ttsModel)) return;
                    writeToFile("hf tts simple failed: "+exSimple.getMessage());
                }
            }

            try{
                if(audio!=null && audio.length>0){
                    FileOutputStream fos=new FileOutputStream(outFile);
                    fos.write(audio); fos.close();
                    logAndCb("tts","âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ "+outFile.getAbsolutePath());
                } else {
                    logAndCb("tts","âš  ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØª Ù„Ù€ "+base);
                }
            }catch(Exception e){
                logAndCb("tts","âš  ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØµÙˆØª: "+e.getMessage());
            }
            simulate();
        }
    }

    // ====== Ø£Ø¯ÙˆØ§Øª Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØ±ØªÙŠØ¨ ======
    private List<File> listNumberedFiles(File dir, final String prefix, final String ext){
        List<File> out = new ArrayList<File>();
        if(dir==null || !dir.exists()) return out;
        File[] files = dir.listFiles();
        if(files==null) return out;
        for(int i=0;i<files.length;i++){
            File f=files[i];
            String name=f.getName();
            if(name.startsWith(prefix) && name.endsWith(ext)){
                out.add(f);
            }
        }
        Collections.sort(out, new Comparator<File>(){
                public int compare(File a, File b){
                    int ia = extractIndex(a.getName(), prefix);
                    int ib = extractIndex(b.getName(), prefix);
                    return ia - ib;
                }
            });
        return out;
    }

    private int extractIndex(String name, String prefix){
        try{
            String s = name.substring(prefix.length());
            int dot = s.indexOf('.');
            if(dot>=0) s = s.substring(0,dot);
            return Integer.parseInt(s.replaceAll("[^0-9]",""));
        }catch(Exception e){ return 0; }
    }

    private String readAll(File f){
        BufferedReader br=null;
        try{
            br=new BufferedReader(new InputStreamReader(new FileInputStream(f),"UTF-8"));
            StringBuilder sb=new StringBuilder();
            String line;
            while((line=br.readLine())!=null){ sb.append(line).append("\n"); }
            return sb.toString().trim();
        }catch(Exception e){ return ""; }
        finally{ try{ if(br!=null) br.close(); }catch(Exception ignored){} }
    }

    private byte[] readBytes(File f){
        ByteArrayOutputStream bos = new ByteArrayOutputStream();
        InputStream in=null;
        try{
            in=new FileInputStream(f);
            byte[] buf=new byte[8192]; int n;
            while((n=in.read(buf))>0){ bos.write(buf,0,n); }
            return bos.toByteArray();
        }catch(Exception e){ return null; }
        finally{ try{ if(in!=null) in.close(); }catch(Exception ignored){} }
    }

    // ====== Ø£Ø¯ÙˆØ§Øª Ù†ØµÙŠØ© ÙˆØ´Ø¨ÙƒÙŠØ© ======
    private String stripSsml(String ssml){
        if(ssml==null) return "";
        return ssml.replaceAll("<[^>]+>"," ").replace("&quot;","\"").replace("&amp;","&").trim();
    }

    private String escapeJson(String s){
        if(s==null) return "";
        StringBuilder sb=new StringBuilder();
        for(int i=0;i<s.length();i++){
            char c=s.charAt(i);
            switch(c){
                case '\\': sb.append("\\\\"); break;
                case '"': sb.append("\\\""); break;
                case '\n': sb.append("\\n"); break;
                case '\r': sb.append("\\r"); break;
                case '\t': sb.append("\\t"); break;
                default: sb.append(c);
            }
        }
        return sb.toString();
    }

    // ========== HTTP (Ù‚Ø¯ÙŠÙ…Ø© ØªØ±Ø¬Ø¹ Ø¨Ø§ÙŠØª) ==========
    private byte[] httpPostJsonExpectBytes(String url, String json, String bearer, String accept, int connTimeout, int readTimeout) throws Exception{
        HttpURLConnection c=(HttpURLConnection)new URL(url).openConnection();
        c.setConnectTimeout(connTimeout);
        c.setReadTimeout(readTimeout);
        c.setRequestMethod("POST");
        c.setDoOutput(true);
        c.setRequestProperty("User-Agent","AI-AutoCreate");
        c.setRequestProperty("Content-Type","application/json; charset=UTF-8");
        if(accept!=null && accept.length()>0) c.setRequestProperty("Accept", accept);
        if(bearer!=null && bearer.trim().length()>0) c.setRequestProperty("Authorization", normalizeBearer(bearer));
        OutputStream os=c.getOutputStream();
        os.write(json.getBytes("UTF-8")); os.flush(); os.close();
        int code=c.getResponseCode();
        InputStream is = (code>=200 && code<300)? c.getInputStream(): c.getErrorStream();
        byte[] data = readAllBytes(is);
        if(code<200 || code>=300){
            writeToFile("HTTP "+code+" from "+url+" => "+(data!=null? new String(data,"UTF-8"):""));
            throw new Exception("HTTP "+code);
        }
        return data;
    }

    private byte[] httpPostBytesExpectBytes(String url, byte[] payload, String bearer, String contentType, String accept, int connTimeout, int readTimeout) throws Exception{
        HttpURLConnection c=(HttpURLConnection)new URL(url).openConnection();
        c.setConnectTimeout(connTimeout);
        c.setReadTimeout(readTimeout);
        c.setRequestMethod("POST");
        c.setDoOutput(true);
        c.setRequestProperty("User-Agent","AI-AutoCreate");
        if(contentType!=null) c.setRequestProperty("Content-Type", contentType);
        if(accept!=null) c.setRequestProperty("Accept", accept);
        if(bearer!=null && bearer.trim().length()>0) c.setRequestProperty("Authorization", normalizeBearer(bearer));
        OutputStream os=c.getOutputStream();
        os.write(payload); os.flush(); os.close();
        int code=c.getResponseCode();
        InputStream is = (code>=200 && code<300)? c.getInputStream(): c.getErrorStream();
        byte[] data = readAllBytes(is);
        if(code<200 || code>=300){
            writeToFile("HTTP "+code+" from "+url+" => "+(data!=null? new String(data,"UTF-8"):""));
            throw new Exception("HTTP "+code);
        }
        return data;
    }

    private String normalizeBearer(String tok){
        if(tok==null) return "";
        String t = tok.trim();
        if(t.length()==0) return "";
        if(t.startsWith("Bearer ")) return t;
        return "Bearer "+t;
    }

    private byte[] readAllBytes(InputStream in) throws Exception{
        if(in==null) return new byte[0];
        ByteArrayOutputStream bos=new ByteArrayOutputStream();
        byte[] buf=new byte[8192]; int n;
        while((n=in.read(buf))>0){ bos.write(buf,0,n); }
        in.close();
        return bos.toByteArray();
    }

    // ========== HTTP (Ø¬Ø¯ÙŠØ¯Ø©: ØªØ±Ø¬Ø¹ Ø§Ù„ÙƒÙˆØ¯ + Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ + Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ==========
    private static final class HttpResp {
        int code;
        String contentType;
        byte[] data;
    }

    private HttpResp httpPostJsonResp(String url, String json, String bearer, String accept,
                                      int connTimeout, int readTimeout) throws Exception {
        HttpURLConnection c=(HttpURLConnection)new java.net.URL(url).openConnection();
        c.setConnectTimeout(connTimeout);
        c.setReadTimeout(readTimeout);
        c.setRequestMethod("POST");
        c.setDoOutput(true);
        c.setRequestProperty("User-Agent","AI-AutoCreate");
        c.setRequestProperty("Content-Type","application/json; charset=UTF-8");
        c.setRequestProperty("x-use-cache","false");
        if(accept!=null && accept.length()>0) c.setRequestProperty("Accept", accept);
        if(bearer!=null && bearer.trim().length()>0) c.setRequestProperty("Authorization", normalizeBearer(bearer));
        OutputStream os=c.getOutputStream();
        os.write(json.getBytes("UTF-8")); os.flush(); os.close();

        HttpResp r = new HttpResp();
        r.code = c.getResponseCode();
        r.contentType = c.getContentType();
        InputStream is = (r.code>=200 && r.code<300)? c.getInputStream(): c.getErrorStream();
        r.data = readAllBytes(is);
        if(r.code<200 || r.code>=300){
            writeToFile("HTTP "+r.code+" from "+url+" => "+(r.data!=null? new String(r.data,"UTF-8"):""));
            throw new Exception("HTTP "+r.code);
        }
        return r;
    }

    private HttpResp httpPostBytesResp(String url, byte[] payload, String bearer, String contentType,
                                       String accept, int connTimeout, int readTimeout) throws Exception {
        HttpURLConnection c=(HttpURLConnection)new java.net.URL(url).openConnection();
        c.setConnectTimeout(connTimeout);
        c.setReadTimeout(readTimeout);
        c.setRequestMethod("POST");
        c.setDoOutput(true);
        c.setRequestProperty("User-Agent","AI-AutoCreate");
        c.setRequestProperty("x-use-cache","false");
        if(contentType!=null) c.setRequestProperty("Content-Type", contentType);
        if(accept!=null) c.setRequestProperty("Accept", accept);
        if(bearer!=null && bearer.trim().length()>0) c.setRequestProperty("Authorization", normalizeBearer(bearer));
        OutputStream os=c.getOutputStream();
        os.write(payload); os.flush(); os.close();

        HttpResp r = new HttpResp();
        r.code = c.getResponseCode();
        r.contentType = c.getContentType();
        InputStream is = (r.code>=200 && r.code<300)? c.getInputStream(): c.getErrorStream();
        r.data = readAllBytes(is);
        if(r.code<200 || r.code>=300){
            writeToFile("HTTP "+r.code+" from "+url+" => "+(r.data!=null? new String(r.data,"UTF-8"):""));
            throw new Exception("HTTP "+r.code);
        }
        return r;
    }

    // ====== Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø¶Ø§ÙØ© ======

    // Ø¥ØµÙ„Ø§Ø­: Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· HF Ù…Ø¹ ØªØ±Ù…ÙŠØ² owner Ùˆ repo Ø¨Ø¯ÙˆÙ† ØªØ±Ù…ÙŠØ² '/'
    private String hfModelApiUrl(String modelId){
        if (modelId == null) return "";
        if (modelId.startsWith("http://") || modelId.startsWith("https://")) return modelId;
        try {
            String[] parts = modelId.split("/");
            if (parts != null && parts.length == 2) {
                String owner = URLEncoder.encode(parts[0], "UTF-8");
                String repo  = URLEncoder.encode(parts[1], "UTF-8");
                return "https://api-inference.huggingface.co/models/" + owner + "/" + repo;
            }
            return "https://api-inference.huggingface.co/models/" + modelId.replace(" ", "%20");
        } catch (Exception e) {
            return "https://api-inference.huggingface.co/models/" + modelId;
        }
    }

    // ØªØ¬Ø±Ø¨Ø© Ø£Ø´ÙƒØ§Ù„ JSON Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ØªÙØ§Ø¯ÙŠ 400 (Ù…Ø¹ Accept=image/png)
    private byte[] tryImageJsonVariants(String url, String hfToken, String prompt, int w, int h, ImagePreset preset, boolean withOptions) throws Exception {
        String opts = withOptions ? ",\"options\":{\"wait_for_model\":true,\"use_cache\":false}" : "";
        String params = "\"parameters\":{\"width\":"+w+",\"height\":"+h+",\"num_inference_steps\":"+preset.steps+",\"guidance_scale\":"+preset.guidance+",\"negative_prompt\":\""+escapeJson(DEFAULT_NEGATIVE)+"\"}";

        // A) inputs ÙƒØ³Ù„Ø³Ù„Ø© + parameters + options
        String pA = "{\"inputs\":\""+escapeJson(prompt)+"\","+params+opts+"}";
        try {
            logReqPayload(url, pA);
            HttpResp r = httpPostJsonResp(url, pA, hfToken, "image/png", 90000, 150000);
            byte[] img = ensureImageBytes(r);
            if (img!=null && img.length>0) return img;
        } catch (Exception eA) {
            int code = parseHttpCodeFromMessage(eA.getMessage());
            if (code != 400) throw eA;
        }

        // B) inputs ÙƒØ³Ù„Ø³Ù„Ø© + parameters (Ø¨Ø¯ÙˆÙ† options)
        String pB = "{\"inputs\":\""+escapeJson(prompt)+"\","+params+"}";
        try {
            logReqPayload(url, pB);
            HttpResp r = httpPostJsonResp(url, pB, hfToken, "image/png", 90000, 150000);
            byte[] img = ensureImageBytes(r);
            if (img!=null && img.length>0) return img;
        } catch (Exception eB) {
            int code = parseHttpCodeFromMessage(eB.getMessage());
            if (code != 400) throw eB;
        }

        // C) inputs ÙƒÙƒØ§Ø¦Ù† {prompt:""} + parameters
        String pC = "{\"inputs\":{\"prompt\":\""+escapeJson(prompt)+"\"},"+params+"}";
        try {
            logReqPayload(url, pC);
            HttpResp r = httpPostJsonResp(url, pC, hfToken, "image/png", 90000, 150000);
            byte[] img = ensureImageBytes(r);
            if (img!=null && img.length>0) return img;
        } catch (Exception eC) {
            int code = parseHttpCodeFromMessage(eC.getMessage());
            if (code != 400) throw eC;
        }

        // D) (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) top-level Ø¨Ø¯ÙˆÙ† inputs â€” ØºØ§Ù„Ø¨Ù‹Ø§ Ø³ÙŠØ±ÙØ¶Ù‡ SDXLØŒ Ù†Ø­ØªÙØ¸ Ø¨Ù‡ ÙÙ‚Ø· ÙƒÙ€ fallback
        String pD = "{\"prompt\":\""+escapeJson(prompt)+"\",\"width\":"+w+",\"height\":"+h+",\"num_inference_steps\":"+preset.steps+",\"guidance_scale\":"+preset.guidance+",\"negative_prompt\":\""+escapeJson(DEFAULT_NEGATIVE)+"\"}";
        try {
            logReqPayload(url, pD);
            HttpResp r = httpPostJsonResp(url, pD, hfToken, "image/png", 90000, 150000);
            byte[] img = ensureImageBytes(r);
            if (img!=null && img.length>0) return img;
        } catch (Exception eD) {
            int code = parseHttpCodeFromMessage(eD.getMessage());
            if (code != 400) throw eD;
        }

        // E) inputs ÙÙ‚Ø·
        String pE = "{\"inputs\":\""+escapeJson(prompt)+"\"}";
        try {
            logReqPayload(url, pE);
            HttpResp r = httpPostJsonResp(url, pE, hfToken, "image/png", 90000, 150000);
            byte[] img = ensureImageBytes(r);
            if (img!=null && img.length>0) return img;
        } catch (Exception eE) {
            int code = parseHttpCodeFromMessage(eE.getMessage());
            if (code != 400) throw eE;
        }

        return null;
    }

    // multipart (inputs + parameters + fileBytes)
    private HttpResp httpPostMultipartResp(String url, String hfToken, String prompt, String parametersJson,
                                           byte[] fileBytes, String fileName, String fileContentType,
                                           int connTimeout, int readTimeout) throws Exception {
        String boundary = "----HFBoundary" + System.currentTimeMillis();
        HttpURLConnection c = (HttpURLConnection)new java.net.URL(url).openConnection();
        c.setConnectTimeout(connTimeout);
        c.setReadTimeout(readTimeout);
        c.setRequestMethod("POST");
        c.setDoOutput(true);
        c.setRequestProperty("User-Agent", "AI-AutoCreate");
        c.setRequestProperty("Accept", "*/*");
        c.setRequestProperty("Content-Type", "multipart/form-data; boundary=" + boundary);
        if(hfToken!=null && hfToken.trim().length()>0) c.setRequestProperty("Authorization", normalizeBearer(hfToken));

        OutputStream out = c.getOutputStream();
        PrintWriter w = new PrintWriter(new OutputStreamWriter(out,"UTF-8"), true);

        // inputs
        w.append("--").append(boundary).append("\r\n");
        w.append("Content-Disposition: form-data; name=\"inputs\"\r\n\r\n");
        w.append(prompt==null?"":prompt).append("\r\n");

        // parameters
        String pj = (parametersJson==null || parametersJson.trim().length()==0) ? "{}" : parametersJson;
        w.append("--").append(boundary).append("\r\n");
        w.append("Content-Disposition: form-data; name=\"parameters\"\r\n\r\n");
        w.append(pj).append("\r\n");

        // file
        if(fileBytes!=null && fileBytes.length>0){
            String fname = (fileName!=null && fileName.length()>0)? fileName : "image.png";
            String ctype = (fileContentType!=null && fileContentType.length()>0)? fileContentType : "application/octet-stream";
            w.append("--").append(boundary).append("\r\n");
            w.append("Content-Disposition: form-data; name=\"file\"; filename=\"").append(fname).append("\"\r\n");
            w.append("Content-Type: ").append(ctype).append("\r\n\r\n");
            w.flush();
            out.write(fileBytes);
            out.flush();
            w.append("\r\n");
        }

        w.append("--").append(boundary).append("--").append("\r\n");
        w.flush(); w.close(); out.close();

        HttpResp r = new HttpResp();
        r.code = c.getResponseCode();
        r.contentType = c.getContentType();
        InputStream is = (r.code>=200 && r.code<300)? c.getInputStream(): c.getErrorStream();
        r.data = readAllBytes(is);
        if(r.code<200 || r.code>=300){
            writeToFile("HTTP "+r.code+" multipart => "+(r.data!=null? new String(r.data,"UTF-8"):""));
            throw new Exception("HTTP "+r.code);
        }
        return r;
    }

    // ÙØ§Ù„Ø¨Ø§Ùƒ ØµÙˆØ±Ø©: JSON inputs + parameters (Accept=image/png)
    private byte[] hfImageSimpleJson(String hfToken, String modelId, String prompt, String paramsJson) throws Exception {
        String url = hfModelApiUrl(modelId);
        String payload = (paramsJson==null || paramsJson.trim().length()==0)
            ? "{\"inputs\":\""+escapeJson(prompt)+"\"}"
            : "{\"inputs\":\""+escapeJson(prompt)+"\",\"parameters\":"+paramsJson+"}";
        logReqPayload(url, payload);
        HttpResp r = httpPostJsonResp(url, payload, hfToken, "image/png", 90000, 150000);
        return ensureImageBytes(r);
    }

    // ÙØ§Ù„Ø¨Ø§Ùƒ TTS: JSON inputs (+ parameters)
    private byte[] hfTtsSimpleJson(String hfToken, String modelId, String text, String paramsJson) throws Exception {
        String url = hfModelApiUrl(modelId);
        String payload = (paramsJson==null || paramsJson.trim().length()==0)
            ? "{\"inputs\":\""+escapeJson(text)+"\"}"
            : "{\"inputs\":\""+escapeJson(text)+"\",\"parameters\":"+paramsJson+"}";
        logReqPayload(url, payload);
        HttpResp r = httpPostJsonResp(url, payload, hfToken, "audio/*,application/json", 90000, 150000);
        return ensureAudioBytes(r);
    }

    // multipart Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
    private byte[] callImg2VidMultipart(String modelId, byte[] imgBytes, String motionPrompt,
                                        VideoDefaults vd, MotionParams mp, int inW, int inH, String hfToken) throws Exception {
        String url = hfModelApiUrl(modelId);
        StringBuilder sb = new StringBuilder();
        sb.append("{")
            .append("\"num_frames\":").append(vd.frames).append(",\"frames\":").append(vd.frames).append(",")
            .append("\"fps\":").append(vd.fps).append(",")
            .append("\"width\":").append(inW).append(",\"height\":").append(inH).append(",")
            .append("\"steps\":").append(vd.steps).append(",")
            .append("\"guidance_scale\":").append(vd.guidance);
        if (vd.includeSvdMicro) {
            sb.append(",\"motion_bucket_id\":").append(mp.motionBucketId)
                .append(",\"noise_aug_strength\":").append(mp.noiseAugStrength);
        }
        if (vd.motionIntensity!=null) sb.append(",\"motion_intensity\":").append(vd.motionIntensity.floatValue());
        if (vd.extraKV!=null && vd.extraKV.length()>0) sb.append(",").append(vd.extraKV);
        sb.append("}");
        String paramsJson = sb.toString();

        HttpResp r = httpPostMultipartResp(url, hfToken, motionPrompt, paramsJson, imgBytes, "frame.png", "image/png",
                                           150000, 300000);
        return ensureVideoBytes(r);
    }

    private boolean isJsonContentType(String ct){
        if(ct==null) return false;
        String s=ct.toLowerCase();
        return s.indexOf("application/json")>=0 || s.indexOf("text/json")>=0 || s.indexOf("+json")>=0;
    }
    private boolean looksLikeJson(byte[] data){
        if(data==null || data.length<1) return false;
        char c1=(char)data[0];
        return c1=='{' || c1=='[';
    }
    private String strUtf8(byte[] b){
        try{ return (b==null)?"":new String(b,"UTF-8"); }catch(Exception e){ return ""; }
    }
    private byte[] decodeB64(String b64){
        try{ return android.util.Base64.decode(b64, android.util.Base64.DEFAULT); }catch(Throwable t){ return null; }
    }
    private int indexOfAny(String s, String[] needles){
        if(s==null||needles==null) return -1;
        for(int i=0;i<needles.length;i++){
            int p = s.indexOf(needles[i]);
            if(p>=0) return p;
        }
        return -1;
    }

    private String extractBase64FromJson(String json){
        if(json==null) return null;
        int i = indexOfAny(json, new String[]{"data:image", "data:video", "data:audio"});
        if(i>=0){
            int comma = json.indexOf(',', i);
            if(comma>0){
                int end = json.indexOf('"', comma+1);
                if(end<0) end = json.indexOf('}', comma+1);
                if(end<0) end = json.length();
                String b64 = json.substring(comma+1, end).trim();
                if(b64.length()>16) return b64;
            }
        }
        i = json.indexOf("\"b64_json\"");
        if(i>=0){
            int colon = json.indexOf(':', i);
            int q1 = json.indexOf('"', colon+1);
            int q2 = (q1>0)? json.indexOf('"', q1+1) : -1;
            if(q1>0 && q2>q1) return json.substring(q1+1,q2);
        }
        String[] keys = new String[]{"\"image\"", "\"audio\"", "\"video\""};
        for(int k=0;k<keys.length;k++){
            int j=json.indexOf(keys[k]);
            if(j>=0){
                int colon=json.indexOf(':', j);
                int q1=json.indexOf('"', colon+1);
                int q2=(q1>0)? json.indexOf('"', q1+1) : -1;
                if(q1>0 && q2>q1){
                    String v=json.substring(q1+1,q2);
                    if(v.startsWith("data:") && v.indexOf("base64,")>0){
                        return v.substring(v.indexOf("base64,")+7);
                    }
                }
            }
        }
        return null;
    }

    private byte[] ensureImageBytes(HttpResp r){
        if(r==null || r.data==null || r.data.length==0) return null;
        if(r.contentType!=null && r.contentType.toLowerCase().startsWith("image/")) return r.data;
        if(isJsonContentType(r.contentType) || looksLikeJson(r.data)){
            String b64 = extractBase64FromJson(strUtf8(r.data));
            return (b64!=null)? decodeB64(b64) : null;
        }
        return r.data;
    }
    private byte[] ensureVideoBytes(HttpResp r){
        if(r==null || r.data==null || r.data.length==0) return null;
        String ct = (r.contentType==null)?"":r.contentType.toLowerCase();
        if(ct.startsWith("video/") || ct.indexOf("mp4")>=0 || ct.indexOf("octet-stream")>=0 || ct.indexOf("application/zip")>=0){
            return r.data;
        }
        if(isJsonContentType(ct) || looksLikeJson(r.data)){
            String b64 = extractBase64FromJson(strUtf8(r.data));
            return (b64!=null)? decodeB64(b64) : null;
        }
        return r.data;
    }
    private byte[] ensureAudioBytes(HttpResp r){
        if(r==null || r.data==null || r.data.length==0) return null;
        String ct = (r.contentType==null)?"":r.contentType.toLowerCase();
        if(ct.startsWith("audio/") || ct.indexOf("wav")>=0 || ct.indexOf("flac")>=0 || ct.indexOf("mpeg")>=0) return r.data;
        if(isJsonContentType(ct) || looksLikeJson(r.data)){
            String b64 = extractBase64FromJson(strUtf8(r.data));
            return (b64!=null)? decodeB64(b64) : null;
        }
        return r.data;
    }

    // ====== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ======
    private int[] computeTargetSize(String aspect, String quality){
        String a = (aspect==null||aspect.trim().length()==0) ? "16:9" : aspect.trim();
        String q = (quality==null||quality.trim().length()==0) ? "1080p" : quality.trim().toLowerCase();

        int w=1920, h=1080;

        if ("16:9".equals(a)) {
            if ("480p".equals(q))      { w=848;  h=480;  }
            else if ("720p".equals(q)) { w=1280; h=720;  }
            else if ("1080p".equals(q)){ w=1920; h=1080; }
            else if ("2k".equals(q))   { w=2560; h=1440; }
            else if ("4k".equals(q))   { w=3840; h=2160; }
        } else if ("9:16".equals(a)) {
            if ("480p".equals(q))      { w=480;  h=848;  }
            else if ("720p".equals(q)) { w=720;  h=1280; }
            else if ("1080p".equals(q)){ w=1080; h=1920; }
            else if ("2k".equals(q))   { w=1440; h=2560; }
            else if ("4k".equals(q))   { w=2160; h=3840; }
        } else if ("1:1".equals(a)) {
            if ("480p".equals(q))      { w=480;  h=480;  }
            else if ("720p".equals(q)) { w=720;  h=720;  }
            else if ("1080p".equals(q)){ w=1080; h=1080; }
            else if ("2k".equals(q))   { w=1440; h=1440; }
            else if ("4k".equals(q))   { w=2160; h=2160; }
        } else {
            try{
                String[] parts = a.split(":");
                int aw = Integer.parseInt(parts[0].trim());
                int ah = Integer.parseInt(parts[1].trim());
                int base = "480p".equals(q)?480 : "720p".equals(q)?720 : "2k".equals(q)?1440 : "4k".equals(q)?2160 : 1080;
                h = base;
                w = (int)Math.round((double)base * aw / (double)ah);
            }catch(Exception ignored){}
        }
        w = Math.max(8, (w/8)*8);
        h = Math.max(8, (h/8)*8);
        return new int[]{w,h};
    }

    // ====== ØªØ­Ø¬ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø© ======
    private byte[] resizeImageBytes(byte[] data, int targetW, int targetH){
        try{
            Bitmap bmp = BitmapFactory.decodeByteArray(data, 0, data.length);
            if(bmp==null) return data;
            if(bmp.getWidth()==targetW && bmp.getHeight()==targetH) return data;
            Bitmap scaled = Bitmap.createScaledBitmap(bmp, targetW, targetH, true);
            ByteArrayOutputStream bos = new ByteArrayOutputStream();
            scaled.compress(Bitmap.CompressFormat.PNG, 100, bos);
            byte[] out = bos.toByteArray();
            try{ bos.close(); }catch(Exception ignored){}
            try{ scaled.recycle(); }catch(Exception ignored){}
            try{ bmp.recycle(); }catch(Exception ignored){}
            return out;
        }catch(Exception e){
            writeToFile("resizeImageBytes fail: "+e.getMessage());
            return data;
        }
    }

    // ====== Ù…Ø±Ø´Ø­Ø§Øª + Ù…Ø±Ø´Ø­ÙŠÙ† ======
    private String[] imageModelCandidates(String modelId){
        if(modelId==null) return new String[]{"stabilityai/stable-diffusion-xl-base-1.0"};
        String m = modelId.toLowerCase();

        if(m.indexOf("openjourney")>=0){
            return new String[]{
                "prompthero/openjourney-v4",
                "prompthero/openjourney",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("dreamlike-photoreal")>=0){
            return new String[]{
                "dreamlike-art/dreamlike-photoreal-2.0",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("dreamshaper")>=0){
            return new String[]{
                "Lykon/dreamshaper-8",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("realistic_vision")>=0 || m.indexOf("realistic-vision")>=0){
            return new String[]{
                "SG161222/Realistic_Vision_V6.0_B1_noVAE",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("anything")>=0){
            return new String[]{
                "xyn-ai/anything-v4.0",
                "hakurei/waifu-diffusion-v1-4",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("waifu-diffusion")>=0){
            return new String[]{
                "hakurei/waifu-diffusion-v1-4",
                "xyn-ai/anything-v4.0",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("portraitplus")>=0){
            return new String[]{
                "wavymulder/portraitplus",
                "stabilityai/stable-diffusion-xl-base-1.0"
            };
        }
        if(m.indexOf("mo-di")>=0 || m.indexOf("mo_di")>=0 || m.indexOf("modi")>=0){
            return new String[]{
                "nitrosocke/mo-di-diffusion",
                "runwayml/stable-diffusion-v1-5"
            };
        }
        if(m.indexOf("stable-diffusion-xl")>=0 || m.indexOf("sdxl")>=0){
            return new String[]{
                "stabilityai/stable-diffusion-xl-base-1.0"
            };
        }
        return new String[]{ modelId, "runwayml/stable-diffusion-v1-5" };
    }

    private int[] preferredGenSizeForModel(String modelId, String aspect){
        String m = (modelId==null)?"":modelId.toLowerCase();
        int longSide = 768;

        if(m.indexOf("stable-diffusion-xl")>=0 || m.indexOf("sdxl")>=0) longSide = 1024;
        else if(m.indexOf("dreamlike-photoreal")>=0) longSide = 768;
        else if(m.indexOf("openjourney")>=0) longSide = 768;
        else if(m.indexOf("dreamshaper")>=0) longSide = 768;
        else if(m.indexOf("realistic_vision")>=0 || m.indexOf("realistic-vision")>=0) longSide = 896;
        else if(m.indexOf("any")>=0 || m.indexOf("waifu")>=0) longSide = 768;
        else if(m.indexOf("portraitplus")>=0) longSide = 1024;
        else if(m.indexOf("mo-di")>=0 || m.indexOf("mo_di")>=0 || m.indexOf("modi")>=0) longSide = 768;

        int w = 1, h = 1;
        try{
            String a = (aspect==null||aspect.trim().length()==0) ? "1:1" : aspect.trim();
            String[] parts = a.split(":");
            int aw = Integer.parseInt(parts[0].trim());
            int ah = Integer.parseInt(parts[1].trim());
            boolean vertical = aw < ah;
            if(vertical){ h = longSide; w = (int)Math.round((double)longSide*aw/ah); }
            else { w = longSide; h = (int)Math.round((double)longSide*ah/aw); }
        }catch(Exception e){ w = longSide; h = longSide; }
        w = Math.max(8,(w/8)*8); h = Math.max(8,(h/8)*8);
        return new int[]{w,h};
    }

    private int[] preferredVideoInputSizeForModel(String modelId, String aspect){
        String m = (modelId==null)?"":modelId.toLowerCase();
        boolean wan = (m.indexOf("wan")>=0);
        boolean xt  = (m.indexOf("img2vid-xt")>=0);

        int longSide = xt? 1024 : 768;
        if(wan) longSide = 1280;

        int aw=16, ah=9;
        try{
            String a = (aspect==null||aspect.trim().length()==0)? "16:9":aspect.trim();
            String[] parts = a.split(":");
            aw = Integer.parseInt(parts[0].trim());
            ah = Integer.parseInt(parts[1].trim());
        }catch(Exception ignored){}

        boolean vertical = aw < ah;
        int w, h;
        if(wan){
            if(vertical){ w = 720; h = 1280; }
            else if(aw==ah){ w=h=720; }
            else { w=1280; h=720; }
        } else {
            if(vertical){ h = longSide; w = (int)Math.round((double)longSide*aw/ah); }
            else { w = longSide; h = (int)Math.round((double)longSide*ah/aw); }
        }
        w = Math.max(8,(w/8)*8);
        h = Math.max(8,(h/8)*8);
        return new int[]{w,h};
    }

    private String patchPromptForModel(String modelId, String prompt){
        if(prompt==null) prompt="";
        String m = (modelId==null)?"":modelId.toLowerCase();
        if(m.indexOf("openjourney")>=0){
            if(prompt.toLowerCase().indexOf("mdjrny")<0){
                prompt = "mdjrny-v4 style, " + prompt;
            }
        }
        return prompt;
    }

    private int parseHttpCodeFromMessage(String msg){
        try{
            if(msg==null) return -1;
            int idx = msg.indexOf("HTTP ");
            if(idx>=0){
                String s = msg.substring(idx+5).trim();
                int sp = s.indexOf(' ');
                String codeStr = (sp>0)? s.substring(0,sp) : s;
                return Integer.parseInt(codeStr.trim());
            }
        }catch(Exception ignored){}
        return -1;
    }

    private boolean handleIfQuotaExceeded(Exception ex, String stage, String modelId){
        int code = parseHttpCodeFromMessage(ex!=null? ex.getMessage(): null);
        if(code == 402){
            hfQuotaExceeded = true;
            hfQuotaModel = (modelId!=null? modelId : "");
            hfQuotaStage = (stage!=null? stage : "");
            String msg = "â›” Ù†ÙØ¯Øª Ø­ØµØªÙƒ Ø¹Ù„Ù‰ Hugging Face Ù„Ù„Ù…ÙˆØ¯ÙŠÙ„: "+hfQuotaModel+" (Ø§Ù„Ù…Ø±Ø­Ù„Ø©: "+hfQuotaStage+"). Ø­Ø¯Ù‘Ø« Ø­Ø³Ø§Ø¨Ùƒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Endpoint Ù…Ø®ØµØµ.";
            logAndCb(stage, msg);
            writeToFile(stage+" => HTTP 402 quota exceeded | model="+hfQuotaModel);
            return true;
        }
        return false;
    }

    private static class MotionParams {
        int fps;
        int numFrames;
        int motionBucketId;
        float noiseAugStrength;
    }

    private MotionParams parseMotionPrompt(String txt, int clipMs){
        MotionParams mp = new MotionParams();
        String s = (txt==null)? "" : txt.toLowerCase();

        mp.fps = 12;
        mp.motionBucketId = 120;
        mp.noiseAugStrength = 0.08f;

        if(s.indexOf("subtle")>=0 || s.indexOf("gentle")>=0 || s.indexOf("slow")>=0) {
            mp.motionBucketId = 80; mp.fps = 10; mp.noiseAugStrength = 0.06f;
        }
        if(s.indexOf("fast")>=0 || s.indexOf("quick")>=0 || s.indexOf("dynamic")>=0){
            mp.motionBucketId = 160; mp.fps = 14; mp.noiseAugStrength = 0.10f;
        }
        if(s.indexOf("handheld")>=0 || s.indexOf("shake")>=0){
            mp.motionBucketId = 180;
        }

        if(s.indexOf("dolly in")>=0 || s.indexOf("zoom in")>=0){ mp.motionBucketId += 10; }
        if(s.indexOf("dolly out")>=0 || s.indexOf("zoom out")>=0){ mp.motionBucketId += 5; }
        if(s.indexOf("pan left")>=0 || s.indexOf("pan right")>=0){ mp.motionBucketId += 8; }
        if(s.indexOf("tilt up")>=0 || s.indexOf("tilt down")>=0){ mp.motionBucketId += 6; }
        if(s.indexOf("parallax")>=0){ mp.motionBucketId += 12; }
        if(s.indexOf("time-lapse")>=0){ mp.fps = 8; }

        int frames = (int)Math.max(8, Math.round((mp.fps * (clipMs/1000.0))));
        mp.numFrames = frames;

        if(mp.motionBucketId < 1) mp.motionBucketId = 1;
        if(mp.motionBucketId > 240) mp.motionBucketId = 240;
        if(mp.noiseAugStrength < 0f) mp.noiseAugStrength = 0f;
        if(mp.noiseAugStrength > 0.2f) mp.noiseAugStrength = 0.2f;

        return mp;
    }

    private String b64(byte[] data){
        try{
            return android.util.Base64.encodeToString(data, android.util.Base64.NO_WRAP);
        }catch(Throwable t){ return ""; }
    }

    private String readFileB64(String path){
        try{
            if(path==null || path.trim().length()==0) return "";
            File f = new File(path.trim());
            byte[] b = readBytes(f);
            return (b!=null && b.length>0)? b64(b):"";
        }catch(Exception e){ return ""; }
    }

    // ÙŠÙ†ØµØ­ Ø¨ÙˆØ¶Ø¹ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ PipelineManager
    private static class ImagePreset {
        int steps;
        double guidance;
        ImagePreset(int s, double g){
            this.steps = s;
            this.guidance = g;
        }
    }

    // ÙŠØ­Ø¯Ø¯ steps/guidance Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„
    private ImagePreset imagePresetForModel(String modelId){
        String m = (modelId == null) ? "" : modelId.trim().toLowerCase();

        if (m.indexOf("stable-diffusion-xl-refiner") >= 0 ||
            m.indexOf("sdxl-refiner") >= 0 ||
            m.indexOf("refiner") >= 0) {
            return new ImagePreset(20, 6.0);
        }

        if (m.indexOf("stable-diffusion-xl") >= 0 || m.indexOf("sdxl") >= 0) {
            return new ImagePreset(28, 8.0);
        }

        if (m.indexOf("dreamlike-photoreal") >= 0) {
            return new ImagePreset(30, 7.0);
        }

        if (m.indexOf("openjourney") >= 0) {
            return new ImagePreset(28, 7.5);
        }

        if (m.indexOf("dreamshaper") >= 0) {
            return new ImagePreset(30, 8.0);
        }

        if (m.indexOf("realistic_vision") >= 0 || m.indexOf("realistic-vision") >= 0) {
            return new ImagePreset(30, 7.5);
        }

        if (m.indexOf("anything") >= 0) {
            return new ImagePreset(28, 7.0);
        }
        if (m.indexOf("waifu-diffusion") >= 0 || m.indexOf("waifu") >= 0) {
            return new ImagePreset(25, 6.5);
        }

        if (m.indexOf("portraitplus") >= 0) {
            return new ImagePreset(30, 8.0);
        }

        if (m.indexOf("mo-di") >= 0 || m.indexOf("mo_di") >= 0 || m.indexOf("modi") >= 0) {
            return new ImagePreset(28, 7.0);
        }

        return new ImagePreset(28, 7.5);
    }

    private static class VideoDefaults {
        int fps;
        int frames;
        int steps;
        double guidance;
        boolean includeSvdMicro;
        Float motionIntensity;
        String extraKV;
    }

    private VideoDefaults videoDefaultsForModel(String modelId, MotionParams mp, int perClipMs, int inW, int inH){
        VideoDefaults vd = new VideoDefaults();
        String m = (modelId==null)?"":modelId.toLowerCase();

        vd.fps = mp.fps;
        vd.frames = mp.numFrames;
        vd.steps = 24;
        vd.guidance = 6.0;
        vd.includeSvdMicro = false;
        vd.motionIntensity = null;
        vd.extraKV = null;

        if(m.indexOf("img2vid-xt")>=0 || m.indexOf("img2vid_xt")>=0){
            vd.fps = 6;
            vd.frames = Math.max(12, Math.min(36, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 28;
            vd.guidance = 6.5;
            vd.includeSvdMicro = true;
            return vd;
        }
        if(m.indexOf("stable-video-diffusion")>=0 || m.indexOf("img2vid")>=0){
            vd.fps = Math.max(6, Math.min(12, mp.fps));
            vd.frames = Math.max(16, Math.min(48, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 30;
            vd.guidance = 6.0;
            vd.includeSvdMicro = true;
            return vd;
        }
        if(m.indexOf("wan2.2")>=0 || m.indexOf("wan2.1")>=0 || m.indexOf("wan-ai")>=0 || m.indexOf("wan2")>=0 || m.indexOf("wan")>=0){
            vd.fps = 24;
            vd.frames = Math.max(24, Math.min(120, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 25;
            vd.guidance = 6.0;
            vd.includeSvdMicro = false;
            vd.extraKV = "\"size\":\""+inW+"x"+inH+"\"";
            return vd;
        }
        if(m.indexOf("easyanimate")>=0){
            vd.fps = 8;
            vd.frames = Math.max(8, Math.min(49, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 20;
            vd.guidance = 5.0;
            return vd;
        }
        if(m.indexOf("videocrafter2")>=0){
            vd.fps = 12;
            vd.frames = Math.max(16, Math.min(48, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 25;
            vd.guidance = 6.0;
            return vd;
        }
        if(m.indexOf("dynamicrafter")>=0){
            vd.fps = 10;
            vd.frames = Math.max(16, Math.min(64, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 20;
            vd.guidance = 5.5;
            return vd;
        }
        if(m.indexOf("cinemo")>=0){
            vd.fps = 10;
            vd.frames = Math.max(16, Math.min(40, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 22;
            vd.guidance = 5.5;
            vd.motionIntensity = new Float(0.6f);
            return vd;
        }
        if(m.indexOf("latte-1")>=0 || m.indexOf("latte")>=0){
            vd.fps = 12;
            vd.frames = Math.max(12, Math.min(36, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 25;
            vd.guidance = 6.0;
            return vd;
        }
        if(m.indexOf("seine")>=0){
            vd.fps = 24;
            vd.frames = Math.max(24, Math.min(144, (int)Math.round((perClipMs/1000.0)*vd.fps)));
            vd.steps = 24;
            vd.guidance = 6.0;
            return vd;
        }
        vd.fps = mp.fps;
        vd.frames = mp.numFrames;
        vd.steps = 24;
        vd.guidance = 6.0;
        return vd;
    }

    private boolean isSdxlRefinerModel(String modelId){
        if(modelId==null) return false;
        String m = modelId.toLowerCase();
        return (m.indexOf("stable-diffusion-xl-refiner")>=0 || m.indexOf("sdxl-refiner")>=0 || m.indexOf("refiner")>=0);
    }

    private String ttsGroupForModel(String modelId){
        if(modelId==null) return "";
        String m = modelId.toLowerCase();
        if(indexOfAny(m,new String[]{"xtts","coqui/xtts"})>=0) return "xtts";
        if(indexOfAny(m,new String[]{"vall-e-x","valle"})>=0) return "valle";
        if(indexOfAny(m,new String[]{"yourtts"})>=0) return "yourtts";
        if(indexOfAny(m,new String[]{"bark"})>=0) return "bark";
        if(indexOfAny(m,new String[]{"tortoise-tts","tortoise_tts"})>=0) return "tortoise";
        if(indexOfAny(m,new String[]{"mms-tts"})>=0) return "mms";
        if(indexOfAny(m,new String[]{"vibevoice"})>=0) return "vibevoice";
        if(indexOfAny(m,new String[]{"vits","espnet","kan-bayashi"})>=0) return "vits";
        if(indexOfAny(m,new String[]{"mozilla/tts"})>=0) return "mozilla_tts";
        return "";
    }

    private boolean isHfEndpoint(String endpoint){
        try{
            if(endpoint==null) return false;
            java.net.URL u = new java.net.URL(endpoint);
            String host = (u.getHost()!=null)? u.getHost().toLowerCase() : "";
            return host.indexOf("huggingface.co")>=0;
        }catch(Exception e){ return false; }
    }

    // ====== Img2Vid (Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©) ======
    private byte[] callImg2Vid(String modelId, byte[] imgBytes, String motionPrompt, VideoDefaults vd, MotionParams mp, int inW, int inH, String hfToken){
        String url = hfModelApiUrl(modelId);
        String imgDataUrl = "data:image/png;base64,"+b64(imgBytes);

        String p1 = "{"
            + "\"inputs\":\""+escapeJson(imgDataUrl)+"\","
            + "\"parameters\":{"
            + "\"num_frames\":"+vd.frames+",\"frames\":"+vd.frames+","
            + "\"fps\":"+vd.fps+","
            + "\"width\":"+inW+",\"height\":"+inH+","
            + "\"steps\":"+vd.steps+","
            + "\"guidance_scale\":"+vd.guidance
            + (vd.includeSvdMicro? ",\"motion_bucket_id\":"+mp.motionBucketId+",\"noise_aug_strength\":"+mp.noiseAugStrength : "")
            + (vd.motionIntensity!=null? ",\"motion_intensity\":"+vd.motionIntensity.floatValue():"")
            + (vd.extraKV!=null && vd.extraKV.length()>0? ","+vd.extraKV:"")
            + "},"
            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
            + "}";
        try {
            logReqPayload(url, p1);
            HttpResp r = httpPostJsonResp(url, p1, hfToken, "video/*,application/json", 150000, 300000);
            byte[] vid = ensureVideoBytes(r);
            if(vid!=null && vid.length>0) return vid;
        } catch(Exception e){ if(handleIfQuotaExceeded(e,"img2vid", modelId)) return null; }

        String p2 = "{"
            + "\"inputs\":{"
            + "\"image\":\""+escapeJson(imgDataUrl)+"\","
            + "\"prompt\":\""+escapeJson(motionPrompt)+"\""
            + "},"
            + "\"parameters\":{"
            + "\"num_frames\":"+vd.frames+",\"frames\":"+vd.frames+","
            + "\"fps\":"+vd.fps+","
            + "\"width\":"+inW+",\"height\":"+inH+","
            + "\"steps\":"+vd.steps+","
            + "\"guidance_scale\":"+vd.guidance
            + (vd.includeSvdMicro? ",\"motion_bucket_id\":"+mp.motionBucketId+",\"noise_aug_strength\":"+mp.noiseAugStrength : "")
            + (vd.motionIntensity!=null? ",\"motion_intensity\":"+vd.motionIntensity.floatValue():"")
            + (vd.extraKV!=null && vd.extraKV.length()>0? ","+vd.extraKV:"")
            + "},"
            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
            + "}";
        try {
            logReqPayload(url, p2);
            HttpResp r = httpPostJsonResp(url, p2, hfToken, "video/*,application/json", 150000, 300000);
            byte[] vid = ensureVideoBytes(r);
            if(vid!=null && vid.length>0) return vid;
        } catch(Exception e){ if(handleIfQuotaExceeded(e,"img2vid", modelId)) return null; }

        String p3 = "{"
            + "\"image\":\""+escapeJson(imgDataUrl)+"\","
            + "\"parameters\":{"
            + "\"num_frames\":"+vd.frames+",\"frames\":"+vd.frames+","
            + "\"fps\":"+vd.fps+","
            + "\"width\":"+inW+",\"height\":"+inH+","
            + "\"steps\":"+vd.steps+","
            + "\"guidance_scale\":"+vd.guidance
            + (vd.includeSvdMicro? ",\"motion_bucket_id\":"+mp.motionBucketId+",\"noise_aug_strength\":"+mp.noiseAugStrength : "")
            + (vd.motionIntensity!=null? ",\"motion_intensity\":"+vd.motionIntensity.floatValue():"")
            + (vd.extraKV!=null && vd.extraKV.length()>0? ","+vd.extraKV:"")
            + "},"
            + "\"options\":{\"wait_for_model\":true,\"use_cache\":false}"
            + "}";
        try {
            logReqPayload(url, p3);
            HttpResp r = httpPostJsonResp(url, p3, hfToken, "video/*,application/json", 150000, 300000);
            byte[] vid = ensureVideoBytes(r);
            if(vid!=null && vid.length>0) return vid;
        } catch(Exception e){ if(handleIfQuotaExceeded(e,"img2vid", modelId)) return null; }

        try{
            HttpResp r2 = httpPostBytesResp(url, imgBytes, hfToken, "application/octet-stream", "video/*,application/json", 150000, 300000);
            byte[] vid = ensureVideoBytes(r2);
            if(vid!=null && vid.length>0) return vid;
        }catch(Exception e){ if(handleIfQuotaExceeded(e,"img2vid", modelId)) return null; }

        try{
            byte[] vid = callImg2VidMultipart(modelId, imgBytes, motionPrompt, vd, mp, inW, inH, hfToken);
            if(vid != null && vid.length > 0) return vid;
        }catch(Exception exM){
            if(handleIfQuotaExceeded(exM,"img2vid", modelId)) return null;
            writeToFile("img2vid multipart failed: "+exM.getMessage());
        }

        return null;
    }
}



ÙˆØ§Ù„ÙŠÙƒ Ù…Ø«Ø§Ù„ Ù„Ø´ÙƒÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ø³Ø§Ø³ÙŠØ© ÙˆÙ„ÙŠØ³ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© 

activity_main.xml - 
<?xml version="1.0" encoding="utf-8"?>
<android.support.v4.widget.DrawerLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/drawer_layout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/app_bg">

    <RelativeLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <!-- top bar -->
        <LinearLayout
            android:id="@+id/top_bar"
            android:layout_width="match_parent"
            android:layout_height="@dimen/header_height"
            android:orientation="horizontal"
            android:background="@color/app_bg"
            android:gravity="center_vertical"
            android:paddingLeft="20dp"
            android:paddingRight="20dp"
            android:layout_margin="0dp">

            <ImageView
                android:id="@+id/iv_logo"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:src="@drawable/ic_logo"
                android:contentDescription="logo"
                android:adjustViewBounds="true"
                android:maxHeight="@dimen/icon_size"
                android:maxWidth="@dimen/icon_size" />

            <View
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1" />

            <TextView
                android:id="@+id/tv_title"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
                android:textColor="@color/highlight_color"
                android:textSize="15sp"
                android:gravity="center"
                android:background="@drawable/header_capsule"
                android:paddingLeft="12dp"
                android:paddingRight="12dp" />

            <View
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1" />

            <ImageButton
                android:id="@+id/btn_hamburger"
                android:layout_width="@dimen/icon_size"
                android:layout_height="@dimen/icon_size"
                android:background="@android:color/transparent"
                android:src="@drawable/ic_menu"
                android:contentDescription="menu"
                android:adjustViewBounds="true"
                android:scaleType="centerInside" />
        </LinearLayout>

        <!-- connection status (visible Ø¯Ø§Ø¦Ù…Ø§Ù‹) -->
        <TextView
            android:id="@+id/tv_conn_status"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_below="@id/top_bar"
            android:padding="6dp"
            android:textColor="#ffffff"
            android:textSize="14sp"
            android:gravity="center"
            android:visibility="visible" />

        <!-- fragment container -->
        <FrameLayout
            android:id="@+id/fragment_container"
            android:layout_below="@id/tv_conn_status"
            android:layout_above="@+id/bottom_nav_container"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

        <!-- bottom nav container -->
        <FrameLayout
            android:id="@+id/bottom_nav_container"
            android:layout_alignParentBottom="true"
            android:layout_width="match_parent"
            android:layout_height="60dp"
            android:padding="0dp">

            <ImageView
                android:id="@+id/footer_bottom_bg"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:src="@drawable/footer_bottom_bg"
                android:scaleType="fitXY"
                android:adjustViewBounds="true"
                android:alpha="1.0" />

            <ImageView
                android:id="@+id/footer_watermark"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:src="@drawable/footer_bottom_bg"
                android:scaleType="centerCrop"
                android:adjustViewBounds="true"
                android:alpha="0.12" />

            <!-- bottom navigation bar -->
            <LinearLayout
                android:id="@+id/bottom_nav"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:orientation="horizontal"
                android:gravity="center"
                android:paddingLeft="15.5dp"
                android:paddingRight="15.5dp"
                android:paddingBottom="3dp">

                <!-- LEFT: test/location button -->
                <LinearLayout
                    android:layout_width="0dp"
                    android:layout_weight="1"
                    android:layout_height="match_parent"
                    android:gravity="center">
                    <ImageButton
                        android:id="@+id/nav_test"
                        android:layout_width="@dimen/icon_size"
                        android:layout_height="@dimen/icon_size"
                        android:background="@drawable/bottom_nav_circle"
                        android:src="@drawable/nav_location_selector"
                        android:contentDescription="test"
                        android:scaleType="centerInside"
                        android:adjustViewBounds="true"
                        android:clickable="true"
                        android:focusable="true" />
                </LinearLayout>

                <!-- CENTER: home button (Ø£ÙƒØ¨Ø± ÙˆÙ…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ÙˆØ³Ø·) -->                                 
                <LinearLayout
                    android:layout_width="0dp"
                    android:layout_weight="1"
                    android:layout_height="match_parent"
                    android:gravity="center"
                    android:layout_marginStart="22dp"
                    android:layout_marginEnd="22dp">
                    <ImageButton
                        android:id="@+id/nav_home"
                        android:layout_width="@dimen/icon_size"
                        android:layout_height="@dimen/icon_size"
                        android:background="@drawable/bottom_nav_circle"
                        android:src="@drawable/nav_home_selector"
                        android:contentDescription="home"
                        android:scaleType="centerInside"
                        android:adjustViewBounds="true"
                        android:clickable="true"
                        android:focusable="true" />
                </LinearLayout>
                    
                <!-- RIGHT: ffmpeg button -->
                <LinearLayout
                    android:layout_width="0dp"
                    android:layout_weight="1"
                    android:layout_height="match_parent"
                    android:gravity="center">
                    <ImageButton
                        android:id="@+id/nav_ffmpeg"
                        android:layout_width="@dimen/icon_size"
                        android:layout_height="@dimen/icon_size"
                        android:background="@drawable/bottom_nav_circle"
                        android:src="@drawable/nav_ffmpeg_selector"
                        android:contentDescription="ffmpeg"
                        android:scaleType="centerInside"
                        android:adjustViewBounds="true"
                        android:clickable="true"
                        android:focusable="true" />
                </LinearLayout>

            </LinearLayout>

        </FrameLayout>
    </RelativeLayout>

    <!-- drawer (right) -->
    <LinearLayout
        android:id="@+id/drawer_view"
        android:layout_width="280dp"
        android:layout_height="match_parent"
        android:layout_gravity="right"
        android:orientation="vertical"
        android:background="@color/app_bg"
        android:padding="12dp">

        <ImageButton
            android:id="@+id/drawer_logo"
            android:layout_width="120dp"
            android:layout_height="120dp"
            android:src="@drawable/ic_logo"
            android:layout_gravity="center"
            android:scaleType="centerInside"
            android:background="@android:color/transparent" />

        <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="AIAUTOCREATE"
            android:textColor="@color/highlight_color"
            android:textSize="15sp"
            android:gravity="center"
            android:layout_marginTop="12dp" />

        <Button
            android:id="@+id/drawer_settings_btn"
            android:layout_width="match_parent"
            android:layout_height="40dp"
            android:text="settings"
            android:background="@drawable/outline_border"
            android:textColor="@color/highlight_color"
            android:layout_marginTop="25dp" />

        <View android:layout_width="match_parent" android:layout_height="0dp" android:layout_weight="1" />

        <TextView
            android:id="@+id/drawer_version"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="1.0"
            android:textColor="@color/highlight_color"
            android:layout_gravity="center" />
    </LinearLayout>
</android.support.v4.widget.DrawerLayout>


ÙƒÙ…Ø§ ØªØ±Ù‰  Ù…ÙˆØ¶Ø­ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ§Ø¯ Ø´ÙƒÙ„ Ø§Ù„Ù‡ÙŠØ¯ÙŠØ± Ùˆ Ø§Ù„ÙÙˆØªØ± Ùˆ ÙƒØ²Ø§Ù„Ùƒ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„Ù„ØªÙŠ Ø³ÙŠØªÙ… Ùˆ Ø¶Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª ÙÙŠÙ‡ Ù…Ø§ Ø¹Ø§Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø§Ø«Ù„Ø§Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ùˆ ØµÙØ­Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ© Ùˆ ØµÙØ­Ø© Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ 
Ù‡Ø°Ø§ Ù…Ø«Ù„Ø§ Ù„Ø°Ø§Ù„Ùƒ Ù„ÙŠØ³ Ù…Ø«Ø§Ù„ÙŠ Ù„Ø°Ø§Ù„Ùƒ Ù‚Ù… Ø¨Ø§Ù†Ø´Ø§Ø¦Ù‡ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ  Ùˆ Ù„ÙƒÙŠÙ† Ù„Ø§ ØªØªÙ„Ù Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± 

---

20+ - 
5. Ù…ÙˆØ§ØµÙØ§Øª ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø±Ù…Ø¬ÙŠÙ‘Ø© (APIs Ø¯Ø§Ø®Ù„ÙŠØ©/Ù†Ù…Ø§Ø°Ø¬) â€” ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨/Ø§Ù„Ø±Ø¯ (JSON examples)



A. Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Model descriptor)

{ "id": "meta-llama/Llama-3.2-1B-Instruct", "type": "text", "endpoint": "https://api-inference.huggingface.co/models/meta-llama/Llama-3.2-1B-Instruct", "requires_api_key": false, "description": "Default instruct text model" }

B. Ù…Ù„Ù Ù…Ø´Ø±ÙˆØ¹ (project file)

{ "project_id": "proj_20251009_001", "title": "My Reimagined Video", "source_files": { "video": "/storage/emulated/0/AIAutoCreate/projects/proj_20251009_001/input.mp4", "image": null, "audio": null }, "workflowType": "video_reimagine", "settings": { "text_model": "meta-llama/Llama-3.2-1B-Instruct", "use_gemini_if_available": true, "ffmpeg_preset": "default" }, "created_at": "2025-10-09T12:00:00Z" }

C. Agent result (Ù…Ø«Ø§Ù„ Ù„Ù†ØªÙŠØ¬Ø© Orchestrator)

{ "agent": "OrchestratorAgent", "project_id": "proj_20251009_001", "steps": [ {"step_id":"analyze_video", "status":"success", "output_path":"/storage/emulated/0/AIAutoCreate/agent_results/proj_.../analysis.json"}, {"step_id":"generate_script", "status":"success", "model":"meta-llama/Llama-3.2-1B-Instruct", "output_path":"/.../script.txt"} ], "timestamp":"2025-10-09T12:05:00Z" }


---

6. JSON Schema (Ù‚Ø§Ù„Ø¨ Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹)



(Ù…Ù„Ù models_default.json Ùˆproject ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¨Ø¹Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)

{ "$schema": "http://json-schema.org/draft-07/schema#", "title": "AI AutoCreate Project", "type": "object", "required": ["project_id","title","workflowType","settings","created_at"], "properties": { "project_id": {"type":"string"}, "title": {"type":"string"}, "source_files": { "type":"object", "properties": { "video": {"type":["string","null"]}, "image": {"type":["string","null"]}, "audio": {"type":["string","null"]} } }, "workflowType": {"type":"string"}, "settings": { "type":"object", "properties": { "text_model": {"type":"string"}, "use_gemini_if_available": {"type":"boolean"}, "ffmpeg_preset": {"type":"string"} }, "required":["text_model"] }, "created_at": {"type":"string","format":"date-time"} } }


---

7. Ø­Ø§Ù„Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± / Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù‚Ø¨ÙˆÙ„ (Acceptance tests)



1. Build test AIDE: Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙŠÙØ¨Ù†Ù‰ ÙÙŠ AIDE Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ ØªØ±Ø¬Ù…Ø© (Java7).


2. HomeFragment Full Automatic: Ù…Ø¹ ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØºÙŠØ§Ø¨ Ù…ÙØªØ§Ø­ GeminiØŒ ÙŠØ¨Ø¯Ø£ pipeline ÙˆÙŠÙÙ†ØªØ¬ Ù…Ù„ÙØ§Øª ÙÙŠ /storage/emulated/0/AIAutoCreate/projects/... Ùˆ /storage/emulated/0/AIAutoCreate/agent_results/....


3. ModelsManager Add/Test: Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ Ø¹Ø¨Ø± endpoint + Ù…ÙØªØ§Ø­ â†’ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ â†’ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.


4. FFmpeg test: FFmpegKit (Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†) ÙŠÙ†ÙÙ‘Ø° Ø£Ù…Ø± ØªØ±Ù…ÙŠØ² ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¹Ù„Ù‰ Ù…Ù„Ù ØµØºÙŠØ± ÙˆÙŠÙØ¹ÙŠØ¯ exit code 0 Ø£Ùˆ Ø­Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù…Ù…Ø§Ø«Ù„Ø© Ø¹Ø¨Ø± API.


5. Resource cleanup: Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ TestFragment Ø£Ùˆ ØªØ¹Ø·ÙŠÙ„ Ù…Ø±Ø­Ù„Ø© ÙÙŠØ¯ÙŠÙˆØŒ VideoView.stopPlayback() ÙˆMediaPlayer.release() ÙˆBitmap.recycle() ØªÙØ³ØªØ¯Ø¹Ù‰.


6. SanityCheckAgent: Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ ÙŠÙˆÙ„Ù‘Ø¯ /storage/emulated/0/AIAutoCreate/agent_results/sanity_check.json ÙˆÙŠÙƒØ´Ù Ù…Ø´Ø§ÙƒÙ„ Ù…Ø«Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¥Ø°Ù† Ø£Ùˆ Ù…Ø³Ø§Ø­Ø© ØªØ®Ø²ÙŠÙ† ØºÙŠØ± ÙƒØ§ÙÙŠØ©.


7. Agent Test Run: Ù„ÙƒÙ„ Agent Ø²Ø± "Test Run" ÙŠÙÙ†ÙÙ‘Ø° Ø·Ù„Ø¨Ù‹Ø§ ØªØ¬Ø±ÙŠØ¨ÙŠÙ‹Ø§ ÙˆÙŠÙ„ÙÙ‘Ù€Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©.


8. No RecyclerView: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ØªØ¹Ù…Ù„ Ø¹Ø¨Ø± LinearLayout Ø¯Ø§Ø®Ù„ ScrollView (Ù…Ø­Ù‚Ù‚ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹).




---

8. Ù…Ø¯Ø®Ù„Ø§Øª/Ù…Ø®Ø±Ø¬Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„ÙƒÙ„ ØµÙØ­Ø© (I/O examples)



HomeFragment Input: { "prompt":"Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© Ø¹Ù† Ø±Ø­Ù„Ø© ØµØ­Ø±Ø§ÙˆÙŠØ©", "selected_model":"meta-llama/Llama-3.2-1B-Instruct", "use_gemini":false } Output: Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ script.txt, images/, audio/, final_video.mp4 (Ù…Ø­ÙÙˆØ¸Ø© ØªØ­Øª /storage/emulated/0/AIAutoCreate/projects/...).

Video Reimaginer Input: { "video_path":"/storage/emulated/0/DCIM/input.mp4", "options": {"recreate_images":true,"add_music":true}} Output: /storage/emulated/0/AIAutoCreate/projects/proj_x/frames/, /storage/emulated/0/AIAutoCreate/projects/proj_x/script.txt, /storage/emulated/0/AIAutoCreate/projects/proj_x/final_video.mp4

ModelsManager Add Input: { "id":"custom-model","endpoint":"https://...","key":"sk-xxx","type":"text" } Output: success / error JSON + UI update.


---

9. Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ© ÙˆImplementation notes (Ù†Ù‚Ø§Ø· ØªÙ‚Ù†ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ù…Ø·ÙˆØ±)



Ø§Ø³ØªØ®Ø¯Ø§Ù… HttpURLConnection Ø£Ùˆ Ù…ÙƒØªØ¨Ø© HTTP Ø¨Ø³ÙŠØ·Ø© Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ AIDE (Ù„Ø§ Retrofit Ø¥Ø°Ø§ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…).

ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø¯ÙˆØ¯ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø´Ø¨ÙƒØ©: Ø§Ø¬Ø¹Ù„ ÙƒÙ„ Ù†Ø¯Ø§Ø¡ HTTP Ø¨Ù…Ù‡Ù„Ø© timeout Ùˆ retry Ø¨Ø³ÙŠØ· (3 Ù…Ø±Ø§Øª).

ØªØ®Ø²ÙŠÙ† Ù…ÙØ§ØªÙŠØ­: PrefsObfuscator (Ù…Ø«Ø§Ù„: XOR Ù…Ø¹ Ù…ÙØªØ§Ø­ Ø«Ø§Ø¨Øª Ø¯Ø§Ø®Ù„ ÙƒÙˆØ¯ â€” Ù…Ù„Ø­ÙˆØ¸Ø©: Ø£Ù…Ù† Ù…Ø­Ø¯ÙˆØ¯ Ù„ÙƒÙ† Ù…ÙˆØ§ÙÙ‚ ÙˆÙÙ‚ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª).

Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆ: Ø§Ø³ØªØ®Ø¯Ù… FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ø¨Ø± ØºÙ„Ø§Ù FFmpegRunnerØ› Ø§Ø­ØªÙØ¸ Ø¨Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª preset ÙÙŠ JSON.

Threading: Orchestrator ÙŠÙÙ†ÙÙ‘Ø° Ø®Ø·ÙˆØ§Øª Ù…ØªØªØ§Ø¨Ø¹Ø© ÙÙŠ AsyncTask Ø£Ùˆ Service Ù…Ø¹ Handler Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.

Logs: ÙƒÙ„ Agent ÙŠÙÙ†ØªØ¬ Ù…Ù„Ù JSON ÙÙŠ agent_results/ Ù…Ø¹ Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ.

UI: Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø§Øª ØªØµÙ…ÙŠÙ… Ù…ØªÙ‚Ø¯Ù…Ø© â€” ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø³ÙŠØ·Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø©ØŒ Ø¯Ø¹Ù… RTL.


---

10. Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (default mapping â€” Ù„Ø§ ØªØºÙŠÙ‘Ø±Ù‡Ù…Ø§ Ø¥Ù„Ø§ Ø¹Ø¨Ø± ModelsManager)



Text: meta-llama/Llama-3.2-1B-Instruct, google/gemma-2b-it, mistralai/Mistral-7B-v0.1 ASR: openai/whisper-tiny Image: stabilityai/stable-diffusion-xl-base-1.0 Audio SFX: facebook/audiogen-medium Music: suno/bark Video transitions: ali-vilab/text-to-video-ms-1.7b Embedding/analysis: google/embedding-gemma-300m Unified controller: microsoft/Phi-3-mini-4k-instruct


---

11. Assumptions (Ù…ÙˆØ³ÙˆÙ…Ø© â€” Ù„Ù… Ø£ØºÙŠÙ‘Ø± Ø´ÙŠØ¡ Ù…Ù† Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ› Ù‡Ø°Ù‡ Ù†Ù‚Ø§Ø· Ø§ÙØªØ±Ø§Ø¶ Ù„ØªØ¨ÙŠØ§Ù† Ø£ÙŠ ØºÙ…ÙˆØ¶)



1. Ù†Ù…Ø§Ø°Ø¬ Hugging Face Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ø¹Ø¨Ø± API inference endpoints.


2. Gemini ÙŠØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù…ÙØªØ§Ø­ ØµØ§Ù„Ø­ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â€” Ø¨Ø®Ù„Ø§Ù Ø°Ù„Ùƒ fallback Ù„Ù†Ù…ÙˆØ°Ø¬ Ù†ØµÙŠ.


3. AIDE ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© FFmpegKit Ù…Ø¶Ù…Ù‘Ù†Ø© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³ÙŠØ¶ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø©) Ø£Ùˆ binary Ù…Ø­Ù„ÙŠ Ø¥Ù† Ø±ØºÙØ¨ØŒ Ù„ÙƒÙ† Ø§Ù„Ù…Ù†Ù‡Ø¬ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù‡ÙŠ FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†Ø©.


4. ØªØ·Ø¨ÙŠÙ‚ Ù…ÙÙˆÙ‚Ù‘Ø¹ ÙˆÙ…ØµØ±Ù‘ÙØ­ Ù„Ù‡ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ø£Ùˆ ÙŠØ·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù…Ù†Ø­ MANAGE_EXTERNAL_STORAGE Ø¥Ù† Ù„Ø²Ù….


5. Ø§Ù„Ø£Ø¯Ø§Ø¡: Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù‚Ø¯ ÙŠÙØ´Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… (Ø­Ø¬Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ Ø²Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©) â€” Orchestrator ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙØ´Ù„ ÙˆÙŠØ¨Ø¯Ù‘Ù„ Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ Ø£Ùˆ ÙŠÙ‚Ù„Ù‘Ù„ Ø§Ù„Ø¬ÙˆØ¯Ø©.




---

12. Ù…Ø®Ø±Ø¬Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù‚ØªØ±Ø­Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ±Ù‹Ø§)



Ù…Ù„Ù models_default.json ÙŠØ­ÙˆÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª endpoints.

Ø´Ø¬Ø±Ø© Ø£Ù…Ø«Ù„Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ /storage/emulated/0/AIAutoCreate/projects/sample_project.json.

Ø³ÙƒØ±Ø¨Øª Ø§Ø®ØªØ¨Ø§Ø± AIDE (README) ÙŠØ´Ø±Ø­ Ø®Ø·ÙˆØ§Øª Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ø®ØªØ¨Ø§Ø± FFmpegKit ÙˆTest Run Ù„ÙƒÙ„ Agent.

14. ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Settings) â€” ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†ÙÙŠØ°



Ø§Ù„Ù‡Ø¯Ù: ØµÙØ­Ø© Ù…Ø±ÙƒØ²ÙŠÙ‘Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„ØªÙŠ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø³Ù„ÙˆÙƒ ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ„Ù‡Ø§: Ù„ØºØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø«ÙŠÙ… (Ø¯Ø§ÙƒÙ†/ÙØ§ØªØ­)ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø£ØµÙˆØ§Øª Ø§Ù„Ù€TTS (Ø§Ø®ØªÙŠØ§Ø±/Ø§Ø³ØªÙ†Ø³Ø§Ø®/Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹ÙŠÙ†Ø§Øª ØµÙˆØªÙŠØ©).

Ø£. Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (UI controls)

1. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© (Language Selector)



Ø®ÙŠØ§Ø±Ø§Ù† ÙÙ‚Ø·: Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© / English (Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø£Ùˆ RadioButtons).

Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±: ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ SharedPreferences ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ ÙÙˆØ±Ù‹Ø§ Ø¹Ø¨Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©/Ø§Ù„ÙØ±Ø§Ø¬Ù…Ù†ØªØ§Øª (Ù…Ø«Ø§Ù„: Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù†ØµÙˆØµ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ MainActivity).

ÙŠØ¬Ø¨ Ø¯Ø¹Ù… RTL Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (layoutDirection="rtl").

2. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… (Theme Toggle)



Ø®ÙŠØ§Ø±Ø§Øª: ÙØ§ØªØ­ / Ø¯Ø§ÙƒÙ† (Toggle Switch).

ØªØºÙŠÙ‘Ø± Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø®Ù„ÙÙŠØ©ØŒ Ù†ØµÙˆØµØŒ ÙƒØ±ÙˆØª) ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.

Ø­ÙØ¸ ÙÙŠ SharedPreferences (key: pref_theme) ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± Activity.recreate() Ø£Ùˆ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯.

3. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„ØµÙˆØªÙŠØ© (TTS Voice Preset Selector)



Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø¹ÙÙŠÙ‘Ù†Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© (list of presets). ÙƒÙ„ Ø³Ø·Ø±: Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©ØŒ Ù†Ù…ÙˆØ°Ø¬/Ù…Ø²ÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ suno/bark Ø£Ùˆ Ù†Ù…ÙˆØ°Ø¬ Ù…Ø®ØµØµ)ØŒ Ø²Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© (Play)ØŒ Ø²Ø± Use / Select.

Ø²Ø± "Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ø¹ÙŠÙ†Ø©" (Clone Sample): ÙŠØªÙŠØ­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØªÙŠ Ø¹ÙŠÙ†Ø© (Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯) Ø«Ù… Ø¥Ø·Ù„Ø§Ù‚ Ø¹Ù…Ù„ÙŠØ© "Ø¨Ù†Ø§Ø¡ ØµÙˆØª" Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ… ÙŠØ³Ù…Ø­ Ø¨Ø°Ù„Ùƒ. (ØªÙˆØ¶Ø­ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ø¯Ù†Ø§Ù‡ ÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ°Ù‡ Ø¹Ù…Ù„ÙŠÙ‹Ø§).

Ø­Ù‚Ù„ ÙˆØµÙ / Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ Ù„ÙƒÙ„ Ø¹ÙŠÙ†Ø©: Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø¯Ø©ØŒ Ø§Ù„Ù†Ø¨Ø±Ø©ØŒ Ø§Ù„Ù„ØºØ©ØŒ Ø³Ø±Ø¹Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.

4. Ø²Ø± "Manage Voices"



ÙŠÙØªØ­ ØµÙØ­Ø© ÙØ±Ø¹ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©ØŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ù…Ø²ÙˆØ¯ Ø§Ù„ØµÙˆØªØŒ ÙˆØ¥Ø¬Ø±Ø§Ø¡ Test Run Ù„Ù„Ø¹ÙŠÙ†Ø©.

Ø¨. Ø³Ù„ÙˆÙƒÙŠØ§Øª ÙˆØ§Ø¹ØªØ¨Ø§Ø±Ø§Øª ÙÙ†ÙŠØ© (Implementation notes)

Ù†Ù…Ø§Ø°Ø¬ TTS Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©: suno/barkØŒ Ø£ÙŠ Ù†Ù…ÙˆØ°Ø¬ TTS Ù…Ø¬Ø§Ù†ÙŠ Ø¢Ø®Ø± Ù…Ø°ÙƒÙˆØ± ÙÙŠ models_default.json. (Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠÙØ«Ø¨Øª Ù†Ù…Ø§Ø°Ø¬ Ù…Ø­Ù„ÙŠØ§Ù‹ â€” ÙŠØ³ØªØ¯Ø¹ÙŠ endpoint).

Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹ÙŠÙ†Ø©: Ø§Ø³ØªØ®Ø¯Ø§Ù… MediaPlayerØ› Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© ÙŠØ¬Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ MediaPlayer.release().

Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„ØµÙˆØª (Voice Cloning):

Ø¥Ù† ÙˆÙØ¬Ø¯ Ù†Ù…ÙˆØ°Ø¬ Ø®Ø§Ø±Ø¬ÙŠ Ù…Ø¬Ø§Ù†ÙŠ ÙŠØ¯Ø¹Ù… voice cloning Ø¹Ø¨Ø± HF endpoint Ø£Ùˆ Ù…Ø²ÙˆØ¯ Ø¢Ø®Ø±ØŒ ÙŠÙˆÙÙÙ‘ÙØ± Ø²Ø± Ù„Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù Ø§Ù„Ø¹ÙŠÙ†Ø© Ø¥Ù„Ù‰ endpoint (Upload + parameters).

Ø¥Ù† Ù„Ù… ÙŠØªÙˆÙØ± Ù†Ù…ÙˆØ°Ø¬ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ù…Ø¬Ø§Ù†ÙŠØŒ ØªØ¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©: "Ø§Ù„Ù…ÙŠØ²Ø© ØºÙŠØ± Ù…ØªØ§Ø­Ø© â€” Ø§Ø³ØªØ®Ø¯Ù… Ø¹ÙŠÙ†Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©".

Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø³ØªÙ†Ø³Ø§Ø® ØªÙØ®Ø²Ù† ÙƒÙ…ÙˆØ¯ÙŠÙ„/Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¯Ø§Ø®Ù„ models_default.json ÙˆSharedPreferences Ù…Ø¹ Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ (id, name, endpoint).

Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù…Ø§Ù†: ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ø³ØªÙ†Ø³Ø§Ø® ØµÙˆØª ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ ÙŠØ°ÙƒØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø© ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©.

Ø§Ù„ØªØ®Ø²ÙŠÙ†:

Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ SharedPreferences (keys: pref_language, pref_theme, pref_tts_voice_id).

Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙØ¶Ø§ÙØ© ØªÙØ®Ø²Ù† ÙƒØ°Ù„Ùƒ ÙÙŠ Ù…Ù„Ù JSON Ù…Ø­Ù„ÙŠ /storage/emulated/0/AIAutoCreate/config/user_voices.json Ù…Ø¹ Ù…Ø±Ø§Ø¬Ø¹ Ø¥Ù„Ù‰ endpoints Ø¥Ù† ÙˆÙØ¬Ø¯Øª.

Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Java 7 / AIDE:

Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©.

Ù„Ù„ØªØ­Ù…ÙŠÙ„/Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ø³ØªØ®Ø¯Ù… HttpURLConnection Ù…Ø¹ multipart/form-data Ø¥Ù† Ù„Ø²Ù….

ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø©: ScrollView + LinearLayout. ÙƒÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† ØµÙ Ø£ÙÙ‚ÙŠ (TextView + Control).

Ø¬. Ø£Ù…Ø«Ù„Ø© JSON Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Settings

{ "pref_language": "ar",            // "ar" or "en" "pref_theme": "dark",            // "dark" or "light" "pref_tts_voice_id": "suno_bark_female_01" }

Ø¯. Ø­Ø§Ù„Ø§Øª Ù‚Ø¨ÙˆÙ„ (Acceptance tests)

1. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙŠØºÙŠÙ‘Ø± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆÙŠØ¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ.


2. ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… ÙŠØ·Ø¨Ù‘Ù‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙÙˆØ±Ù‹Ø§ ÙˆÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ù‹Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.


3. Ø§Ø®ØªÙŠØ§Ø± Ø¹ÙŠÙ†Ø© TTS Ø¬Ø¯ÙŠØ¯Ø© ØªÙØ®Ø²Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØªÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø£ÙŠ ØªØ­ÙˆÙŠÙ„ Ù†Øµ â†’ ØµÙˆØª Ù„Ø§Ø­Ù‚.


4. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹ÙŠÙ†Ø© ÙŠÙØ´ØºÙ‘Ù„ ÙˆÙŠÙØ¶Ù‘ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (MediaPlayer.release()).



15. ØµÙØ­Ø© Ø¶Ø¨Ø· Ø§Ù„ØªØ±Ø¬Ù…Ø© â€” (Ù…ÙØ­Ø¯Ù‘ÙØ«Ø© ÙˆØ´Ø§Ù…Ù„Ø© â€” ØªØ¶Ù… ÙƒÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© + Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ FFmpegKit/ASS)




---

Ø§Ù„Ù‡Ø¯Ù

ØµÙØ­Ø© Ù…ØªØ®ØµØµØ© Ù„ØªØ®ØµÙŠØµ Ù…Ø¸Ù‡Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø©/Subtitles Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (ØªÙØ·Ø¨Ù‘ÙÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØ¹Ù†Ø¯ Ø­Ø±Ù‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… FFmpegKit). ØªØ­ØªÙˆÙŠ Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø¹ÙŠÙ‘Ù†Ø© Ø­ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªØªØ­Ø¯Ù‘Ø« Ø£Ùˆ ØªØªØºÙŠÙ‘Ø± ÙÙˆØ±Ù‹Ø§ Ù…Ø¹ ÙƒÙ„ ØªØ¹Ø¯ÙŠÙ„ Ù„ÙŠÙØ´Ø§Ù‡ÙØ¯ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¯Ù‚Ø©.


---

Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (UI controls)

1. Ø¹ÙŠÙ†Ø© Ø­ÙŠØ© (Live Preview Area)



Ù…Ù†Ø·Ù‚Ø© ÙƒØ¨ÙŠØ±Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© (TextView Ø¯Ø§Ø®Ù„ FrameLayout) ØªÙØ¸Ù‡ÙØ± Ù†ØµÙ‘Ù‹Ø§ ØªØ¬Ø±ÙŠØ¨ÙŠÙ‹Ø§ (Ù…Ø«Ù„Ø§Ù‹: "Ù‡Ø°Ø§ Ù†Øµ Ø¹ÙŠÙ‘Ù†Ø© Ù„Ù„ØªØ±Ø¬Ù…Ø© â€” Subtitle sample") ÙˆØªÙØ­Ø¯Ù‘ÙØ« ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„.

ØªØ¯Ø¹Ù… Ø¹Ø±Ø¶ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±ØŒ Ù…Ø­Ø§Ø°Ø§Ø© RTL/RTL-awareØŒ ÙˆØªØ³Ù…Ø­ Ø¨Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…ÙˆØ¶Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø© (top/bottom/offset).

2. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø· (Font Selector)



Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…ØªØ§Ø­Ø©: system fonts + Ø®Ø·ÙˆØ· Ù…Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….

Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø®Ø·" ÙŠÙØªØ­ file picker Ù„Ø§Ø®ØªÙŠØ§Ø± .ttf Ø£Ùˆ .otf Ø«Ù… ÙŠÙ†Ø³Ø® Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ /storage/emulated/0/AIAutoCreate/fonts/ ÙˆÙŠØ­Ù…Ù‘Ù„Ù‡ Ø¹Ø¨Ø± Typeface.createFromFile(...).

Ø²Ø± Ù„Ø­Ø°Ù Ø®Ø· Ù…Ø¶Ø§Ù.

Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø¬Ø§Ù†Ø¨ ÙƒÙ„ Ø¹Ù†ØµØ±.

3. Ø­Ø¬Ù… Ø§Ù„Ø®Ø· (Font Size)



SeekBar Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…ÙŠ (SP) Ù…Ø¹ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¹ÙŠÙ‘Ù†Ø©.

4. Ù„ÙˆÙ† Ø§Ù„Ø®Ø· (Font Color)



Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø¨Ø³ÙŠØ·Ø© (Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ù„ÙˆØ§Ù† Ø´Ø§Ø¦Ø¹Ø©) + Ø­Ù‚Ù„ Ù„Ø±Ù…Ø² HEX (ARGB).

ØªÙØ­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙƒÙ€ ARGB (Ù…Ø«Ø§Ù„: #EEFFFFFF).

5. Ø§Ù„Ø´ÙØ§ÙÙŠØ© (Opacity / Alpha)



SeekBar ÙŠØªØ­ÙƒÙ‘Ù… Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† 0â€“100% ÙˆÙŠÙØ·Ø¨Ù‘ÙÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ.

6. Ø¸Ù„ Ø§Ù„Ù†Øµ (Text Shadow)



ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Shadow.

Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: radius (SeekBar)ØŒ dxØŒ dy (Ù‚ÙŠÙ…Ø© Ø¹Ø¯Ø¯ÙŠØ© Ø£Ùˆ SeekBars)ØŒ shadow color (palette).

ØªÙØ·Ø¨Ù‘ÙÙ‚ Ø¨ÙˆØ§Ø³Ø·Ø© TextView.setShadowLayer(radius, dx, dy, color) ÙÙˆØ±Ø§Ù‹.

7. Ø§Ù„Ø­Ø¯Ù‘/Ø§Ù„Ø¥Ø·Ø§Ø± (Outline / Border)



Ø¥Ø¹Ø¯Ø§Ø¯ outline width (border/outline) Ùˆoutline color (ARGB).

ÙŠÙØ·Ø¨Ù‘ÙÙ‚ Ø¹Ø¨Ø± draw stroke (Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø±Ù‚ Ø¨Ø§Ø³ØªØ®Ø¯Ù… ASS Ø£Ùˆ drawtext borderw) â€” ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙŠÙØ­Ø§ÙƒÙ‰ Ø¹Ø¨Ø± Ø®Ù„ÙÙŠØ© Ø£Ùˆ ØªØ£Ø«ÙŠØ± Ù…Ø²Ø¯ÙˆØ¬.

8. ØµÙ†Ø¯ÙˆÙ‚ Ø®Ù„ÙÙŠ (Background box)



ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù ØµÙ†Ø¯ÙˆÙ‚ Ø®Ù„ÙÙŠØ© "box" Ø®Ù„Ù Ø§Ù„Ù†Øµ Ù…Ø¹ box color Ùˆpadding Ùˆcorner radius (Ø§Ø®ØªÙŠØ§Ø±ÙŠ).

ÙÙŠ ASS ÙŠÙØªØ±Ø¬Ù… Ø¥Ù„Ù‰ BackColourØŒ Ø£Ùˆ ÙÙŠ drawtext ÙƒÙ€ box=1:boxcolor=...:boxborderw=....

9. Ø§Ù„Ù…ÙˆØ¶Ø¹ (Position)



Ø§Ø®ØªÙŠØ§Ø±Ø§Øª: bottom_center, bottom_left, bottom_right, top_center, custom offset Y (px Ø£Ùˆ %).

ØªÙØ·Ø¨Ù‘ÙÙ‚ ÙÙˆØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹ÙŠÙ‘Ù†Ø©.

10. Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡ (Alignment & RTL support)



Ù…Ø­Ø§Ø°Ø§Ø© (left/center/right) ÙˆÙˆØ§Ø¬Ù‡Ø© RTL ØªÙØ·Ø¨Ù‘ÙÙ‚ Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ù„ØºØ© Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¹Ø±Ø¨ÙŠØ©.

11. Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ (ScaleX/ScaleY)



Ø®ÙŠØ§Ø±Ø§Øª ØªØ­ÙƒÙ‘Ù… Ø¨Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶/Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„Ù†Øµ (Ù„Ù†Ù…Ø°Ø¬Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙ…Ø¯Ø¯).

12. Ù†Ù…Ø§Ø°Ø¬ Ù…Ø³Ø¨Ù‚Ø© (Presets)



Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ€ Preset (name + JSON)ØŒ Ù‚Ø§Ø¦Ù…Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± PresetØŒ Ø²Ø± Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ Default.

13. Ø²Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© (Preview with Playback)



ØªØ´ØºÙŠÙ„ Ù…Ø«Ø§Ù„ ÙÙŠØ¯ÙŠÙˆ Ù‚ØµÙŠØ± Ø£Ùˆ Ù…Ù‚Ø·Ø¹ ÙˆØ§Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø­Ø±Ù‚Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ (Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ASS vs drawtext).

14. Ø²Ø± "ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹" (Apply globally)



Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ù…ÙØ¹Ù„Ù‹Ø§ØŒ ØªÙØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø¬Ù…ÙŠØ¹ ØµÙØ­Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙŠ ØªØ¹Ø±Ø¶ Ø£Ùˆ ØªØ­Ø±Ù‚ ØªØ±Ø¬Ù…Ø©.

15. Ø²Ø± Ø­ÙØ¸/ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯



Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ€ JSON ÙÙŠ /storage/emulated/0/AIAutoCreate/config/subtitle_style_{id}.json.

Ø§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± Ù…Ù„Ù JSON Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.


---

Ø³Ù„ÙˆÙƒÙŠØ§Øª ÙˆØ¨Ø±Ù…Ø¬Ø© (Implementation notes â€” Java7 / AIDE compatible)

Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ: ÙƒÙ„ ØªØ­ÙƒÙ‘Ù… ÙŠØ³ØªØ¯Ø¹ÙŠ runOnUiThread() Ø£Ùˆ Handler Ù„ØªØ­Ø¯ÙŠØ« TextView Ø§Ù„Ø¹ÙŠÙ‘Ù†Ø© ÙÙˆØ±Ù‹Ø§. ØªØ¬Ù†Ù‘Ø¨ ØªØºÙŠÙŠØ±Ø§Øª Ø²Ø§Ø¦Ø¯Ø© Ø¹Ù„Ù‰ Typeface ÙÙŠ Ø­Ù„Ù‚Ø§Øª Ù…ØªÙƒØ±Ø±Ø© â€” Ø­Ø¯Ø« ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø®Ø· ÙØ¹Ù„ÙŠÙ‹Ø§.

ØªØ­Ù…ÙŠÙ„ Ø®Ø·ÙˆØ· Ù…Ø®ØµÙ‘ØµØ©: Typeface.createFromFile(fontFilePath) (Java7). Ø§Ù„Ø®Ø· ÙŠÙÙ†Ø³Ø® Ø¥Ù„Ù‰ /storage/emulated/0/AIAutoCreate/fonts/.

ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: SharedPreferences Ù„Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© + Ù…Ù„Ù JSON ÙÙŠ /storage/emulated/0/AIAutoCreate/config/subtitle_presets.json Ù„Ø­ÙØ¸ presets Ù…ÙØµÙ‘Ù„Ø©.

ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹: Ø£ÙŠ Subtitle renderer ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ/ØµÙˆØª (FFmpegKit/VideoView overlays) ÙŠÙ‚Ø±Ø£ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† subtitle_style.json Ø£Ùˆ SharedPreferences.

ØªØ±Ù…ÙŠØ² UTF-8: Ø¹Ù†Ø¯ ØªÙˆÙ„ÙŠØ¯ Ù…Ù„ÙØ§Øª ASS ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨ØªØ±Ù…ÙŠØ² UTF-8 (important Ù„Ù„Ù‘ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©).

RTL & Shaping: Ù„Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ© (Tashkeel/Ligatures) ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ ASS ÙˆØ§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ØªØ¯Ø¹Ù… Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ â€” ASS/libass ØªØ¯Ø¹Ù… UTF-8 ÙˆØ§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙŠØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ø§Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø· ÙŠØ¯Ø¹Ù… Ø§Ù„Ø­Ø±ÙˆÙ.


---

ØªÙƒØ§Ù…Ù„ Ù…Ø¹ FFmpegKit (Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬)

Ù†Ù‡Ø¬Ø§Ù† Ø¹Ù…Ù„ÙŠØ§Ù†:

1. Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØ¶Ù‘Ù„Ø© â€” ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù ASS ÙˆÙ…Ø±ÙˆØ±Ù‡ Ù„Ù€ FFmpeg (Ù…ÙˆØµÙ‰ Ø¨Ù‡):



ØªÙˆÙ„Ù‘Ø¯ ØµÙØ­Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù…Ù„Ù .ass Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Style section) Ø«Ù… ØªØ­Ù‚Ù‘Ù† ÙƒÙ„ Ø§Ù„Ø¬Ù…Ù„ ÙƒÙ€ Dialogue Ø¨ØªÙˆÙ‚ÙŠØªØ§ØªÙ‡Ø§ (ØªÙˆÙ„Ø¯ Ù…Ù† ASR Ø£Ùˆ Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª).

Ø£Ù…Ø± FFmpeg (Ù…Ø¹ FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†) ÙŠØ³ØªØ®Ø¯Ù… -vf "subtitles=/storage/emulated/0/AIAutoCreate/projects/proj_x/subs.ass:fontsdir=/storage/emulated/0/AIAutoCreate/fonts" Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ø¶Ø§Ù.

ASS ÙŠØ¯Ø¹Ù… Outline, Shadow, BackColour, Alignment, Margin, Fontname, Fontsize â€” ÙŠØ¹Ø·ÙŠ ØªØ­ÙƒÙ…Ø§Ù‹ ÙƒØ§Ù…Ù„Ø§Ù‹.

2. Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© â€” drawtext (Ø³Ø±ÙŠØ¹ØŒ Ù„Ø­Ø§Ù„Ø§Øª Ø¨Ø³ÙŠØ·Ø©):



Ø§Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± drawtext=fontfile=...:text=...:fontsize=...:fontcolor=...:box=1:boxcolor=...:boxborderw=...:x=...:y=...:shadowx=...:shadowy=...

Ø£Ù‚Ù„ Ù…Ø±ÙˆÙ†Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ù„ÙƒÙ†Ù‡ Ù…ÙÙŠØ¯ ÙƒØ®ÙŠØ§Ø± Ø³Ø±ÙŠØ¹ Ø£Ùˆ Ø¹Ù†Ø¯ Ø§ÙØªÙ‚Ø§Ø¯ libass.


---

Ù…Ø«Ø§Ù„ Ù‚Ø§Ù„Ø¨ ASS (ÙŠÙˆÙ„Ù‘ÙØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)

[Script Info] Title: AI AutoCreate Subtitles ScriptType: v4.00+

[V4+ Styles] Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding Style: Default,MyArabicFont,28,&H00FFFFFF,&H000000FF,&H00000000,&H80000000,0,0,0,0,100,100,0,0,1,3,2,2,10,10,40,1

[Events] Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text Dialogue: 0,0:00:00.00,0:00:04.00,Default,,0,0,0,,"Ù‡Ø°Ø§ Ù†Øµ Ø¹ÙŠÙ‘Ù†Ø© Ù„Ù„ØªØ±Ø¬Ù…Ø©" Dialogue: 0,0:00:04.00,0:00:08.00,Default,,0,0,0,,"Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø³Ø·Ø± Ø«Ø§Ù†Ù"

> Ù…Ù„Ø§Ø­Ø¸Ø©: PrimaryColour ÙˆBackColour Ø¨ØµÙŠØºØ© ASS (&HAABBGGRR) Ø£Ùˆ ÙŠÙ…ÙƒÙ† ØªØ­ÙˆÙŠÙ„ Ù…Ù† ARGB.




---

Ù…Ø«Ø§Ù„ Ø£Ù…Ø± FFmpeg (FFmpegKit) Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ASS Ù…Ø¹ fontsdir

ffmpeg -i /storage/emulated/0/AIAutoCreate/projects/proj_x/input.mp4 -vf "subtitles=/storage/emulated/0/AIAutoCreate/projects/proj_x/subs.ass:fontsdir=/storage/emulated/0/AIAutoCreate/fonts" -c:a copy /storage/emulated/0/AIAutoCreate/projects/proj_x/final_burned.mp4

Ù…Ø«Ø§Ù„ Ø¨Ø¯ÙŠÙ„ Ù…Ø¹ drawtext (Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)

ffmpeg -i in.mp4 -vf "drawtext=fontfile=/storage/emulated/0/AIAutoCreate/fonts/MyArabicFont.ttf: 
text='Ù‡Ø°Ø§ Ù†Øµ Ø¹ÙŠÙ†Ø©': fontcolor=white@0.9: fontsize=28: box=1: boxcolor=black@0.5: 
boxborderw=10: x=(w-text_w)/2: y=h-(text_h*2): shadowx=1: shadowy=1" -c:a copy out.mp4


---

Ù…Ø«Ø§Ù„ Java7 (AIDE) â€” Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù ASS ÙˆØªØ´ØºÙŠÙ„ FFmpegKit

> Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§ÙØªØ±Ø§Ø¶ ÙˆØ¬ÙˆØ¯ FFmpegKit Ù…Ø¶Ù…Ù‘Ù† ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø³ÙŠØ¶ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙƒØªØ¨Ø©) Ø£Ùˆ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ binary Ø®Ø§Ø±Ø¬ÙŠ ÙƒØ®ÙŠØ§Ø± Ø«Ø§Ù†ÙˆÙŠ. Ø§Ù„ÙƒÙˆØ¯ Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Java7 (Ù„Ø§ Lambdas).



// ÙŠÙˆÙ„Ù‘Ø¯ Ù…Ù„Ù .ass Ù…Ù† Ù†Øµ Ù‚Ø§Ù„Ø¨ (text) Ø«Ù… ÙŠÙ†ÙÙ‘Ø° ffmpeg Ø¹Ø¨Ø± FFmpegKit (Ø£Ùˆ binary Ø®Ø§Ø±Ø¬ÙŠ) public boolean generateAssAndRunFFmpeg(String assContent, String assPath, String fontsDir, String inputVideo, String outputVideo) { // 1) Ø§ÙƒØªØ¨ Ù…Ù„Ù ASS (UTF-8) FileWriter writer = null; try { File assFile = new File(assPath); File parent = assFile.getParentFile(); if (!parent.exists()) parent.mkdirs(); writer = new FileWriter(assFile, false); writer.write(assContent); writer.flush(); writer.close(); } catch (IOException e) { if (writer != null) { try { writer.close(); } catch (IOException ignored) {} } e.printStackTrace(); return false; }

// 2) Ø¨Ù†Ø§Ø¡ Ø£Ù…Ø± ffmpeg
StringBuilder cmd = new StringBuilder();
cmd.append("-i ");
cmd.append(escapeShellArg(inputVideo));
cmd.append(" -vf ");
String vf = "subtitles=" + assPath + ":fontsdir=" + fontsDir;
cmd.append(escapeShellArg(vf));
cmd.append(" -c:a copy ");
cmd.append(escapeShellArg(outputVideo));
String ffmpegCommand = cmd.toString();

// 3) ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± Ø¹Ø¨Ø± FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù† (API Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø©)
try {
    // Ù…Ø«Ø§Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ (ØªØ¹Ù„ÙŠÙ‚ Ù„Ø£Ù†Ù‡ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø©):
    // FFmpegKit.execute(ffmpegCommand);
    // Ø§Ø³ØªØ®Ø¯Ù… Ø¨Ø¯ÙŠÙ„ ØªØ´ØºÙŠÙ„ binary Ø¥Ù† Ù„Ù… ØªØªÙˆÙØ± Ø§Ù„Ù…ÙƒØªØ¨Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù‡Ùˆ FFmpegKit Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†.
} catch (Exception ex) {
    ex.printStackTrace();
    return false;
}
return true;

}

// Ù‡Ø±ÙˆØ¨ Ø¨Ø³ÙŠØ· Ù„Ù„Ù…Ø³Ø§Ø±Ø§Øª private String escapeShellArg(String path) { if (path == null) return """"; return """ + path.replace(""", "\"") + """; }


---

Ù…Ù„Ù JSON Ù„Ù‚Ø§Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© (Ù…Ø«Ø§Ù„ Ù†Ù‡Ø§Ø¦ÙŠ)

{ "subtitle_style_id": "default_ar", "font_file": "/storage/emulated/0/AIAutoCreate/fonts/MyArabicFont.ttf", "font_name": "MyArabicFont", "font_size_sp": 28, "font_color_argb": "#EEFFFFFF", "alpha": 0.93, "shadow": { "enabled": true, "radius": 3, "dx": 1, "dy": 1, "color": "#99000000" }, "outline": { "enabled": true, "width": 3, "color": "#000000" }, "background_box": { "enabled": true, "color": "#80000000", "padding_dp": 8 }, "position": "bottom_center", "alignment": "center", "apply_globally": true, "created_at": "2025-10-09T12:00:00Z" }


---

Ø­Ø§Ù„Ø§Øª Ù‚Ø¨ÙˆÙ„ (Acceptance tests) â€” Ù…ÙØ­Ø¯Ù‘Ø«Ø© Ù„ØªØ¶Ù… Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ FFmpegKit

1. Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø­ÙŠÙ‘Ø©: Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø§Ù„Ø­Ø¬Ù…/Ù„ÙˆÙ†/Ø¸Ù„/Ø®Ø· ÙŠØ¸Ù‡Ø± ÙÙˆØ±Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¹ÙŠÙ‘Ù†Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ØµÙØ­Ø©.


2. Ø¥Ø¶Ø§ÙØ© Ø®Ø·: Ø¥Ø¶Ø§ÙØ© .ttf Ø¹Ø¨Ø± file picker ØªÙ†Ø³Ø® Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ /storage/emulated/0/AIAutoCreate/fonts/ ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·ÙˆØ· ÙˆÙŠÙØ·Ø¨Ù‘Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¹ÙŠÙ‘Ù†Ø©.


3. Ø­ÙØ¸ Preset ÙˆØ§Ø³ØªØ¹Ø§Ø¯ØªÙ‡: Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯ ÙƒÙ€ preset Ø«Ù… Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡ ÙŠØ·Ø§Ø¨Ù‚ JSON Ø§Ù„Ù…Ø­ÙÙˆØ¸.


4. ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø§Ù„Ù…ÙŠ: Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ apply_globally=trueØŒ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ© ØªØ´ØºÙŠÙ„ ØªØ±Ø¬Ù…Ø© ÙÙŠ VideoReimaginer Ø£Ùˆ Ø£ÙŠ ØµÙØ­Ø© ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø©.


5. Ø­Ø±Ù‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© (FFmpegKit + ASS): Orchestrator ÙŠÙˆÙ„Ù‘Ø¯ Ù…Ù„Ù ASS Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ ÙŠÙ†ÙÙ‘Ø° Ø£Ù…Ø± FFmpegKit Ù…Ø¹ :fontsdir= ÙˆÙŠÙÙ†ØªØ¬ final_burned.mp4 ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸.


6. Fallback drawtext: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¨Ù†ÙŠØ© FFmpeg ÙÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ø§ ØªØ¯Ø¹Ù… libassØŒ ÙŠÙ†ÙÙ‘Ø° Orchestrator Ø£Ù…Ø± drawtext Ù…Ø¹ Ø£Ù‚Ø±Ø¨ Ù…Ø¶Ø§Ù‡Ø§Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (ØªØ¬Ø±Ø¨Ø© SanityCheckAgent ØªØ­Ø¯Ø¯ Ø§Ù„Ø¯Ø¹Ù…).


7. RTL & Arabic shaping: Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙŠØ¸Ù‡Ø± ØµØ­ÙŠØ­Ù‹Ø§ (Ø§Ù„ØªØ´ÙƒÙŠÙ„/Ø§Ù„Ø§ØªØµØ§Ù„) ÙÙŠ Ø§Ù„Ø¹ÙŠÙ‘Ù†Ø© ÙˆØ¹Ù†Ø¯ Ø§Ù„Ø­Ø±Ù‚ (Ø§Ø¹ØªÙ…Ø§Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø¯Ø¹Ù… Ø§Ù„Ø®Ø· Ùˆlibass).


8. Ø£Ø¯Ø§Ø¡: ØªÙˆÙ„ÙŠØ¯ ASS Ù„ÙÙŠØ¯ÙŠÙˆ Ø·ÙˆÙŠÙ„ Ù„Ø§ ÙŠØªØ³Ø¨Ø¨ ÙÙŠ ÙØ´Ù„ Ø§Ù„Ø°Ø§ÙƒØ±Ø©Ø› Orchestrator ÙŠÙ‚ØªØ±Ø­ ØªØ¬Ø²Ø¦Ø© Ø£Ùˆ Ø®ÙØ¶ Ø¬ÙˆØ¯Ø© Ø¥Ù† ÙƒØ§Ù†Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ù…Ù†Ø®ÙØ¶Ø©.




---

Ø±Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ Ø¨Ù‚ÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… (ØªÙƒØ§Ù…Ù„ Orchestrator & Agents)

Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØµØ¯ÙŠØ±/Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© Ù…ÙˆÙ†ØªØ§Ø¬:

1. Orchestrator ÙŠÙ‚Ø±Ø£ subtitle_style.json.


2. ÙŠÙˆÙ„Ù‘Ø¯ Ù…Ù„Ù .ass (Ø£Ùˆ ÙŠØ¨Ù†ÙŠ ÙÙ„ØªØ± drawtext Ø¨Ø­Ø³Ø¨ Ù†ØªÙŠØ¬Ø© SanityCheckAgent).


3. ÙŠØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø®Ø· ÙÙŠ /storage/emulated/0/AIAutoCreate/fonts/. Ø¥Ù† Ù„Ù… ÙŠÙˆØ¬Ø¯ØŒ ÙŠÙ†Ø³Ø® Ø§Ù„Ù…Ù„Ù Ù…Ù† config Ø£Ùˆ ÙŠÙØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….


4. ÙŠØ¨Ù†ÙŠ Ø£Ù…Ø± FFmpeg ÙˆÙŠØ´ØºÙ‘Ù„Ù‡ Ø¹Ø¨Ø± FFmpegKit (Ø§Ù„Ù…Ø¶Ù…Ù‘Ù† ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹).


5. ÙŠÙƒØªØ¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ùˆpath Ø§Ù„Ù†Ø§ØªØ¬ ÙÙŠ agent_results/orchestrator_log.json ÙˆÙŠØ¨Ø¹Ø« broadcast Ø¥Ù„Ù‰ ActivityLogFragment ÙˆTestFragment.


21 - Ø§Ù„ÙØ­Øµ Ø§Ù„Ø´Ø§Ù…Ù„ Ùˆ Ø§Ù„ØªØ³Ù„ÙŠÙ…

Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù„ ÙƒØ§Ù…Ù„ Ù‚Ù… Ø¨Ø¹Ù†Ù„ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§ÙƒÙˆØ§Ø¯ Ùˆ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§ÙŠ Ø§Ø®Ø·Ø§Ø¡ Ø§Ùˆ Ù†Ù‚ØµØ§Ù† ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª 
Ø§Ùˆ Ø§Ø®Ø·Ø§Ø¡ ÙÙŠ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§ÙƒÙˆØ§Ø¯ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù† ÙƒÙ„ Ø´ÙŠØ¦ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ùˆ Ù…ØªÙˆØ§ÙÙ‚ ØªÙ…Ø§Ù…Ø¢ Ù…Ø¹ Ø¨Ø±Ù†Ø§Ù…Ø¬ AIDE Ùˆ java 7 

Ø§Ù…Ø§Ø¡ Ø¹Ù† Ø§Ù„ØªØ³Ù„ÙŠÙ… Ù‚Ù… Ø¨Ø§Ø±Ø³Ø§Ù„ Ù…Ù„Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙƒØ§Ù†Ù„ Ùˆ Ø´Ø§Ù…Ù„ Ø¨ØµÙŠØ¶Ø© Ù…Ù„Ù zip ÙŠÙ…ÙƒÙ†Ù†ÙŠ ÙÙƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù†Ù‡ Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡ Ù…Ø¨Ø§Ø´Ø±ØªØ§ Ø¯Ø§Ø®Ù„ Ø¨Ø±Ù†Ø§Ù…Ø¬ AIDE Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„ 
